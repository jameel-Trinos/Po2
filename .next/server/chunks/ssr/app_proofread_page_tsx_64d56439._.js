module.exports=[43602,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(46271),e=a.i(50944),f=a.i(73320),g=a.i(51168),h=a.i(70106);let i=(0,h.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var j=a.i(4720),k=a.i(3130),l=a.i(54161),m=a.i(40695),n=a.i(7379);let o=({suggestions:a,onSuggestionClick:d,selectedSuggestion:e,onApplySuggestion:f})=>(c.default.useEffect(()=>{console.log("[SuggestionSidebar] Received suggestions:",a),console.log("[SuggestionSidebar] Number of suggestions:",a?.length||0)},[a]),(0,b.jsxs)(k.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 sticky top-24",children:[(0,b.jsx)(k.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(k.CardTitle,{className:"text-emerald-600 dark:text-emerald-400",children:"AI Suggestions"}),(0,b.jsx)(l.Badge,{variant:"secondary",className:"rounded-full",children:a.length})]})}),(0,b.jsx)(k.CardContent,{children:(0,b.jsx)("div",{className:"max-h-[calc(100vh-12rem)] overflow-y-auto space-y-3",children:0===a.length?(0,b.jsxs)("div",{className:"p-6 text-center flex flex-col items-center gap-4",children:[(0,b.jsx)(i,{className:"w-12 h-12 text-green-500"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900 dark:text-gray-50",children:"No suggestions found!"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"The document looks great from a grammatical standpoint."})]})]}):a.map((a,c)=>(0,b.jsxs)("div",{onClick:()=>d(a),className:`rounded-md border p-3 cursor-pointer transition-colors ${e===a?"border-emerald-400 bg-emerald-50/50 dark:bg-emerald-900/20":"border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-800/50"}`,children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsxs)(l.Badge,{variant:"secondary",className:"rounded-full",children:[(0,b.jsx)(j.FileText,{className:"w-3 h-3 mr-1"}),"Page ",a.page]})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Original:"}),(0,b.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-through",children:a.original})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Suggestion:"}),(0,b.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:a.suggestion})]}),a.explanation&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Reason:"}),(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 italic",children:a.explanation})]})]}),f&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Separator,{className:"my-3"}),(0,b.jsx)(m.Button,{size:"sm",className:"w-full",onClick:a=>{a.stopPropagation(),f(c)},children:"Apply Change"})]})]},c))})})]})),p=(0,h.default)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),q=(0,h.default)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),r=(0,h.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var s=a.i(11989),s=s;async function t(){return await a.A(61751)}let u=({pdfUrl:a,suggestions:d,selectedSuggestion:e,onSuggestionClick:f,onApplyEdit:g})=>{let[h,i]=(0,c.useState)(null),[j,n]=(0,c.useState)(1),[o,u]=(0,c.useState)(0),[v,w]=(0,c.useState)(1.2),[x,y]=(0,c.useState)(!0),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(new Set),[D,E]=(0,c.useState)(new Set),F=(0,c.useRef)(new Map),G=(0,c.useRef)(new Map),H=(0,c.useRef)(new Map),I=(0,c.useRef)(new Map),J=(0,c.useRef)(new Map),K=(0,c.useRef)(null),L=(0,c.useRef)(new Map);(0,c.useEffect)(()=>{let b=async()=>{y(!0),A(null);try{let b=(await t()).getDocument(a),c=await b.promise;i(c),u(c.numPages),y(!1),console.log(`[ProofreadPdfViewer] PDF loaded with ${c.numPages} pages`)}catch(a){console.error("[ProofreadPdfViewer] Error loading PDF:",a),A("Failed to load PDF document"),y(!1)}};return a&&b(),()=>{H.current.forEach(a=>{try{a.cancel()}catch(a){}}),H.current.clear(),I.current.forEach(a=>{try{a.abort()}catch(a){}}),I.current.clear(),J.current.clear()}},[a]),(0,c.useEffect)(()=>{(async()=>{let a=[];H.current.forEach(b=>{a.push((async()=>{try{await b.cancel()}catch(a){}})())}),await Promise.all(a),H.current.clear(),I.current.forEach(a=>{try{a.abort()}catch(a){}}),I.current.clear(),J.current.clear(),C(new Set),E(new Set)})()},[v]);let M=(0,c.useCallback)(async a=>{if(!h)return;if(J.current.get(a))return void console.log(`[ProofreadPdfViewer] Page ${a} is already rendering, skipping`);if(!F.current.get(a))return void console.log(`[ProofreadPdfViewer] Canvas not ready for page ${a}`);J.current.set(a,!0);let b=H.current.get(a);if(b)try{console.log(`[ProofreadPdfViewer] Cancelling existing render for page ${a}`),await b.cancel(),H.current.delete(a),await new Promise(a=>setTimeout(a,100))}catch(b){console.log(`[ProofreadPdfViewer] Cancellation error for page ${a}:`,b)}try{let b=await h.getPage(a),c=F.current.get(a);if(!c)return void J.current.set(a,!1);let d=c.getContext("2d");if(!d)return void J.current.set(a,!1);let e=b.getViewport({scale:v});d.clearRect(0,0,c.width,c.height),c.width=e.width,c.height=e.height;let f=b.render({canvasContext:d,viewport:e});H.current.set(a,f),await f.promise,H.current.delete(a),C(b=>new Set([...b,a])),await N(b,a,e),console.log(`[ProofreadPdfViewer] Rendered page ${a}`)}catch(b){H.current.delete(a),b?.name!=="RenderingCancelledException"&&console.error(`[ProofreadPdfViewer] Error rendering page ${a}:`,b)}finally{J.current.set(a,!1)}},[h,v]),N=async(a,b,c)=>{let d=G.current.get(b);if(!d)return;let e=I.current.get(b);e&&(e.abort(),I.current.delete(b));let f=new AbortController;I.current.set(b,f);try{if(f.signal.aborted)return void I.current.delete(b);let e=await a.getTextContent();if(f.signal.aborted)return void I.current.delete(b);let g=await t();if(f.signal.aborted)return void I.current.delete(b);d.innerHTML="",d.style.width=`${c.width}px`,d.style.height=`${c.height}px`,e.items.forEach(a=>{if(f.signal.aborted)return;let b=document.createElement("div"),h=g.Util.transform(g.Util.transform(c.transform,a.transform),[1,0,0,-1,0,0]),i=e.styles[a.fontName];b.style.position="absolute",b.style.left=`${h[4]}px`,b.style.top=`${h[5]}px`,b.style.fontSize=`${Math.abs(h[3])}px`,b.style.fontFamily=i?.fontFamily||"sans-serif",b.textContent=a.str,b.className="pdf-text-item",d.appendChild(b)}),f.signal.aborted||E(a=>new Set([...a,b])),I.current.delete(b)}catch(a){if(I.current.delete(b),a?.name==="AbortError"||a?.name==="AbortException")return;!a?.message||a.message.includes("cancelled")||a.message.includes("abort")||console.error(`[ProofreadPdfViewer] Error rendering text layer for page ${b}:`,a)}};(0,c.useEffect)(()=>{if(!h||0===o)return;let a=async()=>{for(let a=1;a<=o;a++)J.current.get(a)||(await M(a),await new Promise(a=>setTimeout(a,50)))},b=setTimeout(()=>{a()},100);return()=>clearTimeout(b)},[h,o,v,M]),(0,c.useEffect)(()=>{if(e&&e.page&&e.original){let a=L.current.get(e.page);if(a){a.scrollIntoView({behavior:"smooth",block:"center"});let b=G.current.get(e.page);b&&O(b,e.original)}}else G.current.forEach(a=>{a.querySelectorAll(".highlighted-text").forEach(a=>{a.classList.remove("highlighted-text")})})},[e]);let O=(a,b)=>{a.querySelectorAll(".highlighted-text").forEach(a=>a.classList.remove("highlighted-text"));let c=a.querySelectorAll(".pdf-text-item"),d="",e=[];c.forEach(a=>{let b=d.length,c=a.textContent||"",f=(d+=c).length;e.push({start:b,end:f,element:a})});let f=b.toLowerCase().trim(),g=d.toLowerCase().indexOf(f);if(-1!==g){let a=g+f.length;e.forEach(({start:b,end:c,element:d})=>{(b>=g&&b<a||c>g&&c<=a||b<=g&&c>=a)&&d.classList.add("highlighted-text")})}};return x?(0,b.jsxs)(k.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{className:"text-gray-900 dark:text-gray-50",children:"Loading PDF..."})}),(0,b.jsx)(k.CardContent,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-zinc-900 dark:border-zinc-100"})})})]}):z?(0,b.jsxs)(k.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{className:"text-red-600 dark:text-red-400",children:"Error"})}),(0,b.jsx)(k.CardContent,{children:(0,b.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:z})})]}):(0,b.jsxs)(k.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,b.jsxs)(k.CardHeader,{className:"pb-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(k.CardTitle,{className:"text-gray-900 dark:text-gray-50",children:"Document Viewer"}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)(l.Badge,{variant:"secondary",children:["Page ",j," of ",o]})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{if(j>1){let a=L.current.get(j-1);a&&a.scrollIntoView({behavior:"smooth",block:"start"}),n(j-1)}},disabled:1===j,children:(0,b.jsx)(r,{className:"h-4 w-4"})}),(0,b.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{if(j<o){let a=L.current.get(j+1);a&&a.scrollIntoView({behavior:"smooth",block:"start"}),n(j+1)}},disabled:j===o,children:(0,b.jsx)(s.default,{className:"h-4 w-4"})}),(0,b.jsx)("div",{className:"flex-1"}),(0,b.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{w(a=>Math.max(a-.2,.5)),C(new Set)},disabled:v<=.5,children:(0,b.jsx)(q,{className:"h-4 w-4"})}),(0,b.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[Math.round(100*v),"%"]}),(0,b.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{w(a=>Math.min(a+.2,3)),C(new Set)},disabled:v>=3,children:(0,b.jsx)(p,{className:"h-4 w-4"})})]})]}),(0,b.jsx)(k.CardContent,{children:(0,b.jsx)("div",{ref:K,className:"relative overflow-auto bg-zinc-100 dark:bg-zinc-800 rounded-lg p-4",style:{maxHeight:"75vh"},children:(0,b.jsx)("div",{className:"flex flex-col items-center gap-4",children:Array.from({length:o},(a,b)=>b+1).map(a=>(0,b.jsxs)("div",{ref:b=>{b&&L.current.set(a,b)},className:"relative bg-white shadow-lg",style:{marginBottom:"20px"},children:[(0,b.jsx)("canvas",{ref:b=>{b&&F.current.set(a,b)},className:"block w-full h-auto"}),(0,b.jsx)("div",{ref:b=>{b&&G.current.set(a,b)},className:"absolute top-0 left-0 pointer-events-none pdf-text-layer",style:{overflow:"hidden"}}),(0,b.jsx)("div",{className:"absolute bottom-2 right-2",children:(0,b.jsx)(l.Badge,{variant:"secondary",children:a})})]},a))})})})]})};var v=a.i(59619),w=a.i(49199),x=a.i(5522),y=a.i(17171),z=a.i(65602),A=a.i(2150);async function B(){return await a.A(61751)}a.s(["default",0,()=>{(0,e.useRouter)();let[a,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(!1),[l,n]=(0,c.useState)(null),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(""),[t,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(66),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(null);c.default.useEffect(()=>()=>{H&&URL.revokeObjectURL(H)},[H]);let L=async b=>{if(b.preventDefault(),!a)return void n("Please select a document to upload.");j(!0),n(null),q([]),C(null),E(12);try{let b=a.name.toLowerCase(),c=b.endsWith(".pdf")||"application/pdf"===a.type,d=b.endsWith(".docx")||a.type.includes("officedocument.wordprocessingml");if(c){let b=await a.arrayBuffer(),c=await B(),d=await c.getDocument({data:b}).promise,e="",f=new Blob([b],{type:"application/pdf"}),h=URL.createObjectURL(f);I(h),K("pdf");for(let a=1;a<=d.numPages;a++){let b=await d.getPage(a),c=(await b.getTextContent()).items.map(a=>a.str).join(" ");e+=`--- PAGE ${a} ---
${c}
`,E(Math.min(90,Math.round(a/d.numPages*80)+10))}s(e),E(92),console.log("[ProofreadPage] Extracted text length:",e.length),console.log("[ProofreadPage] Extracted text preview:",e.substring(0,500));let i=await (0,g.analyzePdfContent)(e);console.log("[ProofreadPage] PDF suggestions received:",i),console.log("[ProofreadPage] Number of suggestions:",i.length),q(i),E(100)}else if(d){let b=await a.arrayBuffer(),c=(await w.default.convertToHtml({arrayBuffer:b})).value||"";G(c),K("docx"),E(82);let d=document.createElement("div");d.innerHTML=c;let e=d.textContent||d.innerText||"";console.log("[ProofreadPage] DOCX extracted text length:",e.length),console.log("[ProofreadPage] DOCX extracted text preview:",e.substring(0,500));let f=await fetch("/api/analyze/docx",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!f.ok)throw Error(`Analyze error ${f.status}`);let g=await f.json(),h=Array.isArray(g.suggestions)?g.suggestions:[];console.log("[ProofreadPage] DOCX suggestions received:",h),console.log("[ProofreadPage] Number of suggestions:",h.length),q(h),E(100)}else throw Error("Unsupported file type. Please upload a PDF or DOCX.")}catch(a){console.error("Failed to process file or get suggestions:",a),n("Could not process the file or get suggestions. Ensure it's a valid PDF/DOCX and your API_KEY is set.")}finally{j(!1)}},M=(a,b,c)=>{s(d=>{let e=`--- PAGE ${a} ---
`,f=d.split(e);if(f.length>1){let a=f[0],d=f.slice(1).join(e).split(b);if(d.length>1)return a+e+(d[0]+c+d.slice(1).join(b))}return d}),q(c=>c.filter(c=>c.page!==a||c.original!==b)),C(null)};return i?(0,b.jsx)("div",{className:"flex flex-col items-center justify-center h-screen bg-zinc-50 dark:bg-zinc-950 text-center gap-4 px-6",children:(0,b.jsxs)(k.Card,{className:"w-full max-w-md border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{className:"text-gray-900 dark:text-gray-50",children:"Analyzing Document..."})}),(0,b.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,b.jsx)(A.Progress,{value:D}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Please wait while our AI proofreads your document."})]})]})}):(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-zinc-50 dark:bg-zinc-950 p-4 sm:p-6 lg:p-8 flex items-center justify-center",children:(0,b.jsx)(k.Card,{className:"max-w-6xl w-full border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:(0,b.jsxs)(k.CardContent,{className:"p-6 sm:p-8 flex flex-col md:flex-row gap-8",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-50 mb-7 text-center",children:"Document Proofreader"}),l&&(0,b.jsxs)(z.Alert,{variant:"destructive",className:"mb-6",children:[(0,b.jsx)(z.AlertTitle,{children:"Error"}),(0,b.jsx)(z.AlertDescription,{children:l})]}),J?"pdf"===J&&H?(0,b.jsx)(u,{pdfUrl:H,suggestions:p,selectedSuggestion:t,onSuggestionClick:C,onApplyEdit:M}):"docx"===J&&F?(0,b.jsx)(v.default,{wordHtml:F,suggestions:p,selectedSuggestionIndex:t?p.findIndex(a=>a===t):null,onContentChange:G,onApplySuggestion:a=>{let b=p[a];if(!b)return;let c=RegExp((b.original||b.text).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");G(a=>a.replace(c,b.suggestion)),q(b=>b.filter((b,c)=>c!==a))}}):null:(0,b.jsx)("form",{onSubmit:L,className:"space-y-6 mb-8",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"file-upload",children:"Upload Document"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(x.Input,{id:"file-upload",name:"file-upload",type:"file",accept:".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:a=>{H&&URL.revokeObjectURL(H),h(a.target.files?a.target.files[0]:null),q([]),n(null),s(""),G(""),I(null),K(null)}}),(0,b.jsxs)(m.Button,{type:"submit",children:[(0,b.jsx)(f.Upload,{className:"h-4 w-4 mr-2"}),"Analyze"]})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PDF or DOCX, up to 10MB"}),a&&(0,b.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400",children:a.name})]})})]}),(0,b.jsx)("div",{className:"md:w-1/3",children:(0,b.jsx)(o,{suggestions:p,onSuggestionClick:C,selectedSuggestion:t,onApplySuggestion:a=>{let b=p[a];if(!b)return;let c=b.original||b.text;M(b.page,c,b.suggestion)}})})]})})})}],43602)}];

//# sourceMappingURL=app_proofread_page_tsx_64d56439._.js.map