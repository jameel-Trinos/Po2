module.exports=[79698,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(318),f=a.i(46271),g=a.i(3130),h=a.i(2150),i=a.i(40695),j=a.i(54161),k=a.i(84505),l=a.i(96221),m=a.i(4720),n=a.i(70106);let o=(0,n.default)("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]),p=(0,n.default)("file-down",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var q=a.i(51168),r=a.i(7379),s=a.i(65733),t=a.i(5522),u=a.i(17171);let v=({suggestions:a,selectedIndex:c,onSelectIndex:d,onApplyAtIndex:e,onGoToIndex:f,acceptedCount:h,onSaveDraft:k,saveDialogOpen:m,setSaveDialogOpen:n,projectName:o,setProjectName:p,onConfirmSave:q,isApplying:v,canApply:w})=>(0,b.jsxs)(g.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,b.jsxs)(g.CardHeader,{className:"pb-3",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)(g.CardTitle,{className:"text-emerald-600 dark:text-emerald-400",children:"Suggestions"})}),(0,b.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-md border border-zinc-200 dark:border-zinc-800 px-3 py-2",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:"All"}),(0,b.jsx)(j.Badge,{variant:"secondary",className:"rounded-full",children:a.length+h})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-md border border-zinc-200 dark:border-zinc-800 px-3 py-2",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:"Accepted"}),(0,b.jsx)(j.Badge,{variant:"secondary",className:"rounded-full",children:h})]})]})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"space-y-3",children:0===a.length?(0,b.jsx)("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:"No suggestions yet."}):a.map((a,g)=>(0,b.jsxs)("div",{className:`rounded-md border p-3 cursor-pointer transition ${c===g?"border-emerald-400 bg-emerald-50/50 dark:bg-emerald-900/20":"border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50/50 dark:hover:bg-zinc-900/40"}`,onClick:()=>d(g),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(j.Badge,{variant:"secondary",className:"rounded-full",children:["Page ",a.page]}),(0,b.jsx)("span",{className:"text-xs text-zinc-500",children:"Click to highlight"})]}),(0,b.jsx)("div",{className:"mt-2 text-sm text-zinc-800 dark:text-zinc-100",children:a.explanation}),(0,b.jsxs)("div",{className:"mt-2 text-sm",children:[(0,b.jsx)("span",{className:"text-zinc-500",children:"Original:"})," ",(0,b.jsx)("span",{className:"font-medium",children:a.original})]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"text-zinc-500",children:"Suggestion:"})," ",(0,b.jsx)("span",{className:"font-medium text-emerald-700 dark:text-emerald-300",children:a.suggestion})]}),(0,b.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:a=>{a.stopPropagation(),f?.(g)},children:"Go to"}),(0,b.jsx)(i.Button,{size:"sm",onClick:a=>{a.stopPropagation(),e(g)},disabled:v||!w,children:v?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"h-3 w-3 mr-1 animate-spin"}),"Applying..."]}):"Apply to PDF"})]})]},`${a.page}-${g}-${a.original.slice(0,16)}`))}),(0,b.jsx)(r.Separator,{className:"my-4"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:k,children:"Save as draft"}),(0,b.jsx)(i.Button,{children:"Send file to"})]}),(0,b.jsx)(s.Dialog,{open:m,onOpenChange:n,children:(0,b.jsxs)(s.DialogContent,{className:"bg-white dark:bg-zinc-900",children:[(0,b.jsxs)(s.DialogHeader,{children:[(0,b.jsx)(s.DialogTitle,{className:"text-gray-900 dark:text-gray-50",children:"Save Project as Draft"}),(0,b.jsx)(s.DialogDescription,{className:"text-gray-600 dark:text-gray-400",children:"Enter a name for your project"})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{htmlFor:"project-name",className:"text-gray-900 dark:text-gray-50",children:"Project Name"}),(0,b.jsx)(t.Input,{id:"project-name",value:o,onChange:a=>p(a.target.value),placeholder:"Enter project name",className:"bg-white dark:bg-zinc-800 text-gray-900 dark:text-gray-50",onKeyDown:a=>{"Enter"===a.key&&o.trim()&&q()}})]})}),(0,b.jsxs)(s.DialogFooter,{children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),(0,b.jsx)(i.Button,{onClick:q,disabled:!o.trim(),children:"Save"})]})]})})]})]});var w=a.i(59619),x=a.i(19721),y=a.i(66274),z=a.i(23292);async function A(){return await a.A(61751)}let B=(0,x.default)(async()=>{},{loadableGenerated:{modules:[90843]},ssr:!1,loading:()=>(0,b.jsx)("div",{className:"w-full h-[75vh] rounded-md overflow-hidden border border-zinc-200 dark:border-zinc-800 flex items-center justify-center bg-zinc-50 dark:bg-zinc-900",children:(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-zinc-900 dark:border-zinc-100 mb-4"}),(0,b.jsx)("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Loading PDF viewer..."})]})})});function C(){let a=(0,d.useSearchParams)().get("documentId"),{getDocumentPdfUrl:n,getDocumentContent:r,saveProjectAsDraft:s,getDocument:t,getModifiedPdfUrl:u,setModifiedPdfUrl:x}=(0,e.useAppContext)(),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)("pdf"),[W,X]=(0,c.useState)(""),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(null),aa=(0,c.useRef)(null);(0,c.useEffect)(()=>{if(!a){console.error("[EditorPage] No document ID provided"),J("No document ID provided.");return}console.log("[EditorPage] Loading document:",a),F(!0),J(null);try{let b=n(a);console.log("[EditorPage] PDF URL retrieved:",b?"exists":"null"),b?(D(b),_(b)):(console.warn("[EditorPage] No PDF URL found for document"),D(null))}catch(a){console.error("[EditorPage] Error loading PDF:",a),D(null)}finally{F(!1)}},[a,n]),(0,c.useEffect)(()=>{if(!a)return;let b=r(a),c=t(a);c&&T(c.projectName||""),b&&(0,q.analyzePdfContent)(b).then(a=>L(a)).catch(a=>console.error(a))},[a,r,t]);let ab=async()=>{if(!a||!C)return void z.toast.error("PDF not available for conversion");H(!0),J(null);try{let a=await fetch(C),b=await a.arrayBuffer(),c=await A(),d=await c.getDocument({data:b}).promise,e="";for(let a=1;a<=d.numPages;a++){let b=await d.getPage(a),c=(await b.getTextContent()).items.map(a=>a.str).join(" ");e+=c+"\n\n"}let f=e.split("\n\n").filter(a=>a.trim()).map(a=>`<p>${a}</p>`).join("\n");X(f),V("word"),z.toast.success("Converted to editable format")}catch(a){console.error("Error converting PDF:",a),z.toast.error("Failed to convert PDF. Please try again."),J("Failed to convert PDF to editable format.")}finally{H(!1)}},ac=async()=>{if(!a||!W)return void z.toast.error("No content to convert");H(!0),J(null);try{let b=await (0,y.htmlToWordBlob)(W),c=await (0,y.convertWordToPdf)(b);D(c),x(a,c),V("pdf"),z.toast.success("Converted back to PDF")}catch(a){console.error("Error converting to PDF:",a),z.toast.error("Failed to convert to PDF. Please try again."),J("Failed to convert to PDF.")}finally{H(!1)}},ad=a=>{let b=K[a];if(b)if("word"===U){let c=RegExp(b.original.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");X(W.replace(c,b.suggestion)),P(b=>[...b,a]),L(b=>b.filter((b,c)=>c!==a)),N(null),z.toast.success("Suggestion applied")}else z.toast.error("Convert to Word to apply suggestions")},ae=async()=>{if(a)try{if(!C)return void z.toast.error("No PDF available to download");let a=function(a,b="modified"){let c=a.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").trim();return`${c||"document"}_${b}.pdf`}(S,C!==$?"modified":"original");!function(a,b="document.pdf"){try{let c=document.createElement("a");c.href=a,c.download=b,document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(a){throw console.error("Error downloading PDF:",a),Error("Failed to download PDF")}}(C,a)}catch(a){console.error("Error downloading PDF:",a),z.toast.error("Failed to download PDF")}},af=async()=>{if(!a||!C)return void z.toast.error("PDF not available for conversion");H(!0),J(null);try{let a=await fetch(C),b=await a.blob(),c=new FormData,d=S?`${S}.pdf`:"document.pdf";c.append("file",b,d);let e=await fetch("/api/pdf-to-docx",{method:"POST",body:c});if(!e.ok){let a="Failed to convert PDF to Word",b=e.headers.get("content-type");try{if(b&&b.includes("application/json")){let b=await e.text();if(b)try{let c=JSON.parse(b);a=c.message||c.error||c.details||a,console.error("Conversion API error:",c)}catch(c){a=b||a,console.error("Conversion API error (non-JSON):",b)}else a=e.statusText||`HTTP ${e.status}`}else a=await e.text()||e.statusText||`HTTP ${e.status}`,console.error("Conversion failed with status:",e.status,e.statusText)}catch(b){a=e.statusText||`HTTP ${e.status}: Failed to convert PDF to Word`,console.error("Error reading conversion response:",b)}throw Error(a)}let f=await e.blob(),g=window.URL.createObjectURL(f),h=document.createElement("a");h.href=g,h.download=d.replace(/\.pdf$/i,".docx"),document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(g),z.toast.success("PDF converted to Word and downloaded")}catch(b){console.error("Error converting PDF to Word:",b);let a=b instanceof Error?b.message:"Failed to convert PDF to Word";z.toast.error(a),J(a)}finally{H(!1)}};return E?(0,b.jsx)("div",{className:"flex flex-col items-center justify-center h-screen bg-zinc-50 dark:bg-zinc-950 text-center px-6",children:(0,b.jsxs)(g.Card,{className:"w-full max-w-md border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{className:"text-gray-900 dark:text-gray-50",children:"Loading Documentâ€¦"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsx)(h.Progress,{value:66}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Preparing the viewer."})]})]})}):I&&!a?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen bg-zinc-50 dark:bg-zinc-950 text-center text-red-600 dark:text-red-400",children:[(0,b.jsxs)("h2",{className:"text-2xl font-semibold",children:["Error: ",I]}),(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Please go back and try again."})]}):(0,b.jsx)(f.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-zinc-50 dark:bg-zinc-950 p-4 sm:p-6 lg:p-8 flex justify-center",children:(0,b.jsxs)("div",{className:"max-w-7xl w-full grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"md:col-span-2",children:(0,b.jsxs)(g.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,b.jsxs)(g.CardHeader,{className:"pb-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(g.CardTitle,{className:"text-gray-900 dark:text-gray-50",children:"word"===U?"Document Editor":"Document Viewer"}),(0,b.jsxs)("div",{className:"flex gap-2",children:["pdf"===U&&C&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:ab,disabled:G,children:[G?(0,b.jsx)(l.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(m.FileText,{className:"h-4 w-4 mr-2"}),"Edit Document"]}),(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:af,disabled:G,children:[G?(0,b.jsx)(l.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(p,{className:"h-4 w-4 mr-2"}),"Convert to Word"]})]}),"word"===U&&(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:ac,disabled:G,children:[G?(0,b.jsx)(l.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(o,{className:"h-4 w-4 mr-2"}),"Back to PDF"]}),(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:ae,disabled:!C,children:[(0,b.jsx)(k.Download,{className:"h-4 w-4 mr-2"}),"Download"]})]})]}),"pdf"===U&&(0,b.jsx)(j.Badge,{variant:"secondary",className:"mt-2",children:'Click "Edit Document" to apply suggestions'})]}),(0,b.jsxs)(g.CardContent,{className:"p-4",children:[I&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:(0,b.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:I})}),"word"===U?(0,b.jsx)(w.default,{wordHtml:W,suggestions:K,selectedSuggestionIndex:M,onContentChange:X,onApplySuggestion:ad,isLoading:G}):C?(0,b.jsx)(B,{fileUrl:C,fileName:S?`${S}.pdf`:"document.pdf",onReady:a=>{aa.current=a},className:"w-full h-[75vh] rounded-md overflow-hidden border border-zinc-200 dark:border-zinc-800"}):(0,b.jsxs)("div",{className:"w-full h-[75vh] rounded-md overflow-hidden border border-zinc-200 dark:border-zinc-800 flex flex-col items-center justify-center p-6 bg-zinc-50 dark:bg-zinc-900",children:[(0,b.jsx)("svg",{className:"w-16 h-16 text-zinc-400 dark:text-zinc-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-zinc-700 dark:text-zinc-300 mb-2",children:"No PDF Available"}),(0,b.jsx)("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 text-center max-w-md",children:"No PDF file was found for this document. Please upload a PDF file to view it here."})]})]})]})}),(0,b.jsx)("aside",{className:"md:col-span-1",children:(0,b.jsx)(v,{suggestions:K,selectedIndex:M,onSelectIndex:N,onApplyAtIndex:ad,onGoToIndex:a=>{N(a)},acceptedCount:O.length,onSaveDraft:()=>{a&&(S.trim()?(s(S.trim(),a),z.toast.success("Project saved as draft!")):R(!0))},saveDialogOpen:Q,setSaveDialogOpen:R,projectName:S,setProjectName:T,onConfirmSave:()=>{a&&S.trim()&&(s(S.trim(),a),R(!1),z.toast.success("Project saved as draft!"))},isApplying:G,canApply:"word"===U})})]})})}a.s(["default",()=>C],79698)}];

//# sourceMappingURL=app_editor_page_tsx_b89e3172._.js.map