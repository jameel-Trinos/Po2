module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},6920,(e,t,r)=>{"use strict";r.byteLength=function(e){var t=u(e),r=t[0],s=t[1];return(r+s)*3/4-s},r.toByteArray=function(e){var t,r,s=u(e),o=s[0],i=s[1],l=new n((o+i)*3/4-i),p=0,d=i>0?o-4:o;for(r=0;r<d;r+=4)t=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],l[p++]=t>>16&255,l[p++]=t>>8&255,l[p++]=255&t;return 2===i&&(t=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,l[p++]=255&t),1===i&&(t=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,l[p++]=t>>8&255,l[p++]=255&t),l},r.fromByteArray=function(e){for(var t,r=e.length,a=r%3,n=[],o=0,i=r-a;o<i;o+=16383)n.push(function(e,t,r){for(var a,n=[],o=t;o<r;o+=3)a=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]),n.push(s[a>>18&63]+s[a>>12&63]+s[a>>6&63]+s[63&a]);return n.join("")}(e,o,o+16383>i?i:o+16383));return 1===a?n.push(s[(t=e[r-1])>>2]+s[t<<4&63]+"=="):2===a&&n.push(s[(t=(e[r-2]<<8)+e[r-1])>>10]+s[t>>4&63]+s[t<<2&63]+"="),n.join("")};for(var s=[],a=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,l=o.length;i<l;++i)s[i]=o[i],a[o.charCodeAt(i)]=i;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var s=r===t?0:4-r%4;return[r,s]}a[45]=62,a[95]=63},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},78143,e=>{"use strict";var t=e.i(47909),r=e.i(74017),s=e.i(96250),a=e.i(59756),n=e.i(61916),o=e.i(14444),i=e.i(37092),l=e.i(69741),u=e.i(16795),p=e.i(87718),d=e.i(95169),c=e.i(32084),h=e.i(66012),g=e.i(70101),f=e.i(26937),m=e.i(10372),x=e.i(93695);e.i(52474);var y=e.i(220),v=e.i(34731),R=e.i(89171);async function A(e){try{let t,r=process.env.GEMINI_API_KEY||"AIzaSyAAdOixGAtP3GdflcC0fzIQdIumNrj0Cao",{pdfTextByPage:s}=await e.json();if(!s||"string"!=typeof s)return R.NextResponse.json({error:"Invalid request: pdfTextByPage is required."},{status:400});let a=new v.GoogleGenAI({apiKey:r}),n=`
      You are an expert financial compliance reviewer specializing in FINRA and SEC regulations. Analyze the following text extracted from a financial document. The text for each page is separated by '--- PAGE [number] ---'.
      
      Your task is to identify:
      1. COMPLIANCE VIOLATIONS (critical/warning):
         - Missing risk disclosures required by FINRA/SEC
         - Prohibited claims (guaranteed returns, misleading performance predictions)
         - Required disclaimers that are missing or incomplete
         - Misleading or deceptive language about investments
         - Failure to disclose conflicts of interest
         - Omission of material facts
         - Improper comparisons or benchmarks
      
      2. GRAMMAR/STYLE ISSUES (suggestion):
         - Grammatical mistakes
         - Spelling errors
         - Awkward phrasing
         - Punctuation issues
         - Clarity improvements
      
      For each issue found, provide:
      - original: the problematic text snippet
      - suggestion: the corrected version
      - explanation: brief explanation of why the change is needed
      - page: page number where found
      - category: one of "compliance", "grammar", or "style"
      - severity: "critical" (must fix immediately), "warning" (should fix), or "suggestion" (nice to have)
      
      Compliance violations should be marked as "critical" or "warning" severity.
      Grammar/style issues should be marked as "suggestion" severity.
      
      Return your findings as a JSON array. If there are no issues, return an empty array.

      Here is the text:
      ${s}
    `,o={type:v.Type.ARRAY,items:{type:v.Type.OBJECT,properties:{issue:{type:v.Type.STRING,description:"A brief description of the issue (e.g., 'Performance disclaimer missing')."},page:{type:v.Type.INTEGER,description:"The page number where the issue was found."},text:{type:v.Type.STRING,description:"The original problematic text snippet."},suggestion:{type:v.Type.STRING,description:"The suggested correction for the text."},category:{type:v.Type.STRING,description:"The category of the issue: compliance, grammar, or style.",enum:["compliance","grammar","style"]},severity:{type:v.Type.STRING,description:"The severity level: critical (must fix), warning (should fix), or suggestion (nice to have).",enum:["critical","warning","suggestion"]}},required:["issue","page","text","suggestion"]}},i=await a.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{responseMimeType:"application/json",responseSchema:o}});if(!i||"string"!=typeof i.text)throw console.error("Invalid response structure:",i),Error(`Invalid response from AI: response.text is not available. Response structure: ${JSON.stringify(i)}`);let l=i.text.trim();if(!l)throw Error("Empty response from AI.");try{let e=JSON.parse(l);if(!Array.isArray(e))throw Error(`Invalid response format: expected an array of suggestions, got ${typeof e}`);t=e.map(e=>({issue:e.issue||e.explanation||"Issue found",page:e.page||1,text:e.text||e.original||"",suggestion:e.suggestion||"",category:e.category||"compliance",severity:e.severity||"warning",original:e.text||e.original||"",explanation:e.issue||e.explanation||"Issue found"}))}catch(e){throw console.error("Failed to parse Gemini response as JSON:",e),console.error("Response text:",l),Error("Failed to parse AI response. The response may not be valid JSON.")}return R.NextResponse.json({suggestions:t})}catch(r){console.error("Error analyzing content with Gemini:",r);let e="Failed to get suggestions from the AI. Please check the console for details.",t=500;if(r instanceof Error){if(e=r.message||e,(r.status||r.code)&&(t=r.status||r.code||t),r.error){let s=r.error;"object"==typeof s&&(s.message&&(e=s.message),s.code?t=s.code:s.status&&(t=({UNAVAILABLE:503,RESOURCE_EXHAUSTED:429,UNAUTHENTICATED:401,PERMISSION_DENIED:403,INVALID_ARGUMENT:400,NOT_FOUND:404})[s.status]||t))}}else"string"==typeof r?e=r:r&&"object"==typeof r&&(r.message&&(e=r.message),r.error?.message&&(e=r.error.message),r.error?.code?t=r.error.code:r.error?.status&&(t=({UNAVAILABLE:503,RESOURCE_EXHAUSTED:429,UNAUTHENTICATED:401,PERMISSION_DENIED:403,INVALID_ARGUMENT:400,NOT_FOUND:404})[r.error.status]||t));return(t<400||t>=600)&&(t=500),R.NextResponse.json({error:{message:e,code:t,status:503===t?"UNAVAILABLE":"ERROR"}},{status:t})}}e.s(["POST",()=>A],23892);var E=e.i(23892);let w=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/analyze/route",pathname:"/api/analyze",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/analyze/route.ts",nextConfigOutput:"",userland:E}),{workAsyncStorage:T,workUnitAsyncStorage:I,serverHooks:N}=w;function C(){return(0,s.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:I})}async function b(e,t,s){w.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/analyze/route";v=v.replace(/\/index$/,"")||"/";let R=await w.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:A,params:E,nextConfig:T,parsedUrl:I,isDraftMode:N,prerenderManifest:C,routerServerContext:b,isOnDemandRevalidate:S,revalidateOnlyGenerated:O,resolvedPathname:_,clientReferenceManifest:q,serverActionsManifest:P}=R,U=(0,l.normalizeAppPath)(v),k=!!(C.dynamicRoutes[U]||C.routes[_]),j=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,I,!1):t.end("This page could not be found"),null);if(k&&!N){let e=!!C.routes[_],t=C.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await j();throw new x.NoFallbackError}}let M=null;!k||w.isDev||N||(M="/index"===(M=_)?"/":M);let D=!0===w.isDev||!k,G=k&&!D;P&&q&&(0,o.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:q,serverActionsManifest:P,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:P})});let H=e.method||"GET",L=(0,n.getTracer)(),F=L.getActiveScopeSpan(),z={params:E,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>w.onRequestError(e,t,s,b)},sharedContext:{buildId:A}},B=new u.NodeNextRequest(e),$=new u.NodeNextResponse(t),K=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let o=async e=>w.handle(K,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${H} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var n,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&S&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(a);e.fetchMetrics=z.renderOpts.fetchMetrics;let l=z.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let u=z.renderOpts.collectedTags;if(!k)return await (0,h.sendResponse)(B,$,n,z.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,s=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:S})},b),t}},p=await w.handleResponse({req:e,nextConfig:T,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:i});if(!k)return null;if((null==p||null==(n=p.value)?void 0:n.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",S?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,g.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&k||d.delete(m.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(p.cacheControl)),await (0,h.sendResponse)(B,$,new Response(p.value.body,{headers:d,status:p.value.status||200})),null};F?await l(F):await L.withPropagatedContext(e.headers,()=>L.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof x.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:S})}),k)throw t;return await (0,h.sendResponse)(B,$,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>C,"routeModule",()=>w,"serverHooks",()=>N,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>I],78143)},85685,e=>{e.v(e=>Promise.resolve().then(()=>e(54799)))},91961,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__c130a00c._.js"].map(t=>e.l(t))).then(()=>t(12111)))},72331,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__6b6c626a._.js","server/chunks/[root-of-the-server]__8aed1f3b._.js","server/chunks/[root-of-the-server]__e24658a7._.js"].map(t=>e.l(t))).then(()=>t(20442)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a4c3cdd0._.js.map