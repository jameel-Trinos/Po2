module.exports=[33738,e=>{"use strict";var t=e.i(47909),o=e.i(74017),r=e.i(96250),n=e.i(59756),a=e.i(61916),s=e.i(14444),i=e.i(37092),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(32084),f=e.i(66012),g=e.i(70101),m=e.i(26937),h=e.i(10372),v=e.i(93695);e.i(52474);var E=e.i(220),w=e.i(89171),y=e.i(88947),R=e.i(21007);async function C(t){console.log("ðŸ”„ Using fallback conversion method (pdf-lib + docx)...");try{let o=await e.A(76910),{Document:r,Paragraph:n,TextRun:a,AlignmentType:s,HeadingLevel:i}=await e.A(38295),{Packer:l}=await e.A(38295),c=await e.A(62321);o.GlobalWorkerOptions.workerSrc=c,console.log("âœ… Fallback libraries loaded");let d=o.getDocument({data:t}),u=await d.promise,p=u.numPages;console.log(`ðŸ“„ PDF has ${p} pages, extracting text...`);let f=[];for(let e=1;e<=p;e++){let t=await u.getPage(e),o=await t.getTextContent(),r=new Map;for(let e of o.items)if("str"in e&&e.str.trim()){let t=Math.round(e.transform[5]);r.has(t)||r.set(t,[]),r.get(t).push(e.str)}for(let[e,t]of Array.from(r.entries()).sort((e,t)=>t[0]-e[0])){let e=t.join(" ").trim();if(e){let t=e.length<50&&e===e.toUpperCase()&&!e.match(/^\d+/);f.push(new n({children:[new a(e)],...t?{heading:i.HEADING_2}:{},spacing:{after:200}}))}}e<p&&f.push(new n({children:[new a("")],pageBreakBefore:!0}))}console.log(`âœ… Extracted ${f.length} paragraphs`);let g=new r({sections:[{properties:{},children:f}]}),m=await l.toBuffer(g);return console.log(`âœ… Fallback conversion successful, DOCX size: ${m.length} bytes`),Buffer.from(m)}catch(e){throw console.error("âŒ Fallback conversion also failed:",e),Error(`Fallback conversion failed: ${e instanceof Error?e.message:"Unknown error"}`)}}async function b(t){try{let o,r,n=process.env.ADOBE_PDFSERVICES_CLIENT_ID,a=process.env.ADOBE_PDFSERVICES_CLIENT_SECRET;if(!n||!a)return console.error("âŒ Adobe PDF Services credentials not configured"),w.NextResponse.json({error:"Configuration Error",message:"Adobe PDF Services credentials are not configured",details:"Please ensure ADOBE_PDFSERVICES_CLIENT_ID and ADOBE_PDFSERVICES_CLIENT_SECRET are set in your environment variables"},{status:500});console.log("âœ… Adobe credentials found");let s=t.headers.get("content-type");console.log("ðŸ“¥ Incoming request content-type:",s);let i=null,l="document.pdf";if(s?.includes("application/json")){console.log("ðŸ“‹ Parsing JSON body...");let e=(await t.json()).documentId;if(!e)return w.NextResponse.json({error:"No PDF source provided",message:"Please provide a documentId in the request body"},{status:400});{console.log("ðŸ“¥ Processing PDF from storage (documentId:",e,")...");let t=(0,R.getPDF)(e);if(!t)return w.NextResponse.json({error:"PDF not found",message:`No PDF found for document ID: ${e}. The PDF may have expired or been deleted.`,details:"PDFs are stored temporarily (24 hours). Please re-upload the document."},{status:404});l=t.fileName,i=new File([new Uint8Array(t.buffer)],l,{type:"application/pdf"}),console.log("âœ… Retrieved PDF from storage:",l,"(",t.buffer.length,"bytes)")}}else{if(!s?.includes("multipart/form-data"))return console.warn("âš ï¸ Unexpected content type:",s),w.NextResponse.json({error:"Invalid content type",message:"Request must be either application/json (with documentId) or multipart/form-data (with file)"},{status:400});console.log("ðŸ“‹ Parsing form data (file upload)...");let e=await t.formData();for(let[t,o]of(i=e.get("file"),console.log("ðŸ“‹ Form data entries:"),e.entries()))o instanceof File?console.log(`  - ${t}: File(name="${o.name}", type="${o.type}", size=${o.size})`):console.log(`  - ${t}:`,o)}if(!i)return console.error("âŒ No file provided"),w.NextResponse.json({error:"No file provided",message:"Please ensure a file is included in the request or a valid documentId is provided"},{status:400,headers:{"Content-Type":"application/json"}});console.log("âœ… Processing file:",{name:i.name,type:i.type,size:i.size});let c=i.name.toLowerCase().endsWith(".pdf"),d="application/pdf"===i.type;if(console.log("ðŸ” File validation:"),console.log("  - Has .pdf extension:",c),console.log("  - Has PDF MIME type:",d),console.log("  - File type:",i.type||"(empty)"),!c&&!d)return console.error("âŒ Invalid file type:",i.type,"for file:",i.name),w.NextResponse.json({error:"File must be a PDF",message:`Received file type: ${i.type||"unknown"}`,details:`File name: ${i.name}. Expected .pdf extension and/or application/pdf MIME type.`},{status:400,headers:{"Content-Type":"application/json"}});if(0===i.size)return console.error("âŒ Empty file provided"),w.NextResponse.json({error:"Empty file provided",message:"The PDF file appears to be empty (0 bytes)",details:`File name: ${i.name}, Size: ${i.size} bytes`},{status:400,headers:{"Content-Type":"application/json"}});console.log("âœ… File validation passed"),console.log("ðŸ“„ Reading PDF file...");try{let e=await i.arrayBuffer();o=Buffer.from(e),console.log("âœ… PDF file read, size:",o.length,"bytes")}catch(t){console.error("âŒ Failed to read PDF file:",t);let e=t instanceof Error?t.message:"Unknown error";return w.NextResponse.json({error:"Failed to read PDF file",message:e,details:"The PDF file could not be read from the request."},{status:400,headers:{"Content-Type":"application/json"}})}console.log("ðŸ”„ Converting PDF to DOCX using Adobe PDF Services...");try{let{ServicePrincipalCredentials:t,PDFServices:s,MimeType:i,ExportPDFToDocxParams:l,ExportPDFParams:c,ExportPDFJob:d,StreamAsset:u,ClientConfig:p}=await e.A(11414);console.log("âœ… Adobe SDK loaded");let f=new t({clientId:n,clientSecret:a});console.log("âœ… Credentials created");let g=p.clientConfigBuilder().withConnectTimeout(6e4).withReadTimeout(6e4).build();console.log("âœ… Client config created with 60s timeout");let m=new s({credentials:f,clientConfig:g});console.log("âœ… PDF Services initialized with extended timeout");let h=null;for(let e=1;e<=3;e++)try{console.log(`ðŸ”„ Conversion attempt ${e}/3...`);let t=y.Readable.from(o);console.log("ðŸ“¤ Uploading PDF to Adobe...");let n=await m.upload({readStream:t,mimeType:i.PDF});console.log("âœ… PDF uploaded as asset");let a=new l,s=new d({inputAsset:n,params:a});console.log("âœ… Export job created"),console.log("â³ Submitting conversion job...");let c=await m.submit({job:s});console.log("âœ… Job submitted, polling for result...");let u=await m.getJobResult({pollingURL:c,resultType:d.ResultType});console.log("âœ… Job completed");let p=u.result.asset,f=await m.getContent({asset:p});console.log("ðŸ“¥ Downloading DOCX result...");let g=[];for await(let e of f.readStream)g.push(Buffer.from(e));if(r=Buffer.concat(g),console.log("âœ… Conversion successful, DOCX size:",r.length,"bytes"),!r||0===r.length)throw Error("Conversion produced an empty file");break}catch(o){let t=(h=o instanceof Error?o:Error(String(o))).message.includes("timeout")||h.message.includes("network")||h.message.includes("ECONNRESET")||h.message.includes("ETIMEDOUT");if(e<3&&t){let t=1e3*Math.pow(2,e);console.warn(`âš ï¸ Attempt ${e} failed (${h.message}), retrying in ${t}ms...`),await new Promise(e=>setTimeout(e,t))}else throw h}}catch(n){console.error("âŒ Adobe PDF Services conversion failed:",n);let e=n instanceof Error?n.message:"Unknown error",t=n instanceof Error?n.stack:void 0;console.error("Conversion error details:",{message:e,stack:t,errorType:n instanceof Error?n.constructor.name:typeof n}),console.warn("âš ï¸ Attempting fallback conversion method...");try{r=await C(o),console.log("âœ… Fallback conversion succeeded!")}catch(o){console.error("âŒ Fallback conversion also failed:",o);let t="PDF to DOCX conversion failed using both Adobe services and fallback method. ";return e.includes("credentials")?t+="Please check your Adobe API credentials are correct.":e.includes("quota")||e.includes("limit")?t+="API quota may have been exceeded. Check your Adobe account.":e.includes("network")||e.includes("timeout")?t+="Network error occurred. This is often temporary - please try again.":t+="The PDF file may be corrupted, encrypted, or in an unsupported format.",w.NextResponse.json({error:"Failed to convert PDF to DOCX",message:e,details:t,fallbackError:o instanceof Error?o.message:String(o),...{}},{status:500,headers:{"Content-Type":"application/json"}})}}let u=i.name.replace(/\.pdf$/i,".docx");return console.log("ðŸ“¤ Sending DOCX file:",u),new w.NextResponse(r,{status:200,headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.wordprocessingml.document","Content-Disposition":`attachment; filename="${u}"`}})}catch(r){console.error("âŒ PDF to DOCX conversion error:",r);let e=r instanceof Error?r.message:"Unknown error",t=r instanceof Error?r.stack:void 0;console.error("Error name:",r instanceof Error?r.name:"Error"),console.error("Error message:",e),t&&console.error("Error stack:",t);let o={error:"Failed to convert PDF to DOCX",message:e,...!1};return console.error("Returning error response:",JSON.stringify(o,null,2)),w.NextResponse.json(o,{status:500,headers:{"Content-Type":"application/json"}})}}e.s(["POST",()=>b,"maxDuration",0,60,"runtime",0,"nodejs"],61402);var P=e.i(61402);let D=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/convert/pdf-to-docx/route",pathname:"/api/convert/pdf-to-docx",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/convert/pdf-to-docx/route.ts",nextConfigOutput:"",userland:P}),{workAsyncStorage:F,workUnitAsyncStorage:x,serverHooks:A}=D;function T(){return(0,r.patchFetch)({workAsyncStorage:F,workUnitAsyncStorage:x})}async function N(e,t,r){D.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/convert/pdf-to-docx/route";w=w.replace(/\/index$/,"")||"/";let y=await D.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:C,nextConfig:b,parsedUrl:P,isDraftMode:F,prerenderManifest:x,routerServerContext:A,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,resolvedPathname:S,clientReferenceManifest:k,serverActionsManifest:I}=y,O=(0,l.normalizeAppPath)(w),_=!!(x.dynamicRoutes[O]||x.routes[S]),j=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,P,!1):t.end("This page could not be found"),null);if(_&&!F){let e=!!x.routes[S],t=x.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await j();throw new v.NoFallbackError}}let $=null;!_||D.isDev||F||($="/index"===($=S)?"/":$);let U=!0===D.isDev||!_,M=_&&!U;I&&k&&(0,s.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:k,serverActionsManifest:I,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:I})});let q=e.method||"GET",H=(0,a.getTracer)(),B=H.getActiveScopeSpan(),z={params:C,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,r)=>D.onRequestError(e,t,r,A)},sharedContext:{buildId:R}},X=new c.NodeNextRequest(e),L=new c.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(X,(0,d.signalFromNodeResponse)(t));try{let s=async e=>D.handle(K,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=H.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=o.get("next.route");if(r){let t=`${q} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${w}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let c=async({previousCacheEntry:o})=>{try{if(!i&&T&&N&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(n);e.fetchMetrics=z.renderOpts.fetchMetrics;let l=z.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=z.renderOpts.collectedTags;if(!_)return await (0,f.sendResponse)(X,L,a,z.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[h.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,r=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:r}}}}catch(t){throw(null==o?void 0:o.isStale)&&await D.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:T})},A),t}},d=await D.handleResponse({req:e,nextConfig:b,cacheKey:$,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:i});if(!_)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",T?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),F&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&_||u.delete(h.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,f.sendResponse)(X,L,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};B?await l(B):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${q} ${w}`,kind:a.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await D.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:T})}),_)throw t;return await (0,f.sendResponse)(X,L,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>T,"routeModule",()=>D,"serverHooks",()=>A,"workAsyncStorage",()=>F,"workUnitAsyncStorage",()=>x],33738)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_6f0132e8.js.map