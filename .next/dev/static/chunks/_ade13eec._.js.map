{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS","debugId":null}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90\",\n        destructive:\n          \"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"span\"> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"span\"\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,oZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD;IAC1D,MAAM,OAAO,UAAU,2KAAI,GAAG;IAE9B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAhBS","debugId":null}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/separator.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Separator({\n  className,\n  orientation = \"horizontal\",\n  decorative = true,\n  ...props\n}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {\n  return (\n    <SeparatorPrimitive.Root\n      data-slot=\"separator\"\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Separator }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,UAAU,EACjB,SAAS,EACT,cAAc,YAAY,EAC1B,aAAa,IAAI,EACjB,GAAG,OACkD;IACrD,qBACE,6LAAC,gLAAuB;QACtB,aAAU;QACV,YAAY;QACZ,aAAa;QACb,WAAW,IAAA,qHAAE,EACX,kKACA;QAED,GAAG,KAAK;;;;;;AAGf;KAlBS","debugId":null}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/editor/TinyMCEEditor.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef, useImperativeHandle, forwardRef, useState } from 'react';\nimport { Editor } from '@tinymce/tinymce-react';\nimport type { Editor as TinyMCEEditorType } from 'tinymce';\nimport { Card, CardContent } from '@/components/ui/card';\nimport type { Suggestion } from '@/lib/types/proofreader';\n\ninterface TinyMCEEditorProps {\n  content: string;\n  onContentChange: (html: string) => void;\n  suggestions?: Suggestion[];\n  selectedSuggestionIndex?: number | null;\n  className?: string;\n}\n\nexport interface TinyMCEEditorHandle {\n  highlightText: (text: string) => void;\n  replaceText: (original: string, replacement: string) => void;\n  getEditor: () => TinyMCEEditorType | null;\n  getContent: () => string;\n}\n\nconst TinyMCEEditor = forwardRef<TinyMCEEditorHandle, TinyMCEEditorProps>(\n  ({ content, onContentChange, suggestions = [], selectedSuggestionIndex = null, className }, ref) => {\n    const editorRef = useRef<TinyMCEEditorType | null>(null);\n    // Force dark mode always - never change based on system theme\n    const isDarkMode = true;\n\n    // Expose methods to parent via ref\n    useImperativeHandle(ref, () => ({\n      highlightText: (text: string) => {\n        if (!editorRef.current) return;\n        highlightTextInEditor(editorRef.current, text);\n      },\n      replaceText: (original: string, replacement: string) => {\n        if (!editorRef.current) return;\n        replaceTextInEditor(editorRef.current, original, replacement);\n      },\n      getEditor: () => editorRef.current,\n      getContent: () => editorRef.current?.getContent() || '',\n    }));\n\n    // Update content when it changes externally\n    useEffect(() => {\n      if (editorRef.current && content !== editorRef.current.getContent()) {\n        editorRef.current.setContent(content);\n      }\n    }, [content]);\n\n    // Highlight selected suggestion\n    useEffect(() => {\n      if (editorRef.current && selectedSuggestionIndex !== null && suggestions[selectedSuggestionIndex]) {\n        const suggestion = suggestions[selectedSuggestionIndex];\n        const textToHighlight = suggestion.text || suggestion.original || '';\n        if (textToHighlight) {\n          highlightTextInEditor(editorRef.current, textToHighlight);\n        }\n      }\n    }, [selectedSuggestionIndex, suggestions]);\n\n    const handleEditorChange = (content: string) => {\n      onContentChange(content);\n    };\n\n    const handleEditorInit = (_evt: any, editor: TinyMCEEditorType) => {\n      editorRef.current = editor;\n    };\n\n    return (\n      <div className=\"force-dark-mode\">\n        <Card className={`border-zinc-700 bg-gradient-to-b from-zinc-900 to-zinc-950 shadow-xl ${className || ''}`}>\n          <CardContent className=\"p-0\">\n            <Editor\n              key=\"dark\"\n              apiKey={process.env.NEXT_PUBLIC_TINYMCE_API_KEY || 'no-api-key'}\n              onInit={handleEditorInit}\n              value={content}\n              onEditorChange={handleEditorChange}\n              init={{\n              height: '70vh',\n              menubar: 'file edit view insert format tools table help',\n              plugins: [\n                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',\n                'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',\n                'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount',\n                'nonbreaking', 'pagebreak', 'save', 'directionality', 'emoticons',\n                'codesample'\n              ],\n              toolbar: [\n                'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | forecolor backcolor | superscript subscript',\n                'alignleft aligncenter alignright alignjustify | outdent indent | bullist numlist | link image media table | charmap emoticons pagebreak',\n                'searchreplace visualblocks code codesample | insertdatetime nonbreaking anchor | fullscreen preview | removeformat help'\n              ],\n              toolbar_mode: 'sliding',\n              toolbar_sticky: true,\n              toolbar_sticky_offset: 0,\n              content_style: `\n                body { \n                  font-family: -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif; \n                  font-size: 16px; \n                  padding: 30px; \n                  line-height: 1.7;\n                  color: #f1f5f9;\n                  background-color: #18181b;\n                  max-width: 1100px;\n                  margin: 0 auto;\n                }\n                h1, h2, h3, h4, h5, h6 {\n                  margin-top: 1.5em;\n                  margin-bottom: 0.5em;\n                  font-weight: 600;\n                  line-height: 1.3;\n                  color: #f8fafc;\n                }\n                p {\n                  margin-bottom: 1em;\n                  color: #f1f5f9;\n                  line-height: 1.6;\n                }\n                a {\n                  color: #818cf8;\n                  text-decoration: none;\n                  border-bottom: 1px solid rgba(129, 140, 248, 0.3);\n                  transition: border-color 0.2s ease;\n                }\n                a:hover {\n                  border-bottom-color: #818cf8;\n                }\n                /* Table styling for better formatting */\n                table {\n                  border-collapse: collapse;\n                  width: 100%;\n                  margin: 1.5rem 0;\n                  border: 1px solid #3f3f46;\n                  background-color: #27272a;\n                  overflow: hidden;\n                  border-radius: 8px;\n                }\n                th {\n                  background-color: #3f3f46;\n                  color: #f8fafc;\n                  font-weight: 600;\n                  padding: 12px 16px;\n                  text-align: left;\n                  border: 1px solid #52525b;\n                }\n                td {\n                  padding: 10px 16px;\n                  border: 1px solid #3f3f46;\n                  color: #e4e4e7;\n                  vertical-align: top;\n                }\n                tr:nth-child(even) {\n                  background-color: #2d2d31;\n                }\n                tr:hover {\n                  background-color: #35353a;\n                }\n                /* Image styling for proper display */\n                img {\n                  max-width: 100%;\n                  height: auto;\n                  display: block;\n                  margin: 1.5rem auto;\n                  border-radius: 8px;\n                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);\n                }\n                /* List styling */\n                ul, ol {\n                  margin: 1rem 0;\n                  padding-left: 2rem;\n                  color: #f1f5f9;\n                }\n                li {\n                  margin: 0.5rem 0;\n                  line-height: 1.6;\n                }\n                /* Code blocks */\n                pre, code {\n                  background-color: #27272a;\n                  border: 1px solid #3f3f46;\n                  border-radius: 6px;\n                  padding: 0.2em 0.4em;\n                  font-family: 'Monaco', 'Menlo', 'Courier New', monospace;\n                  font-size: 0.9em;\n                  color: #a5f3fc;\n                }\n                pre {\n                  padding: 1em;\n                  overflow-x: auto;\n                  margin: 1rem 0;\n                }\n                /* Blockquote styling */\n                blockquote {\n                  border-left: 4px solid #818cf8;\n                  padding-left: 1rem;\n                  margin: 1rem 0;\n                  color: #d1d5db;\n                  font-style: italic;\n                  background-color: rgba(129, 140, 248, 0.05);\n                  padding: 1rem;\n                  border-radius: 4px;\n                }\n              `,\n              skin: 'oxide-dark',\n              content_css: 'dark',\n              branding: false,\n              promotion: false,\n              // Hide promotion elements via CSS and ensure proper theming\n              init_instance_callback: (editor) => {\n                const style = document.createElement('style');\n                style.textContent = `\n                  .tox-promotion,\n                  .tox-promotion-button,\n                  .tox-statusbar__branding {\n                    display: none !important;\n                  }\n                  /* Force dark mode always - beautiful enhanced styling */\n                  .force-dark-mode .tox .tox-menubar,\n                  .force-dark-mode .tox .tox-toolbar,\n                  .force-dark-mode .tox .tox-toolbar__primary {\n                    background: linear-gradient(135deg, #1e1e24 0%, #27272a 100%) !important;\n                    border-bottom: 1px solid rgba(124, 58, 237, 0.2) !important;\n                  }\n                  .force-dark-mode .tox .tox-toolbar__group,\n                  .force-dark-mode .tox .tox-split-button,\n                  .force-dark-mode .tox .tox-tbtn {\n                    color: #e4e4e7 !important;\n                  }\n                  .force-dark-mode .tox .tox-tbtn__select-label,\n                  .force-dark-mode .tox .tox-tbtn--select {\n                    color: #e4e4e7 !important;\n                    font-weight: 500 !important;\n                  }\n                  /* Enhanced menubar styling */\n                  .force-dark-mode .tox .tox-mbtn {\n                    color: #f4f4f5 !important;\n                    font-weight: 500 !important;\n                    padding: 8px 14px !important;\n                    border-radius: 6px !important;\n                    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n                  }\n                  .force-dark-mode .tox .tox-mbtn:hover {\n                    background: rgba(124, 58, 237, 0.15) !important;\n                    transform: translateY(-1px) !important;\n                  }\n                  /* Enhanced toolbar button styling */\n                  .force-dark-mode .tox .tox-tbtn {\n                    border-radius: 6px !important;\n                    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n                  }\n                  .force-dark-mode .tox .tox-tbtn:hover {\n                    background: rgba(124, 58, 237, 0.15) !important;\n                    transform: scale(1.05) !important;\n                  }\n                  .force-dark-mode .tox .tox-tbtn--enabled {\n                    background: rgba(124, 58, 237, 0.2) !important;\n                  }\n                  .force-dark-mode .tox .tox-tbtn svg {\n                    fill: #d4d4d8 !important;\n                  }\n                  .force-dark-mode .tox .tox-tbtn:hover svg,\n                  .force-dark-mode .tox .tox-tbtn--enabled svg {\n                    fill: #c4b5fd !important;\n                  }\n                  /* Group separators */\n                  .force-dark-mode .tox .tox-toolbar__group {\n                    border-right: 1px solid rgba(124, 58, 237, 0.2) !important;\n                  }\n                  /* Editor container */\n                  .force-dark-mode .tox-tinymce {\n                    border: 1px solid rgba(124, 58, 237, 0.3) !important;\n                    border-radius: 12px !important;\n                    overflow: hidden !important;\n                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(124, 58, 237, 0.1) !important;\n                  }\n                  /* Dropdowns and panels */\n                  .force-dark-mode .tox .tox-collection,\n                  .force-dark-mode .tox .tox-menu,\n                  .force-dark-mode .tox .tox-dialog {\n                    background: #27272a !important;\n                    border: 1px solid rgba(124, 58, 237, 0.3) !important;\n                  }\n                `;\n                document.head.appendChild(style);\n              },\n              resize: true,\n              statusbar: false,\n              paste_as_text: false,\n              paste_auto_cleanup_on_paste: true,\n              paste_retain_style_properties: 'all',\n              paste_merge_formats: true,\n              convert_urls: false,\n              font_size_formats: '8pt 10pt 12pt 14pt 16pt 18pt 24pt 28pt 36pt 48pt',\n              font_family_formats: 'System Font=-apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, sans-serif; Arial=arial,helvetica,sans-serif; Times New Roman=times new roman,times,serif; Courier New=courier new,courier,monospace; Georgia=georgia,palatino,serif; Verdana=verdana,geneva,sans-serif',\n              // Table plugin settings for better table handling\n              table_use_colgroups: true,\n              table_resize_bars: true,\n              table_default_attributes: {\n                border: '1'\n              },\n              table_default_styles: {\n                'border-collapse': 'collapse',\n                'width': '100%',\n                'border': '1px solid #3f3f46',\n                'background-color': '#27272a'\n              },\n              table_cell_default_styles: {\n                'padding': '10px 16px',\n                'border': '1px solid #3f3f46',\n                'vertical-align': 'top'\n              },\n              table_header_default_styles: {\n                'background-color': '#3f3f46',\n                'font-weight': '600',\n                'padding': '12px 16px'\n              },\n              // Image settings for better image handling\n              image_advtab: true,\n              image_dimensions: true,\n              image_class_list: [\n                {title: 'Responsive', value: 'img-responsive'},\n                {title: 'Full Width', value: 'img-full-width'},\n                {title: 'Center', value: 'img-center'}\n              ],\n              setup: (editor) => {\n                // Add custom command to highlight text\n                editor.addCommand('highlightText', (ui, value) => {\n                  if (value) {\n                    highlightTextInEditor(editor, value);\n                  }\n                });\n\n                // Add custom command to replace text\n                editor.addCommand('replaceText', (ui, value) => {\n                  if (value?.original && value?.replacement) {\n                    replaceTextInEditor(editor, value.original, value.replacement);\n                  }\n                });\n              },\n            }}\n          />\n        </CardContent>\n      </Card>\n      </div>\n    );\n  }\n);\n\nTinyMCEEditor.displayName = 'TinyMCEEditor';\n\n/**\n * Highlight text in TinyMCE editor (yellow highlight)\n */\nfunction highlightTextInEditor(editor: TinyMCEEditorType, text: string): void {\n  if (!text || !text.trim()) return;\n\n  try {\n    // Remove previous highlights\n    const body = editor.getBody();\n    const existingHighlights = body.querySelectorAll('mark.suggestion-highlight');\n    existingHighlights.forEach((el) => {\n      const parent = el.parentNode;\n      if (parent) {\n        while (el.firstChild) {\n          parent.insertBefore(el.firstChild, el);\n        }\n        parent.removeChild(el);\n        parent.normalize();\n      }\n    });\n\n    // Get plain text content for searching\n    const plainText = editor.getContent({ format: 'text' });\n    const searchText = text.trim().toLowerCase();\n    const lowerText = plainText.toLowerCase();\n    const index = lowerText.indexOf(searchText);\n\n    if (index === -1) {\n      console.warn('Text not found in editor:', text);\n      return;\n    }\n\n    // Use TinyMCE's searchreplace plugin or manual DOM manipulation\n    const htmlContent = editor.getContent();\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = htmlContent;\n\n  // Find text nodes that contain the search text\n    const walker = document.createTreeWalker(\n      tempDiv,\n      NodeFilter.SHOW_TEXT,\n      null\n    );\n\n    let currentNode: Node | null = null;\n    let cumulativeLength = 0;\n    let found = false;\n\n    while ((currentNode = walker.nextNode()) && !found) {\n      const textNode = currentNode as Text;\n      const nodeText = textNode.textContent || '';\n      const nodeLowerText = nodeText.toLowerCase();\n      const nodeStart = cumulativeLength;\n      const nodeEnd = cumulativeLength + nodeText.length;\n\n      cumulativeLength = nodeEnd;\n\n      // Check if this node contains the search text\n      const searchIndex = nodeLowerText.indexOf(searchText);\n      if (searchIndex !== -1) {\n        // Found the text in this node\n        const beforeText = nodeText.substring(0, searchIndex);\n        const matchText = nodeText.substring(searchIndex, searchIndex + searchText.length);\n        const afterText = nodeText.substring(searchIndex + searchText.length);\n\n        // Create fragment with highlighted text\n        const fragment = document.createDocumentFragment();\n        if (beforeText) {\n          fragment.appendChild(document.createTextNode(beforeText));\n        }\n\n        const mark = document.createElement('mark');\n        mark.className = 'suggestion-highlight';\n        mark.setAttribute('style', 'background-color: #fef08a; color: #000; padding: 2px 4px; border-radius: 3px;');\n        mark.textContent = matchText;\n        fragment.appendChild(mark);\n\n        if (afterText) {\n          fragment.appendChild(document.createTextNode(afterText));\n        }\n\n        // Replace the text node with the fragment\n        textNode.parentNode?.replaceChild(fragment, textNode);\n        found = true;\n      }\n    }\n\n    if (found) {\n      // Update editor with highlighted content\n      editor.setContent(tempDiv.innerHTML);\n\n      // Scroll to highlighted text\n      setTimeout(() => {\n        const highlight = editor.getBody().querySelector('mark.suggestion-highlight');\n        if (highlight) {\n          editor.selection.select(highlight as any);\n          editor.selection.scrollIntoView();\n          // Also try to scroll the editor window\n          highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        }\n      }, 100);\n    }\n  } catch (error) {\n    console.error('Error highlighting text in TinyMCE:', error);\n  }\n}\n\n/**\n * Replace text in TinyMCE editor\n */\nfunction replaceTextInEditor(editor: TinyMCEEditorType, original: string, replacement: string): void {\n  if (!original || !original.trim()) return;\n\n  try {\n    // Remove any existing highlights first\n    const body = editor.getBody();\n    const existingHighlights = body.querySelectorAll('mark.suggestion-highlight');\n    existingHighlights.forEach((el) => {\n      const parent = el.parentNode;\n      if (parent) {\n        while (el.firstChild) {\n          parent.insertBefore(el.firstChild, el);\n        }\n        parent.removeChild(el);\n        parent.normalize();\n      }\n    });\n\n    // Get current content\n    const htmlContent = editor.getContent();\n    const plainText = editor.getContent({ format: 'text' });\n    const searchText = original.trim().toLowerCase();\n    const lowerText = plainText.toLowerCase();\n    const index = lowerText.indexOf(searchText);\n\n    if (index === -1) {\n      console.warn('Text not found in editor for replacement:', original);\n      return;\n    }\n\n    // Create temporary DOM for manipulation\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = htmlContent;\n\n    // Find and replace text\n    const walker = document.createTreeWalker(\n      tempDiv,\n      NodeFilter.SHOW_TEXT,\n      null\n    );\n\n    let currentNode: Node | null = null;\n    let cumulativeLength = 0;\n    let replaced = false;\n\n    while ((currentNode = walker.nextNode()) && !replaced) {\n      const textNode = currentNode as Text;\n      const nodeText = textNode.textContent || '';\n      const nodeLowerText = nodeText.toLowerCase();\n      const nodeStart = cumulativeLength;\n      const nodeEnd = cumulativeLength + nodeText.length;\n\n      cumulativeLength = nodeEnd;\n\n      // Check if this node contains the search text\n      const searchIndex = nodeLowerText.indexOf(searchText);\n      if (searchIndex !== -1) {\n        // Found the text in this node - replace it\n        const beforeText = nodeText.substring(0, searchIndex);\n        const afterText = nodeText.substring(searchIndex + searchText.length);\n\n        // Create fragment with replacement text\n        const fragment = document.createDocumentFragment();\n        if (beforeText) {\n          fragment.appendChild(document.createTextNode(beforeText));\n        }\n        fragment.appendChild(document.createTextNode(replacement));\n        if (afterText) {\n          fragment.appendChild(document.createTextNode(afterText));\n        }\n\n        // Replace the text node with the fragment\n        textNode.parentNode?.replaceChild(fragment, textNode);\n        replaced = true;\n      }\n    }\n\n    if (replaced) {\n      // Update editor with replaced content\n      editor.setContent(tempDiv.innerHTML);\n    }\n  } catch (error) {\n    console.error('Error replacing text in TinyMCE:', error);\n  }\n}\n\nexport default TinyMCEEditor;\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 785, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/compliance/SuggestionCard.tsx"],"sourcesContent":["\"use client\";\n\nimport React from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { CheckCircle2, AlertTriangle, Info } from 'lucide-react';\n\nexport interface ComplianceSuggestion {\n  id?: string;\n  category: string;\n  severity: 'critical' | 'warning' | 'info';\n  originalText: string;\n  suggestedText: string;\n  explanation: string;\n  page?: number;\n  isApplied?: boolean;\n}\n\ninterface SuggestionCardProps {\n  suggestion: ComplianceSuggestion;\n  index: number;\n  isSelected: boolean;\n  onSelect: () => void;\n  onApply: () => void;\n  isApplying?: boolean;\n}\n\nexport default function SuggestionCard({\n  suggestion,\n  index,\n  isSelected,\n  onSelect,\n  onApply,\n  isApplying = false\n}: SuggestionCardProps) {\n  const getSeverityIcon = () => {\n    switch (suggestion.severity) {\n      case 'critical':\n        return <AlertTriangle className=\"h-4 w-4 text-red-500\" />;\n      case 'warning':\n        return <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />;\n      default:\n        return <Info className=\"h-4 w-4 text-blue-500\" />;\n    }\n  };\n\n  const getSeverityColor = () => {\n    switch (suggestion.severity) {\n      case 'critical':\n        return 'destructive';\n      case 'warning':\n        return 'default';\n      default:\n        return 'secondary';\n    }\n  };\n\n  const getCategoryColor = () => {\n    switch (suggestion.category) {\n      case 'FINRA':\n        return 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';\n      case 'SEC':\n        return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';\n      case 'Grammar':\n        return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';\n      default:\n        return 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200';\n    }\n  };\n\n  if (suggestion.isApplied) {\n    return (\n      <Card className=\"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/30\">\n        <CardContent className=\"p-3\">\n          <div className=\"flex items-center gap-2 text-green-700 dark:text-green-300\">\n            <CheckCircle2 className=\"h-4 w-4\" />\n            <span className=\"text-sm font-medium\">Applied</span>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card\n      className={`border cursor-pointer transition-all hover:shadow-md ${\n        isSelected\n          ? 'border-emerald-500 dark:border-emerald-600 bg-emerald-50 dark:bg-emerald-950/30 shadow-lg'\n          : 'border-zinc-200 dark:border-zinc-700'\n      }`}\n      onClick={onSelect}\n    >\n      <CardContent className=\"p-4 space-y-3\">\n        {/* Header */}\n        <div className=\"flex items-start justify-between gap-2\">\n          <div className=\"flex items-center gap-2\">\n            {getSeverityIcon()}\n            <Badge variant={getSeverityColor() as any} className=\"text-xs\">\n              {suggestion.severity}\n            </Badge>\n          </div>\n          <Badge className={`text-xs ${getCategoryColor()}`}>\n            {suggestion.category}\n          </Badge>\n        </div>\n\n        {/* Explanation */}\n        <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n          {suggestion.explanation}\n        </p>\n\n        {/* Original vs Suggested Text */}\n        <div className=\"space-y-2 text-xs\">\n          <div className=\"p-2 bg-red-50 dark:bg-red-950/30 rounded border border-red-200 dark:border-red-800\">\n            <p className=\"text-red-700 dark:text-red-300 font-medium mb-1\">Original:</p>\n            <p className=\"text-red-900 dark:text-red-100\">{suggestion.originalText}</p>\n          </div>\n          <div className=\"p-2 bg-green-50 dark:bg-green-950/30 rounded border border-green-200 dark:border-green-800\">\n            <p className=\"text-green-700 dark:text-green-300 font-medium mb-1\">Suggested:</p>\n            <p className=\"text-green-900 dark:text-green-100\">{suggestion.suggestedText}</p>\n          </div>\n        </div>\n\n        {/* Page Number */}\n        {suggestion.page && (\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n            Page {suggestion.page}\n          </p>\n        )}\n\n        {/* Apply Button */}\n        <Button\n          variant=\"default\"\n          size=\"sm\"\n          className=\"w-full\"\n          onClick={(e) => {\n            e.stopPropagation();\n            onApply();\n          }}\n          disabled={isApplying}\n        >\n          {isApplying ? 'Applying...' : 'Apply Change'}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AACA;AAAA;AAAA;AANA;;;;;;AA4Be,SAAS,eAAe,EACrC,UAAU,EACV,KAAK,EACL,UAAU,EACV,QAAQ,EACR,OAAO,EACP,aAAa,KAAK,EACE;IACpB,MAAM,kBAAkB;QACtB,OAAQ,WAAW,QAAQ;YACzB,KAAK;gBACH,qBAAO,6LAAC,4OAAa;oBAAC,WAAU;;;;;;YAClC,KAAK;gBACH,qBAAO,6LAAC,4OAAa;oBAAC,WAAU;;;;;;YAClC;gBACE,qBAAO,6LAAC,6MAAI;oBAAC,WAAU;;;;;;QAC3B;IACF;IAEA,MAAM,mBAAmB;QACvB,OAAQ,WAAW,QAAQ;YACzB,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT;gBACE,OAAO;QACX;IACF;IAEA,MAAM,mBAAmB;QACvB,OAAQ,WAAW,QAAQ;YACzB,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT;gBACE,OAAO;QACX;IACF;IAEA,IAAI,WAAW,SAAS,EAAE;QACxB,qBACE,6LAAC,oIAAI;YAAC,WAAU;sBACd,cAAA,6LAAC,2IAAW;gBAAC,WAAU;0BACrB,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC,wOAAY;4BAAC,WAAU;;;;;;sCACxB,6LAAC;4BAAK,WAAU;sCAAsB;;;;;;;;;;;;;;;;;;;;;;IAKhD;IAEA,qBACE,6LAAC,oIAAI;QACH,WAAW,CAAC,qDAAqD,EAC/D,aACI,8FACA,wCACJ;QACF,SAAS;kBAET,cAAA,6LAAC,2IAAW;YAAC,WAAU;;8BAErB,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;gCACZ;8CACD,6LAAC,sIAAK;oCAAC,SAAS;oCAA2B,WAAU;8CAClD,WAAW,QAAQ;;;;;;;;;;;;sCAGxB,6LAAC,sIAAK;4BAAC,WAAW,CAAC,QAAQ,EAAE,oBAAoB;sCAC9C,WAAW,QAAQ;;;;;;;;;;;;8BAKxB,6LAAC;oBAAE,WAAU;8BACV,WAAW,WAAW;;;;;;8BAIzB,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAE,WAAU;8CAAkD;;;;;;8CAC/D,6LAAC;oCAAE,WAAU;8CAAkC,WAAW,YAAY;;;;;;;;;;;;sCAExE,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAE,WAAU;8CAAsD;;;;;;8CACnE,6LAAC;oCAAE,WAAU;8CAAsC,WAAW,aAAa;;;;;;;;;;;;;;;;;;gBAK9E,WAAW,IAAI,kBACd,6LAAC;oBAAE,WAAU;;wBAA2C;wBAChD,WAAW,IAAI;;;;;;;8BAKzB,6LAAC,wIAAM;oBACL,SAAQ;oBACR,MAAK;oBACL,WAAU;oBACV,SAAS,CAAC;wBACR,EAAE,eAAe;wBACjB;oBACF;oBACA,UAAU;8BAET,aAAa,gBAAgB;;;;;;;;;;;;;;;;;AAKxC;KAvHwB","debugId":null}},
    {"offset": {"line": 1050, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Input({ className, type, ...props }: React.ComponentProps<\"input\">) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        \"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        \"focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]\",\n        \"aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,6LAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,8bACA,iFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS","debugId":null}},
    {"offset": {"line": 1081, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/label.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        \"flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,MAAM,EACb,SAAS,EACT,GAAG,OAC8C;IACjD,qBACE,6LAAC,4KAAmB;QAClB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,uNACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS","debugId":null}},
    {"offset": {"line": 1114, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/alert.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-card text-card-foreground\",\n        destructive:\n          \"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Alert({\n  className,\n  variant,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof alertVariants>) {\n  return (\n    <div\n      data-slot=\"alert\"\n      role=\"alert\"\n      className={cn(alertVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction AlertTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-title\"\n      className={cn(\n        \"col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDescription({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-description\"\n      className={cn(\n        \"text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Alert, AlertTitle, AlertDescription }\n"],"names":[],"mappings":";;;;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,qOACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,GAAG,OAC8D;IACjE,qBACE,6LAAC;QACC,aAAU;QACV,MAAK;QACL,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAbS;AAeT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,+DACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OACyB;IAC5B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kGACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS","debugId":null}},
    {"offset": {"line": 1190, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/tooltip.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction TooltipProvider({\n  delayDuration = 0,\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {\n  return (\n    <TooltipPrimitive.Provider\n      data-slot=\"tooltip-provider\"\n      delayDuration={delayDuration}\n      {...props}\n    />\n  )\n}\n\nfunction Tooltip({\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Root>) {\n  return (\n    <TooltipProvider>\n      <TooltipPrimitive.Root data-slot=\"tooltip\" {...props} />\n    </TooltipProvider>\n  )\n}\n\nfunction TooltipTrigger({\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {\n  return <TooltipPrimitive.Trigger data-slot=\"tooltip-trigger\" {...props} />\n}\n\nfunction TooltipContent({\n  className,\n  sideOffset = 0,\n  children,\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Content>) {\n  return (\n    <TooltipPrimitive.Portal>\n      <TooltipPrimitive.Content\n        data-slot=\"tooltip-content\"\n        sideOffset={sideOffset}\n        className={cn(\n          \"bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n        <TooltipPrimitive.Arrow className=\"bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]\" />\n      </TooltipPrimitive.Content>\n    </TooltipPrimitive.Portal>\n  )\n}\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n"],"names":[],"mappings":";;;;;;;;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,gBAAgB,EACvB,gBAAgB,CAAC,EACjB,GAAG,OACoD;IACvD,qBACE,6LAAC,kLAAyB;QACxB,aAAU;QACV,eAAe;QACd,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,QAAQ,EACf,GAAG,OACgD;IACnD,qBACE,6LAAC;kBACC,cAAA,6LAAC,8KAAqB;YAAC,aAAU;YAAW,GAAG,KAAK;;;;;;;;;;;AAG1D;MARS;AAUT,SAAS,eAAe,EACtB,GAAG,OACmD;IACtD,qBAAO,6LAAC,iLAAwB;QAAC,aAAU;QAAmB,GAAG,KAAK;;;;;;AACxE;MAJS;AAMT,SAAS,eAAe,EACtB,SAAS,EACT,aAAa,CAAC,EACd,QAAQ,EACR,GAAG,OACmD;IACtD,qBACE,6LAAC,gLAAuB;kBACtB,cAAA,6LAAC,iLAAwB;YACvB,aAAU;YACV,YAAY;YACZ,WAAW,IAAA,qHAAE,EACX,qaACA;YAED,GAAG,KAAK;;gBAER;8BACD,6LAAC,+KAAsB;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAI1C;MAtBS","debugId":null}},
    {"offset": {"line": 1289, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/compliance/DocumentUpload.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { Upload, FileText, FileType2, Loader2 } from 'lucide-react';\nimport { toast } from 'sonner';\n\ninterface DocumentUploadProps {\n  onUploadSuccess: (data: {\n    documentId: string;\n    fileType: 'pdf' | 'docx';\n    htmlContent: string;\n    extractedText: string;\n    suggestions: any[];\n    pdfUrl?: string; // Only for PDF files\n  }) => void;\n  onError: (error: string) => void;\n}\n\nexport default function DocumentUpload({ onUploadSuccess, onError }: DocumentUploadProps) {\n  const [file, setFile] = useState<File | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [isConverting, setIsConverting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0] || null;\n    setFile(selectedFile);\n    setError(null);\n\n    if (selectedFile) {\n      const fileName = selectedFile.name.toLowerCase();\n      const isValidFile = fileName.endsWith('.docx') || fileName.endsWith('.pdf');\n      \n      if (!isValidFile) {\n        setError('Please select a .docx or .pdf file');\n        setFile(null);\n      }\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!file) {\n      setError('Please select a document to upload.');\n      return;\n    }\n\n    setIsUploading(true);\n    setError(null);\n\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n\n      console.log(' Uploading file to /api/compliance/analyze...');\n      const response = await fetch('/api/compliance/analyze', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include', // Include cookies for authentication\n      });\n\n      console.log(' Response status:', response.status, response.statusText);\n      \n      if (!response.ok) {\n        console.log(' Response is not OK, handling error...');\n        \n        // Initialize with guaranteed default values\n        const defaultError = {\n          error: 'Server Error',\n          details: `Request failed with status ${response.status}: ${response.statusText}`\n        };\n        \n        let errorData = { ...defaultError };\n        console.log(' Initialized errorData with defaults:', errorData);\n        \n        try {\n          console.log(' Attempting to read response body...');\n          // Clone the response so we can read it multiple times if needed\n          const clonedResponse = response.clone();\n          const text = await clonedResponse.text();\n          console.log(' Raw error response text:', text);\n          console.log(' Response text length:', text.length);\n          console.log(' Response Content-Type:', response.headers.get('content-type'));\n          console.log(' Text is truthy:', !!text);\n          console.log(' Trimmed text length:', text?.trim().length);\n          \n          // Only try to parse if we have content\n          if (text && text.trim()) {\n            console.log(' Have text content, attempting to parse JSON...');\n            try {\n              const parsed = JSON.parse(text);\n              console.log(' Successfully parsed JSON:', parsed);\n              console.log(' Parsed type:', typeof parsed);\n              console.log(' Parsed keys:', parsed ? Object.keys(parsed) : 'null');\n              \n              // Check if the parsed data has meaningful content\n              if (parsed && typeof parsed === 'object' && Object.keys(parsed).length > 0) {\n                console.log(' Parsed object has keys');\n                // Ensure we have at least error or details\n                if (parsed.error || parsed.details || parsed.message) {\n                  console.log(' Found error/details/message in parsed data');\n                  errorData = {\n                    error: parsed.error || 'Server error',\n                    details: parsed.details || parsed.message || 'An error occurred'\n                  };\n                  console.log(' Updated errorData:', errorData);\n                } else {\n                  // Has keys but no error/details - might be a different format\n                  console.warn(' Parsed JSON has no error/details/message fields:', parsed);\n                  errorData = { \n                    error: 'Server error', \n                    details: `Server returned: ${JSON.stringify(parsed)}`\n                  };\n                  console.log(' Updated errorData with stringified response:', errorData);\n                }\n              } else {\n                // Empty object or invalid JSON\n                console.warn(' Received empty or invalid JSON from server');\n                errorData = { \n                  error: 'Empty Response', \n                  details: `The server returned an empty response (HTTP ${response.status}). This may indicate an unhandled error in the API.` \n                };\n                console.log(' Updated errorData with empty response message:', errorData);\n              }\n            } catch (jsonError) {\n              console.error(' JSON parse error:', jsonError);\n              console.log('Using raw text as error details');\n              // If JSON parsing fails, use the raw text as details\n              errorData = { \n                error: 'Invalid Response Format', \n                details: text.length > 500 ? text.substring(0, 500) + '...' : text\n              };\n              console.log(' Updated errorData with raw text:', errorData);\n            }\n          } else {\n            console.warn(' Empty error response body (no text)');\n            errorData = { \n              error: 'Empty Response', \n              details: `The server returned an error (HTTP ${response.status}) but no response body. Please check the server logs.` \n            };\n            console.log(' Updated errorData for empty body:', errorData);\n          }\n        } catch (readError) {\n          console.error(' Failed to read error response:', readError);\n          console.log('Keeping default errorData');\n          // errorData already has default values, no need to change\n        }\n        \n        // Final safety check - ensure errorData is never empty\n        if (!errorData || typeof errorData !== 'object' || Object.keys(errorData).length === 0) {\n          console.error(' CRITICAL: errorData is empty or invalid, resetting to default');\n          errorData = { ...defaultError };\n        }\n        \n        // Ensure at least one of error or details is present\n        if (!errorData.error && !errorData.details) {\n          console.error(' CRITICAL: errorData has no error or details, adding defaults');\n          errorData = { ...defaultError };\n        }\n        \n        console.error(' Final error data:', JSON.stringify(errorData));\n        console.error(' Final error data keys:', Object.keys(errorData));\n        console.error(' Final error data.error:', errorData.error);\n        console.error(' Final error data.details:', errorData.details);\n        \n        // Build error message with multiple fallbacks\n        let errorMsg = 'Unknown error occurred';\n        \n        if (errorData.error && errorData.details) {\n          errorMsg = `${errorData.error}: ${errorData.details}`;\n        } else if (errorData.error) {\n          errorMsg = errorData.error;\n        } else if (errorData.details) {\n          errorMsg = errorData.details;\n        } else {\n          errorMsg = `Failed to analyze document (HTTP ${response.status}: ${response.statusText})`;\n        }\n        \n        console.error(' Final error message:', errorMsg);\n        throw new Error(errorMsg);\n      }\n\n      const data = await response.json();\n      console.log(' Analysis complete! Response data:', data);\n      onUploadSuccess(data);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to process the file.';\n      setError(errorMessage);\n      onError(errorMessage);\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  // Handle PDF to Word conversion\n  const handleConvertToWord = async () => {\n    if (!file) {\n      setError('Please select a PDF file to convert.');\n      return;\n    }\n\n    const fileName = file.name.toLowerCase();\n    if (!fileName.endsWith('.pdf')) {\n      setError('Only PDF files can be converted to Word.');\n      return;\n    }\n\n    setIsConverting(true);\n    setError(null);\n\n    try {\n      toast.info('Converting PDF to Word...', {\n        description: 'This may take a few moments.'\n      });\n\n      // Create FormData to send to the API\n      const formData = new FormData();\n      formData.append('file', file);\n\n      console.log(' Converting PDF to DOCX via /api/convert/pdf-to-docx...');\n      const response = await fetch('/api/convert/pdf-to-docx', {\n        method: 'POST',\n        body: formData,\n      });\n\n      console.log(' Conversion response status:', response.status, response.statusText);\n\n      if (!response.ok) {\n        let errorMessage = 'Failed to convert PDF to Word';\n        let errorDetails = '';\n        \n        try {\n          const contentType = response.headers.get('content-type');\n          const text = await response.text();\n          \n          if (contentType && contentType.includes('application/json') && text) {\n            const errorData = JSON.parse(text);\n            errorMessage = errorData.message || errorData.error || errorMessage;\n            errorDetails = errorData.details || '';\n            \n            // Provide user-friendly messages\n            if (errorDetails.includes('Network error') || errorDetails.includes('timeout')) {\n              errorMessage = 'Conversion timeout';\n              errorDetails = 'The conversion is taking too long. Please try again or use a smaller PDF.';\n            } else if (errorDetails.includes('credentials')) {\n              errorMessage = 'Configuration error';\n              errorDetails = 'PDF conversion service needs configuration. Please contact support.';\n            } else if (errorData.fallbackError) {\n              errorMessage = 'Cannot convert this PDF';\n              errorDetails = 'This PDF may be encrypted, corrupted, or in an unsupported format.';\n            }\n          } else if (text) {\n            errorDetails = text.substring(0, 200);\n          }\n        } catch (e) {\n          console.error('Error reading response:', e);\n        }\n        \n        // Show detailed error to user\n        toast.error(errorMessage, {\n          description: errorDetails,\n          duration: 7000\n        });\n        \n        throw new Error(errorMessage);\n      }\n\n      // Get the DOCX blob\n      const docxBlob = await response.blob();\n      console.log(' PDF converted to DOCX, blob size:', docxBlob.size);\n\n      // Create a new File object from the blob\n      const docxFile = new File([docxBlob], file.name.replace(/\\.pdf$/i, '.docx'), {\n        type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n      });\n\n      toast.success('PDF converted to Word!', {\n        description: 'Now analyzing the document for compliance...'\n      });\n\n      // Now upload the converted DOCX file for analysis\n      const analysisFormData = new FormData();\n      analysisFormData.append('file', docxFile);\n\n      console.log(' Uploading converted DOCX to /api/compliance/analyze...');\n      const analysisResponse = await fetch('/api/compliance/analyze', {\n        method: 'POST',\n        body: analysisFormData,\n        credentials: 'include', // Include cookies for authentication\n      });\n\n      console.log(' Analysis response status:', analysisResponse.status, analysisResponse.statusText);\n      \n      if (!analysisResponse.ok) {\n        const defaultError = {\n          error: 'Analysis Error',\n          details: `Request failed with status ${analysisResponse.status}: ${analysisResponse.statusText}`\n        };\n        \n        let errorData = { ...defaultError };\n        \n        try {\n          const text = await analysisResponse.text();\n          \n          if (text && text.trim()) {\n            try {\n              const parsed = JSON.parse(text);\n              if (parsed && (parsed.error || parsed.details || parsed.message)) {\n                errorData = {\n                  error: parsed.error || 'Server error',\n                  details: parsed.details || parsed.message || 'An error occurred'\n                };\n              } else {\n                errorData = { \n                  error: 'Server error', \n                  details: `Server returned: ${JSON.stringify(parsed)}`\n                };\n              }\n            } catch (jsonError) {\n              errorData = { \n                error: 'Invalid Response Format', \n                details: text.length > 500 ? text.substring(0, 500) + '...' : text\n              };\n            }\n          } else {\n            errorData = { \n              error: 'Empty Response', \n              details: `The server returned an error (HTTP ${analysisResponse.status}) but no response body.` \n            };\n          }\n        } catch (readError) {\n          console.error('Failed to read error response:', readError);\n        }\n        \n        const errorMsg = errorData.error && errorData.details \n          ? `${errorData.error}: ${errorData.details}`\n          : errorData.error || errorData.details || `Failed to analyze document (HTTP ${analysisResponse.status})`;\n        \n        throw new Error(errorMsg);\n      }\n\n      const data = await analysisResponse.json();\n      console.log(' Analysis complete! Response data:', data);\n      \n      toast.success('Conversion and analysis complete!');\n      onUploadSuccess(data);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to convert PDF to Word.';\n      console.error(' Conversion error:', errorMessage);\n      setError(errorMessage);\n      onError(errorMessage);\n      toast.error('Conversion failed', {\n        description: errorMessage\n      });\n    } finally {\n      setIsConverting(false);\n    }\n  };\n\n  return (\n    <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n      <CardHeader>\n        <CardTitle className=\"text-gray-900 dark:text-gray-50 flex items-center gap-2\">\n          <FileText className=\"h-5 w-5\" />\n          Upload Document for Compliance Review\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {error && (\n          <Alert variant=\"destructive\">\n            <AlertTitle>Error</AlertTitle>\n            <AlertDescription>{error}</AlertDescription>\n          </Alert>\n        )}\n        \n        <div className=\"space-y-2\">\n          <Label htmlFor=\"file-upload\" className=\"text-gray-700 dark:text-gray-300\">\n            Select Document (PDF or DOCX)\n          </Label>\n          <div className=\"flex gap-3\">\n            <Input\n              id=\"file-upload\"\n              type=\"file\"\n              accept=\".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document\"\n              onChange={handleFileChange}\n              disabled={isUploading}\n              className=\"flex-1\"\n            />\n            <Button \n              onClick={handleUpload} \n              disabled={!file || isUploading}\n              className=\"whitespace-nowrap\"\n            >\n              <Upload className=\"h-4 w-4 mr-2\" />\n              {isUploading ? 'Analyzing...' : 'Analyze'}\n            </Button>\n          </div>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n            Supported formats: PDF, DOCX (up to 10MB). Analysis checks for FINRA, SEC, and grammar compliance.\n          </p>\n        </div>\n\n        {file && !error && (\n          <div className=\"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-800\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex-1\">\n                <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                  <span className=\"font-medium\">Selected:</span> {file.name}\n                </p>\n                <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\n                  Size: {(file.size / 1024 / 1024).toFixed(2)} MB\n                </p>\n              </div>\n              \n              {/* Show Convert to Word icon for PDF files */}\n              {file.name.toLowerCase().endsWith('.pdf') && (\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={handleConvertToWord}\n                        disabled={isConverting || isUploading}\n                        className=\"ml-2 h-8 w-8 p-0\"\n                      >\n                        {isConverting ? (\n                          <Loader2 className=\"h-4 w-4 animate-spin text-blue-600 dark:text-blue-400\" />\n                        ) : (\n                          <FileType2 className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                        )}\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>Convert PDF to Word for editing</p>\n                    </TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n              )}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1874, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/lib/services/pdfWordConverter.ts"],"sourcesContent":["import mammoth from 'mammoth';\nimport { \n  Document, \n  Packer, \n  Paragraph, \n  TextRun, \n  HeadingLevel, \n  AlignmentType,\n  Table,\n  TableRow,\n  TableCell,\n  WidthType,\n  BorderStyle,\n  ImageRun,\n  UnderlineType\n} from 'docx';\nimport { PDFDocument, rgb, StandardFonts } from 'pdf-lib';\nimport type { Suggestion } from '../types/proofreader';\n\n// Helper function to load pdfjs dynamically\nasync function loadPdfJs() {\n  const pdfjs = await import('pdfjs-dist');\n  if (typeof window !== 'undefined' && !pdfjs.GlobalWorkerOptions.workerSrc) {\n    pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;\n  }\n  return pdfjs;\n}\n\n/**\n * Sanitize text to replace Unicode characters that can't be encoded in WinAnsi\n * with ASCII equivalents\n */\nfunction sanitizeTextForPdf(text: string): string {\n  // Map of common Unicode characters to ASCII equivalents\n  const unicodeMap: Record<string, string> = {\n    '': '->',\n    '': '<-',\n    '': '^',\n    '': 'v',\n    '': '=>',\n    '': '<=',\n    '': '*',\n    '': '-',\n    '': '--',\n    '': '...',\n    '\\u201C': '\"',\n    '\\u201D': '\"',\n    '\\u2018': \"'\",\n    '\\u2019': \"'\",\n    '': '(c)',\n    '': '(R)',\n    '': '(TM)',\n    '': 'EUR',\n    '': 'GBP',\n    '': 'JPY',\n  };\n\n  let sanitized = text;\n  \n  // Replace known Unicode characters\n  Object.entries(unicodeMap).forEach(([unicode, ascii]) => {\n    sanitized = sanitized.replace(new RegExp(unicode, 'g'), ascii);\n  });\n\n  // Remove any remaining non-ASCII characters that can't be encoded\n  // This regex keeps ASCII printable characters (32-126) and common whitespace (excluding newlines as they're handled separately)\n  sanitized = sanitized.replace(/[^\\x20-\\x7E\\n\\r\\t]/g, '?');\n\n  return sanitized;\n}\n\n/**\n * Convert PDF to HTML for rich text editing\n * Uses pdfjs-dist to extract text with layout preservation\n */\nexport async function convertPdfToHtml(pdfUrl: string): Promise<string> {\n  try {\n    // Dynamically load pdfjs\n    const pdfjs = await loadPdfJs();\n\n    // Load PDF bytes\n    let pdfBytes: ArrayBuffer;\n    \n    if (pdfUrl.startsWith('data:')) {\n      const base64Data = pdfUrl.split(',')[1];\n      const binaryString = atob(base64Data);\n      const bytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n      }\n      pdfBytes = bytes.buffer;\n    } else {\n      const response = await fetch(pdfUrl);\n      pdfBytes = await response.arrayBuffer();\n    }\n\n    const pdf = await pdfjs.getDocument({ data: pdfBytes }).promise;\n    const htmlParts: string[] = [];\n\n    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {\n      try {\n        const page = await pdf.getPage(pageNum);\n        const textContent = await page.getTextContent();\n        \n        // Group text items into paragraphs based on vertical position\n        const lines: { y: number; items: any[] }[] = [];\n        let currentLine: { y: number; items: any[] } | null = null;\n        \n        textContent.items.forEach((item: any) => {\n          const y = item.transform[5];\n          \n          if (!currentLine || Math.abs(currentLine.y - y) > 5) {\n            currentLine = { y, items: [item] };\n            lines.push(currentLine);\n          } else {\n            currentLine.items.push(item);\n          }\n        });\n\n        // Convert lines to HTML paragraphs\n        lines.forEach(line => {\n          const text = line.items.map((item: any) => item.str).join(' ').trim();\n          if (text) {\n            // Detect if it might be a heading (simple heuristic: short lines with larger font)\n            const avgFontSize = line.items.reduce((sum: number, item: any) => \n              sum + (item.height || 12), 0) / line.items.length;\n            \n            if (avgFontSize > 16 && text.length < 100) {\n              htmlParts.push(`<h2>${text}</h2>`);\n            } else {\n              htmlParts.push(`<p>${text}</p>`);\n            }\n          }\n        });\n      } catch (err: any) {\n        // Silently ignore abort/cancellation errors\n        if (err?.name === 'AbortError' || err?.name === 'AbortException' || \n            err?.message?.includes('cancelled') || err?.message?.includes('abort')) {\n          continue;\n        }\n        throw err;\n      }\n    }\n\n    return htmlParts.join('\\n');\n  } catch (error) {\n    console.error('Error converting PDF to HTML:', error);\n    throw new Error('Failed to convert PDF to HTML');\n  }\n}\n\n/**\n * Draw HTML table in PDF\n */\nasync function drawTableInPdf(\n  tableElement: HTMLTableElement,\n  pdfDoc: PDFDocument,\n  currentPage: any,\n  yPosition: number,\n  font: any,\n  boldFont: any,\n  margin: number\n): Promise<{ page: any; yPosition: number }> {\n  const cellPadding = 5;\n  const cellHeight = 25;\n  const pageWidth = 612;\n  const maxWidth = pageWidth - (margin * 2);\n  \n  // Get all rows\n  const allRows = Array.from(tableElement.querySelectorAll('tr'));\n  const numCols = Math.max(...allRows.map(row => row.querySelectorAll('td, th').length));\n  const colWidth = maxWidth / numCols;\n  \n  let page = currentPage;\n  let y = yPosition;\n  \n  for (const row of allRows) {\n    // Check if we need a new page\n    if (y < 50) {\n      page = pdfDoc.addPage([612, 792]);\n      y = 750;\n    }\n    \n    const cells = Array.from(row.querySelectorAll('td, th'));\n    const isHeader = cells[0]?.tagName === 'TH';\n    \n    // Draw cell backgrounds for headers\n    if (isHeader) {\n      page.drawRectangle({\n        x: margin,\n        y: y - cellHeight,\n        width: maxWidth,\n        height: cellHeight,\n        color: rgb(0.9, 0.9, 0.9),\n      });\n    }\n    \n    // Draw cell borders and content\n    cells.forEach((cell, colIndex) => {\n      const x = margin + (colIndex * colWidth);\n      \n      // Draw cell border\n      page.drawRectangle({\n        x,\n        y: y - cellHeight,\n        width: colWidth,\n        height: cellHeight,\n        borderColor: rgb(0, 0, 0),\n        borderWidth: 1,\n      });\n      \n      // Draw cell text\n      let text = cell.textContent?.trim() || '';\n      text = sanitizeTextForPdf(text);\n      \n      // Truncate text if too long\n      const maxTextWidth = colWidth - (cellPadding * 2);\n      const currentFont = isHeader ? boldFont : font;\n      const fontSize = 10;\n      \n      while (currentFont.widthOfTextAtSize(text, fontSize) > maxTextWidth && text.length > 0) {\n        text = text.slice(0, -4) + '...';\n      }\n      \n      page.drawText(text, {\n        x: x + cellPadding,\n        y: y - cellHeight + cellPadding + 5,\n        size: fontSize,\n        font: currentFont,\n        color: rgb(0, 0, 0),\n      });\n    });\n    \n    y -= cellHeight;\n  }\n  \n  return { page, yPosition: y - 10 }; // Add extra spacing after table\n}\n\n/**\n * Embed image in PDF\n */\nasync function embedImageInPdf(\n  imgElement: HTMLImageElement,\n  pdfDoc: PDFDocument,\n  currentPage: any,\n  yPosition: number,\n  margin: number\n): Promise<{ page: any; yPosition: number }> {\n  try {\n    let src = imgElement.src;\n    \n    if (!src.startsWith('data:') && !src.startsWith('http')) {\n      console.warn('Cannot embed relative URL images in PDF:', src);\n      return { page: currentPage, yPosition };\n    }\n    \n    // Fetch image data\n    let imageBytes: Uint8Array;\n    let imageType: 'png' | 'jpg';\n    \n    if (src.startsWith('data:')) {\n      const base64Data = src.split(',')[1];\n      const mimeType = src.split(';')[0].split(':')[1];\n      imageType = mimeType.includes('png') ? 'png' : 'jpg';\n      \n      const binaryString = atob(base64Data);\n      imageBytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        imageBytes[i] = binaryString.charCodeAt(i);\n      }\n    } else {\n      const response = await fetch(src);\n      const arrayBuffer = await response.arrayBuffer();\n      imageBytes = new Uint8Array(arrayBuffer);\n      imageType = src.toLowerCase().endsWith('.png') ? 'png' : 'jpg';\n    }\n    \n    // Embed image\n    const image = imageType === 'png' \n      ? await pdfDoc.embedPng(imageBytes)\n      : await pdfDoc.embedJpg(imageBytes);\n    \n    const imgDims = image.scale(0.5); // Scale down by 50%\n    const maxWidth = 512;\n    const maxHeight = 400;\n    \n    let width = imgDims.width;\n    let height = imgDims.height;\n    \n    // Scale to fit within max dimensions\n    if (width > maxWidth) {\n      height = (height * maxWidth) / width;\n      width = maxWidth;\n    }\n    if (height > maxHeight) {\n      width = (width * maxHeight) / height;\n      height = maxHeight;\n    }\n    \n    // Check if we need a new page\n    let page = currentPage;\n    let y = yPosition;\n    \n    if (y - height < 50) {\n      page = pdfDoc.addPage([612, 792]);\n      y = 750;\n    }\n    \n    // Draw image\n    page.drawImage(image, {\n      x: margin,\n      y: y - height,\n      width,\n      height,\n    });\n    \n    return { page, yPosition: y - height - 10 };\n  } catch (error) {\n    console.error('Error embedding image in PDF:', error);\n    return { page: currentPage, yPosition };\n  }\n}\n\n/**\n * Convert HTML from rich text editor to PDF with full formatting\n */\nexport async function convertHtmlToPdf(html: string): Promise<string> {\n  try {\n    const pdfDoc = await PDFDocument.create();\n    const font = await pdfDoc.embedFont(StandardFonts.Helvetica);\n    const boldFont = await pdfDoc.embedFont(StandardFonts.HelveticaBold);\n    \n    let currentPage = pdfDoc.addPage([612, 792]); // US Letter size\n    let yPosition = 750;\n    const lineHeight = 18;\n    const margin = 50;\n    const maxWidth = 512;\n\n    // Parse HTML into structured content\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n    const elements = doc.body.children;\n\n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i];\n      const tagName = element.tagName.toLowerCase();\n      \n      // Handle tables\n      if (tagName === 'table') {\n        const result = await drawTableInPdf(\n          element as HTMLTableElement,\n          pdfDoc,\n          currentPage,\n          yPosition,\n          font,\n          boldFont,\n          margin\n        );\n        currentPage = result.page;\n        yPosition = result.yPosition;\n        continue;\n      }\n      \n      // Handle images\n      if (tagName === 'img') {\n        const result = await embedImageInPdf(\n          element as HTMLImageElement,\n          pdfDoc,\n          currentPage,\n          yPosition,\n          margin\n        );\n        currentPage = result.page;\n        yPosition = result.yPosition;\n        continue;\n      }\n      \n      // Handle lists\n      if (tagName === 'ul' || tagName === 'ol') {\n        const listItems = Array.from(element.querySelectorAll('li'));\n        listItems.forEach((li, index) => {\n          const bulletText = tagName === 'ul' ? ' ' : `${index + 1}. `;\n          let text = li.textContent?.trim() || '';\n          text = sanitizeTextForPdf(bulletText + text);\n          \n          // Wrap text\n          const words = text.split(' ');\n          let currentLine = '';\n          \n          for (const word of words) {\n            const testLine = currentLine ? `${currentLine} ${word}` : word;\n            const textWidth = font.widthOfTextAtSize(testLine, 12);\n            \n            if (textWidth > maxWidth && currentLine) {\n              if (yPosition < 50) {\n                currentPage = pdfDoc.addPage([612, 792]);\n                yPosition = 750;\n              }\n              \n              currentPage.drawText(currentLine, {\n                x: margin + 20, // Indent list items\n                y: yPosition,\n                size: 12,\n                font: font,\n                color: rgb(0, 0, 0),\n              });\n              \n              yPosition -= lineHeight;\n              currentLine = word;\n            } else {\n              currentLine = testLine;\n            }\n          }\n          \n          if (currentLine) {\n            if (yPosition < 50) {\n              currentPage = pdfDoc.addPage([612, 792]);\n              yPosition = 750;\n            }\n            \n            currentPage.drawText(currentLine, {\n              x: margin + 20,\n              y: yPosition,\n              size: 12,\n              font: font,\n              color: rgb(0, 0, 0),\n            });\n            \n            yPosition -= lineHeight;\n          }\n        });\n        continue;\n      }\n      \n      // Handle regular text elements\n      let text = element.textContent?.trim() || '';\n      if (!text) continue;\n\n      // Sanitize text for PDF encoding\n      text = sanitizeTextForPdf(text);\n\n      // Determine font size and style based on element type\n      let fontSize = 12;\n      let currentFont = font;\n      let spacing = lineHeight;\n\n      if (tagName.startsWith('h')) {\n        const level = parseInt(tagName[1]);\n        fontSize = 24 - (level * 2);\n        currentFont = boldFont;\n        spacing = lineHeight * 1.5;\n      } else if (tagName === 'strong' || tagName === 'b') {\n        currentFont = boldFont;\n      }\n\n      // Split text by newlines first to handle line breaks properly\n      const lines = text.split(/\\r?\\n/);\n      \n      for (const line of lines) {\n        // Wrap text to fit within page width\n        const words = line.split(' ');\n        let currentLine = '';\n\n        for (const word of words) {\n          const testLine = currentLine ? `${currentLine} ${word}` : word;\n          const textWidth = currentFont.widthOfTextAtSize(testLine, fontSize);\n\n          if (textWidth > maxWidth && currentLine) {\n            // Draw current line\n            if (yPosition < 50) {\n              currentPage = pdfDoc.addPage([612, 792]);\n              yPosition = 750;\n            }\n\n            currentPage.drawText(currentLine, {\n              x: margin,\n              y: yPosition,\n              size: fontSize,\n              font: currentFont,\n              color: rgb(0, 0, 0),\n            });\n\n            yPosition -= spacing;\n            currentLine = word;\n          } else {\n            currentLine = testLine;\n          }\n        }\n\n        // Draw remaining text\n        if (currentLine) {\n          if (yPosition < 50) {\n            currentPage = pdfDoc.addPage([612, 792]);\n            yPosition = 750;\n          }\n\n          currentPage.drawText(currentLine, {\n            x: margin,\n            y: yPosition,\n            size: fontSize,\n            font: currentFont,\n            color: rgb(0, 0, 0),\n          });\n\n          yPosition -= spacing;\n        } else if (line === '') {\n          // Handle empty lines (preserve blank lines)\n          yPosition -= spacing;\n        }\n      }\n\n      // Add extra spacing after headings\n      if (tagName.startsWith('h')) {\n        yPosition -= lineHeight * 0.5;\n      }\n    }\n\n    const pdfBytes = await pdfDoc.save();\n    const base64 = btoa(String.fromCharCode(...pdfBytes));\n    return `data:application/pdf;base64,${base64}`;\n  } catch (error) {\n    console.error('Error converting HTML to PDF:', error);\n    throw new Error('Failed to convert HTML to PDF');\n  }\n}\n\n/**\n * Convert Word document to PDF (legacy compatibility)\n */\nexport async function convertWordToPdf(wordBlob: Blob): Promise<string> {\n  try {\n    const html = await wordBlobToHtml(wordBlob);\n    return await convertHtmlToPdf(html);\n  } catch (error) {\n    console.error('Error converting Word to PDF:', error);\n    throw new Error('Failed to convert Word document to PDF');\n  }\n}\n\n/**\n * Apply suggestions to Word document content\n */\nexport function applySuggestionsToWordContent(\n  wordContent: string,\n  suggestions: Suggestion[]\n): string {\n  let modifiedContent = wordContent;\n  \n  suggestions.forEach(suggestion => {\n    // Replace original text with suggestion\n    const originalText = suggestion.original || suggestion.text;\n    const regex = new RegExp(originalText.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'gi');\n    modifiedContent = modifiedContent.replace(regex, suggestion.suggestion);\n  });\n  \n  return modifiedContent;\n}\n\n/**\n * Convert Word Blob to HTML string for editing\n */\nexport async function wordBlobToHtml(wordBlob: Blob): Promise<string> {\n  try {\n    const arrayBuffer = await wordBlob.arrayBuffer();\n    const result = await mammoth.convertToHtml({ arrayBuffer });\n    return result.value;\n  } catch (error) {\n    console.error('Error converting Word to HTML:', error);\n    throw new Error('Failed to convert Word document to HTML');\n  }\n}\n\n/**\n * Parse inline styles and return text run options\n */\nfunction parseTextRunStyles(element: Element): any {\n  const style = element.getAttribute('style') || '';\n  const computedStyle = window.getComputedStyle(element);\n  const options: any = {};\n\n  // Bold\n  if (element.tagName === 'STRONG' || element.tagName === 'B' || \n      computedStyle.fontWeight === 'bold' || parseInt(computedStyle.fontWeight) >= 700) {\n    options.bold = true;\n  }\n\n  // Italic\n  if (element.tagName === 'EM' || element.tagName === 'I' || \n      computedStyle.fontStyle === 'italic') {\n    options.italics = true;\n  }\n\n  // Underline\n  if (element.tagName === 'U' || computedStyle.textDecoration.includes('underline')) {\n    options.underline = { type: UnderlineType.SINGLE };\n  }\n\n  // Font size (convert from px to points - 12pt = 16px)\n  const fontSize = parseInt(computedStyle.fontSize);\n  if (fontSize && fontSize > 0) {\n    options.size = Math.round((fontSize * 72) / 96); // Convert pixels to points\n  }\n\n  return options;\n}\n\n/**\n * Process text node with inline formatting\n */\nfunction processTextNode(node: Node, parentElement: Element): TextRun[] {\n  const runs: TextRun[] = [];\n  \n  if (node.nodeType === Node.TEXT_NODE) {\n    const text = node.textContent || '';\n    if (text.trim()) {\n      const styles = parseTextRunStyles(parentElement);\n      runs.push(new TextRun({ text, ...styles }));\n    }\n  } else if (node.nodeType === Node.ELEMENT_NODE) {\n    const element = node as Element;\n    const styles = parseTextRunStyles(element);\n    \n    // Process child nodes recursively\n    Array.from(element.childNodes).forEach(child => {\n      if (child.nodeType === Node.TEXT_NODE) {\n        const text = child.textContent || '';\n        if (text.trim()) {\n          runs.push(new TextRun({ text, ...styles }));\n        }\n      } else {\n        runs.push(...processTextNode(child, element));\n      }\n    });\n  }\n  \n  return runs;\n}\n\n/**\n * Convert HTML table to Word Table\n */\nasync function htmlTableToWordTable(tableElement: HTMLTableElement): Promise<Table> {\n  const rows: TableRow[] = [];\n  \n  // Process all rows (including thead and tbody)\n  const allRows = Array.from(tableElement.querySelectorAll('tr'));\n  \n  for (const row of allRows) {\n    const cells: TableCell[] = [];\n    const cellElements = Array.from(row.querySelectorAll('td, th'));\n    \n    for (const cell of cellElements) {\n      const isHeader = cell.tagName === 'TH';\n      const textRuns: TextRun[] = [];\n      \n      // Get cell text with formatting\n      Array.from(cell.childNodes).forEach(node => {\n        const runs = processTextNode(node, cell);\n        textRuns.push(...runs);\n      });\n      \n      // If no formatted text, just get plain text\n      if (textRuns.length === 0) {\n        const text = cell.textContent?.trim() || '';\n        textRuns.push(new TextRun({ \n          text, \n          bold: isHeader \n        }));\n      }\n      \n      cells.push(\n        new TableCell({\n          children: [new Paragraph({ children: textRuns })],\n          shading: isHeader ? {\n            fill: 'E7E7E7', // Light gray for headers\n          } : undefined,\n        })\n      );\n    }\n    \n    rows.push(new TableRow({ children: cells }));\n  }\n  \n  return new Table({\n    rows,\n    width: {\n      size: 100,\n      type: WidthType.PERCENTAGE,\n    },\n    borders: {\n      top: { style: BorderStyle.SINGLE, size: 1 },\n      bottom: { style: BorderStyle.SINGLE, size: 1 },\n      left: { style: BorderStyle.SINGLE, size: 1 },\n      right: { style: BorderStyle.SINGLE, size: 1 },\n      insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },\n      insideVertical: { style: BorderStyle.SINGLE, size: 1 },\n    },\n  });\n}\n\n/**\n * Convert image to base64 and create ImageRun\n */\nasync function htmlImageToWordImage(imgElement: HTMLImageElement): Promise<ImageRun | null> {\n  try {\n    // Get image source\n    let src = imgElement.src;\n    \n    // If it's a relative URL, we can't load it in the browser context\n    if (!src.startsWith('data:') && !src.startsWith('http')) {\n      console.warn('Cannot embed relative URL images:', src);\n      return null;\n    }\n    \n    // Fetch image as blob\n    let imageBytes: Uint8Array;\n    \n    if (src.startsWith('data:')) {\n      // Extract base64 data\n      const base64Data = src.split(',')[1];\n      const binaryString = atob(base64Data);\n      imageBytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        imageBytes[i] = binaryString.charCodeAt(i);\n      }\n    } else {\n      // Fetch from URL\n      const response = await fetch(src);\n      const arrayBuffer = await response.arrayBuffer();\n      imageBytes = new Uint8Array(arrayBuffer);\n    }\n    \n    // Get image dimensions\n    const width = imgElement.width || 400;\n    const height = imgElement.height || 300;\n    \n    // Determine image type from src\n    const imageType = src.toLowerCase().includes('png') ? 'png' : 'jpg';\n    \n    return new ImageRun({\n      data: imageBytes,\n      type: imageType,\n      transformation: {\n        width: Math.min(width, 600), // Max width 600px\n        height: Math.min(height, 450), // Max height 450px\n      },\n    }) as any;\n  } catch (error) {\n    console.error('Error embedding image:', error);\n    return null;\n  }\n}\n\n/**\n * Process HTML element and convert to Word elements\n */\nasync function processHtmlElement(element: Element): Promise<any[]> {\n  const wordElements: any[] = [];\n  const tagName = element.tagName.toLowerCase();\n  \n  // Handle tables\n  if (tagName === 'table') {\n    const table = await htmlTableToWordTable(element as HTMLTableElement);\n    wordElements.push(table);\n    return wordElements;\n  }\n  \n  // Handle images\n  if (tagName === 'img') {\n    const imageRun = await htmlImageToWordImage(element as HTMLImageElement);\n    if (imageRun) {\n      wordElements.push(new Paragraph({ children: [imageRun] }));\n    }\n    return wordElements;\n  }\n  \n  // Handle lists\n  if (tagName === 'ul' || tagName === 'ol') {\n    const listItems = Array.from(element.querySelectorAll('li'));\n    listItems.forEach((li, index) => {\n      const textRuns: TextRun[] = [];\n      Array.from(li.childNodes).forEach(node => {\n        const runs = processTextNode(node, li);\n        textRuns.push(...runs);\n      });\n      \n      if (textRuns.length === 0) {\n        const text = li.textContent?.trim() || '';\n        textRuns.push(new TextRun({ text }));\n      }\n      \n      const bulletText = tagName === 'ul' ? ' ' : `${index + 1}. `;\n      textRuns.unshift(new TextRun({ text: bulletText }));\n      \n      wordElements.push(new Paragraph({ children: textRuns }));\n    });\n    return wordElements;\n  }\n  \n  // Handle regular paragraphs and headings\n  const text = element.textContent?.trim() || '';\n  if (!text && tagName !== 'br') return wordElements;\n  \n  // Create paragraph options\n  const paragraphOptions: any = { children: [] };\n  \n  // Handle headings\n  if (tagName === 'h1') {\n    paragraphOptions.heading = HeadingLevel.HEADING_1;\n  } else if (tagName === 'h2') {\n    paragraphOptions.heading = HeadingLevel.HEADING_2;\n  } else if (tagName === 'h3') {\n    paragraphOptions.heading = HeadingLevel.HEADING_3;\n  } else if (tagName === 'h4') {\n    paragraphOptions.heading = HeadingLevel.HEADING_4;\n  }\n  \n  // Handle text alignment\n  const style = element.getAttribute('style') || '';\n  const computedStyle = window.getComputedStyle(element);\n  const textAlign = computedStyle.textAlign;\n  \n  if (textAlign === 'center' || style.includes('text-align: center')) {\n    paragraphOptions.alignment = AlignmentType.CENTER;\n  } else if (textAlign === 'right' || style.includes('text-align: right')) {\n    paragraphOptions.alignment = AlignmentType.RIGHT;\n  } else if (textAlign === 'justify' || style.includes('text-align: justify')) {\n    paragraphOptions.alignment = AlignmentType.JUSTIFIED;\n  }\n  \n  // Process text with inline formatting\n  const textRuns: TextRun[] = [];\n  Array.from(element.childNodes).forEach(node => {\n    const runs = processTextNode(node, element);\n    textRuns.push(...runs);\n  });\n  \n  // If no formatted text, just use plain text\n  if (textRuns.length === 0 && text) {\n    textRuns.push(new TextRun({ text }));\n  }\n  \n  if (textRuns.length > 0) {\n    paragraphOptions.children = textRuns;\n    wordElements.push(new Paragraph(paragraphOptions));\n  }\n  \n  return wordElements;\n}\n\n/**\n * Convert HTML string to Word Blob with full formatting preservation\n */\nexport async function htmlToWordBlob(htmlContent: string): Promise<Blob> {\n  try {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(htmlContent, 'text/html');\n    const wordElements: any[] = [];\n    \n    // Process each top-level element in the HTML body\n    const elements = Array.from(doc.body.children);\n    \n    for (const element of elements) {\n      const processed = await processHtmlElement(element);\n      wordElements.push(...processed);\n    }\n    \n    // Create Word document with processed elements\n    const wordDoc = new Document({\n      sections: [\n        {\n          properties: {\n            page: {\n              margin: {\n                top: 1440, // 1 inch = 1440 twentieths of a point\n                right: 1440,\n                bottom: 1440,\n                left: 1440,\n              },\n            },\n          },\n          children: wordElements.length > 0 ? wordElements : [\n            new Paragraph({\n              children: [new TextRun({ text: '' })],\n            }),\n          ],\n        },\n      ],\n    });\n\n    return await Packer.toBlob(wordDoc);\n  } catch (error) {\n    console.error('Error converting HTML to Word:', error);\n    throw new Error('Failed to convert HTML to Word document');\n  }\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2683, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/app/compliance-editor/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useRef } from 'react';\nimport { motion } from 'framer-motion';\nimport { Download, FileText, FileType2, Save, Share2 } from 'lucide-react';\nimport { toast } from 'sonner';\n\n// Components\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport TinyMCEEditor, { type TinyMCEEditorHandle } from '@/components/editor/TinyMCEEditor';\n\n// Compliance Components\nimport SuggestionCard, { type ComplianceSuggestion } from '@/components/compliance/SuggestionCard';\nimport DocumentUpload from '@/components/compliance/DocumentUpload';\n\n// Services\nimport { htmlToWordBlob, convertHtmlToPdf } from '@/lib/services/pdfWordConverter';\nimport type { Suggestion } from '@/lib/types/proofreader';\nimport { findTextLocation, type PdfPageText, type HighlightInfo } from '@/lib/pdf-utils';\n\n// Dynamic import for PDF viewer (uses pdfjs which requires browser APIs)\nimport dynamic from 'next/dynamic';\nimport { Loader2 } from 'lucide-react';\n\nconst PdfViewerWithHighlight = dynamic(\n  () => import('@/components/compliance/PdfViewerWithHighlight'),\n  { \n    ssr: false,\n    loading: () => (\n      <div className=\"flex items-center justify-center h-full bg-zinc-100 dark:bg-zinc-950\">\n        <div className=\"flex flex-col items-center gap-3\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-zinc-600 dark:text-zinc-400\" />\n          <p className=\"text-sm text-zinc-600 dark:text-zinc-400\">Loading PDF viewer...</p>\n        </div>\n      </div>\n    )\n  }\n);\n\nexport default function ComplianceEditorPage() {\n  // State\n  const [documentId, setDocumentId] = useState<string | null>(null);\n  const [documentName, setDocumentName] = useState<string>('');\n  const [fileType, setFileType] = useState<'pdf' | 'docx' | null>(null);\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null);\n  const [editorContent, setEditorContent] = useState<string>('');\n  const [suggestions, setSuggestions] = useState<ComplianceSuggestion[]>([]);\n  const [selectedSuggestionIndex, setSelectedSuggestionIndex] = useState<number | null>(null);\n  const [isApplying, setIsApplying] = useState<number | null>(null);\n  const [isConverting, setIsConverting] = useState(false);\n  const [showUpload, setShowUpload] = useState(true);\n  const [highlightInfo, setHighlightInfo] = useState<HighlightInfo | null>(null);\n\n  const editorRef = useRef<TinyMCEEditorHandle>(null);\n\n  // Convert ComplianceSuggestion to Suggestion type for TinyMCE\n  const editorSuggestions: Suggestion[] = suggestions.map(s => ({\n    issue: s.explanation,\n    page: s.page || 1,\n    text: s.originalText,\n    suggestion: s.suggestedText,\n    original: s.originalText,\n    explanation: s.explanation,\n    category: s.category.toLowerCase() as 'grammar' | 'compliance' | 'style',\n    severity: s.severity as 'critical' | 'warning' | 'suggestion',\n  }));\n\n  // Handle successful document upload\n  const handleUploadSuccess = (data: {\n    documentId: string;\n    fileType: 'pdf' | 'docx';\n    htmlContent: string;\n    extractedText: string;\n    suggestions: any[];\n    pdfUrl?: string;\n    fileName?: string;\n  }) => {\n    console.log(' Upload success! Document data:', {\n      documentId: data.documentId,\n      fileType: data.fileType,\n      hasHtmlContent: !!data.htmlContent,\n      htmlContentLength: data.htmlContent?.length || 0,\n      extractedTextLength: data.extractedText?.length || 0,\n      suggestionsCount: data.suggestions?.length || 0,\n      hasPdfUrl: !!data.pdfUrl,\n      fileName: data.fileName,\n    });\n    \n    if (data.suggestions && data.suggestions.length > 0) {\n      console.log('Sample suggestion:', data.suggestions[0]);\n    } else {\n      console.log(' No suggestions received from API');\n      console.log('Extracted text preview:', data.extractedText?.substring(0, 200));\n    }\n    \n    setDocumentId(data.documentId);\n    setDocumentName(data.fileName || 'document');\n    setFileType(data.fileType);\n    setEditorContent(data.htmlContent);\n    setPdfUrl(data.pdfUrl || null);\n    setSuggestions(data.suggestions.map((s, idx) => ({ ...s, id: `sugg-${idx}` })));\n    setShowUpload(false);\n\n    toast.success(`Document analyzed! Found ${data.suggestions.length} suggestions.`);\n  };\n\n  // Handle upload error\n  const handleUploadError = (error: string) => {\n    toast.error('Upload failed', {\n      description: error\n    });\n  };\n\n  // Handle suggestion selection\n  const handleSelectSuggestion = (index: number) => {\n    setSelectedSuggestionIndex(index);\n    const suggestion = suggestions[index];\n    \n    if (suggestion) {\n      if (fileType === 'pdf' && pdfUrl) {\n        // For PDF: Create highlight info\n        // In a real implementation, you would calculate the bounding box from the PDF\n        setHighlightInfo({\n          pageNumber: suggestion.page || 1,\n          text: suggestion.originalText,\n          boundingBox: undefined, // Would be calculated from PDF text positions\n        });\n      } else if (editorRef.current) {\n        // For DOCX: Highlight text in editor\n        editorRef.current.highlightText(suggestion.originalText);\n      }\n    }\n  };\n\n  // Handle applying suggestion\n  const handleApplySuggestion = async (index: number) => {\n    const suggestion = suggestions[index];\n    if (!suggestion || !documentId) return;\n\n    // For PDF files that haven't been converted, show conversion prompt\n    if (fileType === 'pdf') {\n      toast.info('Convert to edit', {\n        description: 'Click \"Convert to Word\" to enable editing and apply suggestions.'\n      });\n      \n      // Mark as acknowledged\n      setSuggestions(prev =>\n        prev.map((s, i) => (i === index ? { ...s, isApplied: true } : s))\n      );\n      return;\n    }\n\n    // For documents in the editor (DOCX or converted PDF)\n    if (!editorRef.current) return;\n\n    setIsApplying(index);\n\n    try {\n      // Call API to apply change\n      const response = await fetch('/api/compliance/apply-change', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          documentId,\n          originalText: suggestion.originalText,\n          suggestedText: suggestion.suggestedText,\n          suggestionId: suggestion.id,\n          fileType,\n          documentData: pdfUrl || undefined, // Send document data if available\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to apply change');\n      }\n\n      const data = await response.json();\n\n      // Replace text in editor\n      editorRef.current.replaceText(suggestion.originalText, suggestion.suggestedText);\n      \n      // Update editor content\n      const newContent = editorRef.current.getContent();\n      setEditorContent(newContent);\n\n      // Mark suggestion as applied\n      setSuggestions(prev =>\n        prev.map((s, i) => (i === index ? { ...s, isApplied: true } : s))\n      );\n\n      toast.success('Change applied successfully');\n\n      // Clear selection\n      if (selectedSuggestionIndex === index) {\n        setSelectedSuggestionIndex(null);\n      }\n    } catch (error) {\n      console.error('Error applying suggestion:', error);\n      toast.error('Failed to apply change');\n    } finally {\n      setIsApplying(null);\n    }\n  };\n\n  // Analyze current editor content for compliance\n  const handleAnalyzeContent = async () => {\n    if (!editorRef.current) {\n      toast.error('No content to analyze');\n      return;\n    }\n\n    const loadingToast = toast.loading('Analyzing content for compliance...');\n\n    try {\n      // Get current editor content\n      const currentContent = editorRef.current.getContent();\n      \n      // Extract plain text from HTML\n      const tempDiv = document.createElement('div');\n      tempDiv.innerHTML = currentContent;\n      const plainText = tempDiv.textContent || tempDiv.innerText || '';\n\n      console.log(' Analyzing editor content...', {\n        htmlLength: currentContent.length,\n        textLength: plainText.length,\n        textPreview: plainText.substring(0, 200)\n      });\n\n      // Create a temporary file from the content to send to the API\n      const blob = new Blob([plainText], { type: 'text/plain' });\n      const file = new File([blob], 'editor-content.txt', { type: 'text/plain' });\n      \n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('isPlainText', 'true'); // Flag to indicate plain text analysis\n\n      const response = await fetch('/api/compliance/analyze', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to analyze content');\n      }\n\n      const data = await response.json();\n      \n      console.log(' Analysis complete:', {\n        suggestionsCount: data.suggestions?.length || 0\n      });\n\n      // Update suggestions\n      setSuggestions(data.suggestions.map((s: any, idx: number) => ({ ...s, id: `sugg-${idx}` })));\n      \n      toast.success(`Analysis complete! Found ${data.suggestions.length} suggestions.`, { \n        id: loadingToast \n      });\n    } catch (err) {\n      console.error('Analysis error:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error';\n      toast.error('Failed to analyze content', {\n        description: errorMessage,\n        id: loadingToast\n      });\n    }\n  };\n\n  // Convert PDF to Word and display in editor\n  const handleConvertToWord = async () => {\n    if (fileType !== 'pdf' || !pdfUrl) {\n      toast.error('PDF not available for conversion');\n      return;\n    }\n\n    setIsConverting(true);\n    const loadingToast = toast.loading('Converting PDF to Word format...');\n\n    try {\n      console.log(' Converting PDF to editable format...');\n      \n      // Convert data URL to blob\n      const response = await fetch(pdfUrl);\n      const pdfBlob = await response.blob();\n      \n      // Create form data with the PDF file\n      const formData = new FormData();\n      formData.append('file', pdfBlob, documentName || 'document.pdf');\n      \n      // Call the PDF to DOCX conversion API with the actual file\n      const convertResponse = await fetch('/api/convert/pdf-to-docx', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!convertResponse.ok) {\n        const responseText = await convertResponse.text();\n        console.error(' Conversion API error:', responseText);\n        let errorMessage = 'Conversion failed';\n        let errorDetails = '';\n        \n        try {\n          const errorData = JSON.parse(responseText);\n          errorMessage = errorData.message || errorData.error || errorMessage;\n          errorDetails = errorData.details || '';\n          \n          // Show a more helpful message to the user\n          if (errorDetails.includes('Network error') || errorDetails.includes('timeout')) {\n            errorMessage = 'Network timeout - conversion taking too long';\n            errorDetails = 'The PDF conversion service is temporarily slow. Please try again, or try with a smaller PDF file.';\n          } else if (errorDetails.includes('credentials')) {\n            errorMessage = 'Configuration error';\n            errorDetails = 'Please contact support - PDF conversion service needs configuration.';\n          } else if (errorData.fallbackError) {\n            // Both Adobe and fallback failed\n            errorMessage = 'Unable to convert this PDF';\n            errorDetails = 'This PDF may be encrypted, corrupted, or in an unsupported format. Please try a different PDF file.';\n          }\n        } catch (e) {\n          errorMessage = 'Conversion failed';\n          errorDetails = responseText.substring(0, 200);\n        }\n        \n        // Show detailed toast with retry suggestion\n        toast.error(errorMessage, {\n          description: errorDetails,\n          duration: 7000,\n          id: loadingToast\n        });\n        \n        throw new Error(errorMessage);\n      }\n      \n      console.log(' Conversion successful, loading into editor...');\n      \n      // Get the DOCX blob\n      const docxBlob = await convertResponse.blob();\n      \n      // Convert DOCX to HTML for the editor with enhanced formatting options\n      const mammoth = await import('mammoth');\n      const arrayBuffer = await docxBlob.arrayBuffer();\n      \n      // Configure mammoth to preserve formatting and styles\n      const result = await mammoth.convertToHtml(\n        { arrayBuffer },\n        {\n          styleMap: [\n            \"p[style-name='Heading 1'] => h1:fresh\",\n            \"p[style-name='Heading 2'] => h2:fresh\",\n            \"p[style-name='Heading 3'] => h3:fresh\",\n            \"p[style-name='Heading 4'] => h4:fresh\",\n            \"p[style-name='Title'] => h1.title:fresh\",\n            \"r[style-name='Strong'] => strong\",\n            \"r[style-name='Emphasis'] => em\",\n            \"p[style-name='List Paragraph'] => p.list-paragraph:fresh\",\n          ],\n          includeDefaultStyleMap: true,\n          includeEmbeddedStyleMap: true,\n          convertImage: mammoth.images.imgElement((image) => {\n            return image.read(\"base64\").then((imageBuffer) => {\n              return {\n                src: `data:${image.contentType};base64,${imageBuffer}`,\n                style: \"max-width: 100%; height: auto; display: block; margin: 1rem auto;\"\n              };\n            });\n          })\n        }\n      );\n      \n      let htmlContent = result.value;\n      \n      // Post-process HTML to improve table and image formatting\n      htmlContent = htmlContent\n        // Add styling to tables (handle both with and without existing attributes)\n        .replace(/<table([^>]*)>/gi, (match, attrs) => {\n          // Check if style already exists\n          if (attrs.includes('style=')) {\n            return match; // Keep existing style\n          }\n          return `<table${attrs} style=\"border-collapse: collapse; width: 100%; margin: 1.5rem 0; border: 1px solid #3f3f46; background-color: #27272a;\">`;\n        })\n        .replace(/<td([^>]*)>/gi, (match, attrs) => {\n          if (attrs.includes('style=')) {\n            return match;\n          }\n          return `<td${attrs} style=\"border: 1px solid #3f3f46; padding: 10px 16px; vertical-align: top; color: #e4e4e7;\">`;\n        })\n        .replace(/<th([^>]*)>/gi, (match, attrs) => {\n          if (attrs.includes('style=')) {\n            return match;\n          }\n          return `<th${attrs} style=\"border: 1px solid #52525b; padding: 12px 16px; background-color: #3f3f46; font-weight: 600; text-align: left; color: #f8fafc;\">`;\n        })\n        // Ensure images are properly contained\n        .replace(/<img([^>]*?)>/gi, (match, attrs) => {\n          // Preserve existing attributes but ensure proper styling\n          if (!attrs.includes('style=')) {\n            return `<img${attrs} style=\"max-width: 100%; height: auto; display: block; margin: 1.5rem auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);\">`;\n          }\n          return match;\n        })\n        // Add spacing to paragraphs if no style exists\n        .replace(/<p([^>]*)>/gi, (match, attrs) => {\n          if (attrs.includes('style=')) {\n            return match;\n          }\n          return `<p${attrs} style=\"margin: 0.5rem 0; line-height: 1.6;\">`;\n        })\n        // Handle lists better\n        .replace(/<ul([^>]*)>/gi, (match, attrs) => {\n          if (attrs.includes('style=')) {\n            return match;\n          }\n          return `<ul${attrs} style=\"margin: 1rem 0; padding-left: 2rem;\">`;\n        })\n        .replace(/<ol([^>]*)>/gi, (match, attrs) => {\n          if (attrs.includes('style=')) {\n            return match;\n          }\n          return `<ol${attrs} style=\"margin: 1rem 0; padding-left: 2rem;\">`;\n        })\n        .replace(/<li([^>]*)>/gi, (match, attrs) => {\n          if (attrs.includes('style=')) {\n            return match;\n          }\n          return `<li${attrs} style=\"margin: 0.5rem 0; line-height: 1.6;\">`;\n        });\n      \n      // Log any conversion messages (warnings about unsupported features)\n      if (result.messages.length > 0) {\n        console.log('Conversion messages:', result.messages);\n      }\n      \n      // Switch to editor mode\n      setEditorContent(htmlContent);\n      setFileType('docx');\n      setPdfUrl(null); // Clear PDF URL to switch to editor view\n      \n      toast.success('Document converted successfully!', { \n        id: loadingToast,\n        description: 'Your document is now ready for editing.',\n        duration: 4000\n      });\n    } catch (err) {\n      console.error('Conversion error:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error';\n      \n      // Only show toast if we haven't shown one already (check if loadingToast still exists)\n      // The error handling above already shows a detailed toast\n      if (errorMessage === 'Unknown error') {\n        toast.error('Failed to convert PDF', {\n          description: 'An unexpected error occurred. Please try again.',\n          id: loadingToast\n        });\n      }\n    } finally {\n      setIsConverting(false);\n    }\n  };\n\n  // Download as Word file\n  const handleDownloadWord = async () => {\n    const loadingToast = toast.loading('Preparing download...');\n    \n    try {\n      if (fileType === 'pdf' && pdfUrl) {\n        // For PDF files, convert and download\n        toast.loading('Converting PDF to Word...', { id: loadingToast });\n        \n        // Convert data URL to blob\n        const response = await fetch(pdfUrl);\n        const pdfBlob = await response.blob();\n        \n        // Create form data with the PDF file\n        const formData = new FormData();\n        formData.append('file', pdfBlob, documentName || 'document.pdf');\n        \n        const convertResponse = await fetch('/api/convert/pdf-to-docx', {\n          method: 'POST',\n          body: formData,\n        });\n        \n        if (!convertResponse.ok) {\n          const responseText = await convertResponse.text();\n          console.error(' Download conversion error:', responseText);\n          \n          let errorMessage = 'Failed to convert PDF to Word';\n          try {\n            const errorData = JSON.parse(responseText);\n            if (errorData.details && errorData.details.includes('timeout')) {\n              errorMessage = 'Conversion timeout - please try again or use a smaller file';\n            } else if (errorData.fallbackError) {\n              errorMessage = 'Unable to convert this PDF - it may be encrypted or corrupted';\n            }\n          } catch (e) {\n            // Use default error message\n          }\n          \n          throw new Error(errorMessage);\n        }\n        \n        const docxBlob = await convertResponse.blob();\n        const url = URL.createObjectURL(docxBlob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `${documentName || 'document'}_converted.docx`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n        \n        toast.success('Word document downloaded', { id: loadingToast });\n      } else if (editorRef.current) {\n        // For documents in editor\n        const content = editorRef.current.getContent();\n        const blob = await htmlToWordBlob(content);\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `${documentName || 'document'}_edited.docx`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n        \n        toast.success('Word document downloaded', { id: loadingToast });\n      } else {\n        toast.error('No content to download', { id: loadingToast });\n      }\n    } catch (err) {\n      console.error('Download error:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to download Word document';\n      toast.error('Download failed', {\n        description: errorMessage,\n        id: loadingToast\n      });\n    }\n  };\n\n  // Download as PDF\n  const handleDownloadPdf = async () => {\n    try {\n      if (fileType === 'pdf' && pdfUrl) {\n        // For PDF files, download the original\n        const a = document.createElement('a');\n        a.href = pdfUrl;\n        a.download = `${documentName || 'document'}.pdf`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        \n        toast.success('PDF downloaded');\n      } else if (editorRef.current) {\n        // For DOCX files in editor, convert to PDF\n        const content = editorRef.current.getContent();\n        const pdfDataUrl = await convertHtmlToPdf(content);\n        const a = document.createElement('a');\n        a.href = pdfDataUrl;\n        a.download = `${documentName || 'document'}_edited.pdf`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        \n        toast.success('Document downloaded as PDF');\n      } else {\n        toast.error('No content to download');\n      }\n    } catch (err) {\n      console.error('Download error:', err);\n      toast.error('Failed to download PDF');\n    }\n  };\n\n  // Reset to upload new document\n  const handleNewDocument = () => {\n    setDocumentId(null);\n    setDocumentName('');\n    setFileType(null);\n    setPdfUrl(null);\n    setEditorContent('');\n    setSuggestions([]);\n    setSelectedSuggestionIndex(null);\n    setHighlightInfo(null);\n    setShowUpload(true);\n  };\n\n  // Handle save draft\n  const handleSaveDraft = async () => {\n    if (!documentId) {\n      toast.error('No document to save');\n      return;\n    }\n\n    const loadingToast = toast.loading('Saving draft...');\n    \n    try {\n      // Update document in database to mark it as saved/updated\n      const response = await fetch(`/api/documents/${documentId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          originalName: documentName || 'Untitled Document',\n          fileType: fileType || 'pdf',\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Failed to save draft');\n      }\n\n      const result = await response.json();\n      \n      // Also save to localStorage for backward compatibility\n      if (typeof window !== 'undefined') {\n        const content = editorRef.current?.getContent() || editorContent;\n        const draftData = {\n          documentId,\n          documentName,\n          fileType,\n          content,\n          suggestions: suggestions.filter(s => !s.isApplied),\n          timestamp: new Date().toISOString(),\n        };\n        \n        const drafts = JSON.parse(localStorage.getItem('documentDrafts') || '[]');\n        const existingIndex = drafts.findIndex((d: any) => d.documentId === documentId);\n        \n        if (existingIndex >= 0) {\n          drafts[existingIndex] = draftData;\n        } else {\n          drafts.push(draftData);\n        }\n        \n        localStorage.setItem('documentDrafts', JSON.stringify(drafts));\n        \n        // Dispatch event to notify dashboard to refresh\n        window.dispatchEvent(new Event('documentsUpdated'));\n      }\n      \n      toast.success('Draft saved successfully', { id: loadingToast });\n    } catch (err) {\n      console.error('Error saving draft:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to save draft';\n      toast.error(errorMessage, { id: loadingToast });\n    }\n  };\n\n  // Handle share document\n  const handleShareDocument = async () => {\n    if (!documentId) {\n      toast.error('No document to share');\n      return;\n    }\n\n    try {\n      // Create a shareable link\n      const shareUrl = `${window.location.origin}/compliance-editor?documentId=${documentId}`;\n      \n      // Try to use Web Share API if available\n      if (navigator.share) {\n        await navigator.share({\n          title: documentName || 'Document',\n          text: 'Check out this compliance document',\n          url: shareUrl,\n        });\n        toast.success('Document shared');\n      } else {\n        // Fallback: copy to clipboard\n        await navigator.clipboard.writeText(shareUrl);\n        toast.success('Link copied to clipboard');\n      }\n    } catch (err) {\n      // User cancelled or error occurred\n      if (err instanceof Error && err.name !== 'AbortError') {\n        console.error('Error sharing document:', err);\n        toast.error('Failed to share document');\n      }\n    }\n  };\n\n  // Group suggestions by category\n  const groupedSuggestions = suggestions.reduce((acc, suggestion, index) => {\n    const category = suggestion.category || 'Other';\n    if (!acc[category]) {\n      acc[category] = [];\n    }\n    acc[category].push({ ...suggestion, index });\n    return acc;\n  }, {} as Record<string, Array<ComplianceSuggestion & { index: number }>>);\n\n  // Calculate statistics\n  const totalSuggestions = suggestions.length;\n  const appliedSuggestions = suggestions.filter(s => s.isApplied).length;\n  const criticalIssues = suggestions.filter(s => s.severity === 'critical' && !s.isApplied).length;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.5 }}\n      className=\"min-h-screen bg-zinc-50 dark:bg-zinc-950 p-4 sm:p-6 lg:p-8\"\n    >\n      <div className=\"max-w-[1800px] mx-auto\">\n        {/* Header */}\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-50 mb-2\">\n            Financial Compliance Editor\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Upload documents for FINRA/SEC compliance review and real-time editing\n          </p>\n        </div>\n\n        {/* Upload View */}\n        {showUpload && (\n          <div className=\"max-w-2xl mx-auto\">\n            <DocumentUpload\n              onUploadSuccess={handleUploadSuccess}\n              onError={handleUploadError}\n            />\n          </div>\n        )}\n\n        {/* Editor View */}\n        {!showUpload && documentId && (\n          <>\n            {/* Stats Bar */}\n            <div className=\"mb-4 flex flex-wrap items-center justify-between gap-4\">\n              <div className=\"flex items-center gap-3\">\n                <Badge variant=\"outline\" className=\"text-sm\">\n                  <FileText className=\"h-3 w-3 mr-1\" />\n                  Document #{documentId}\n                </Badge>\n                <Badge variant=\"secondary\" className=\"text-sm\">\n                  {totalSuggestions} Total Suggestions\n                </Badge>\n                <Badge variant=\"default\" className=\"text-sm bg-green-600\">\n                  {appliedSuggestions} Applied\n                </Badge>\n                {criticalIssues > 0 && (\n                  <Badge variant=\"destructive\" className=\"text-sm\">\n                    {criticalIssues} Critical Issues\n                  </Badge>\n                )}\n              </div>\n              <div className=\"flex gap-2\">\n                {fileType === 'pdf' && (\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    onClick={handleConvertToWord}\n                    disabled={isConverting}\n                    className=\"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/40 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {isConverting ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin text-blue-600 dark:text-blue-400\" />\n                        Converting\n                      </>\n                    ) : (\n                      <>\n                        <FileType2 className=\"h-4 w-4 mr-2 text-blue-600 dark:text-blue-400\" />\n                        Convert to Word\n                      </>\n                    )}\n                  </Button>\n                )}\n                {fileType === 'docx' && (\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    onClick={handleAnalyzeContent}\n                    disabled={isConverting}\n                    className=\"bg-purple-50 dark:bg-purple-950/30 border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/40 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    <FileText className=\"h-4 w-4 mr-2 text-purple-600 dark:text-purple-400\" />\n                    Analyze Content\n                  </Button>\n                )}\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleDownloadWord}\n                  disabled={isConverting}\n                  className=\"disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Download as Word\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleDownloadPdf}\n                  disabled={isConverting}\n                  className=\"disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Download PDF\n                </Button>\n                <Button \n                  variant=\"default\" \n                  size=\"sm\" \n                  onClick={handleNewDocument}\n                  disabled={isConverting}\n                  className=\"disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  New Document\n                </Button>\n              </div>\n            </div>\n\n            {/* Split View: Editor/Viewer + Suggestions */}\n            <div className=\"grid grid-cols-3 gap-6\">\n              {/* Left: Document Editor/Viewer (2/3 width) */}\n              <div className=\"col-span-2\">\n                <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-gray-900 dark:text-gray-50 flex items-center gap-2\">\n                      <FileText className=\"h-5 w-5\" />\n                      {fileType === 'pdf' ? 'PDF Viewer' : 'Document Editor'}\n                      {fileType && (\n                        <Badge variant=\"secondary\" className=\"ml-2 text-xs\">\n                          {fileType.toUpperCase()}\n                        </Badge>\n                      )}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"p-0\">\n                    {fileType === 'pdf' && pdfUrl ? (\n                      <div className=\"h-[calc(100vh-300px)]\">\n                        <PdfViewerWithHighlight\n                          pdfUrl={pdfUrl}\n                          fileName={documentName}\n                          highlightInfo={highlightInfo}\n                          onPageChange={(page) => console.log('Page changed:', page)}\n                          className=\"h-full\"\n                        />\n                      </div>\n                    ) : (\n                      <TinyMCEEditor\n                        ref={editorRef}\n                        content={editorContent}\n                        onContentChange={setEditorContent}\n                        suggestions={editorSuggestions}\n                        selectedSuggestionIndex={selectedSuggestionIndex}\n                      />\n                    )}\n                  </CardContent>\n                </Card>\n                \n                {/* Save Draft and Share Document Buttons */}\n                <div className=\"mt-4 flex gap-3 justify-end\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleSaveDraft}\n                    disabled={!documentId}\n                    className=\"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/40\"\n                  >\n                    <Save className=\"h-4 w-4 mr-2\" />\n                    Save Draft\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleShareDocument}\n                    disabled={!documentId}\n                    className=\"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/40\"\n                  >\n                    <Share2 className=\"h-4 w-4 mr-2\" />\n                    Share Document\n                  </Button>\n                </div>\n              </div>\n\n              {/* Right: Compliance Suggestions (1/3 width) */}\n              <div className=\"col-span-1\">\n                <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 sticky top-6\">\n                  <CardHeader>\n                    <CardTitle className=\"text-gray-900 dark:text-gray-50 flex items-center justify-between\">\n                      <span>Compliance Suggestions</span>\n                      <Badge variant=\"secondary\">\n                        {suggestions.filter(s => !s.isApplied).length}\n                      </Badge>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"max-h-[calc(100vh-200px)] overflow-y-auto space-y-4\">\n                    {totalSuggestions === 0 ? (\n                      <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                        <p className=\"text-lg font-medium\">No suggestions found</p>\n                        <p className=\"text-sm mt-2\">Your document looks compliant!</p>\n                      </div>\n                    ) : (\n                      <>\n                        {Object.entries(groupedSuggestions).map(([category, items]) => (\n                          <div key={category}>\n                            <div className=\"flex items-center gap-2 mb-3\">\n                              <Badge\n                                variant=\"outline\"\n                                className={`text-xs font-semibold ${\n                                  category === 'FINRA' ? 'border-purple-500 text-purple-700 dark:text-purple-300' :\n                                  category === 'SEC' ? 'border-blue-500 text-blue-700 dark:text-blue-300' :\n                                  category === 'Grammar' ? 'border-green-500 text-green-700 dark:text-green-300' :\n                                  ''\n                                }`}\n                              >\n                                {category}\n                              </Badge>\n                              <Separator className=\"flex-1\" />\n                              <span className=\"text-xs text-gray-500\">\n                                {items.filter(s => !s.isApplied).length} pending\n                              </span>\n                            </div>\n                            \n                            <div className=\"space-y-3\">\n                              {items.map((item) => (\n                                <SuggestionCard\n                                  key={item.index}\n                                  suggestion={item}\n                                  index={item.index}\n                                  isSelected={selectedSuggestionIndex === item.index}\n                                  onSelect={() => handleSelectSuggestion(item.index)}\n                                  onApply={() => handleApplySuggestion(item.index)}\n                                  isApplying={isApplying === item.index}\n                                />\n                              ))}\n                            </div>\n                          </div>\n                        ))}\n                      </>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}