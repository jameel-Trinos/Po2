{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/compliance/PdfViewerWithHighlight.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport 'react-pdf/dist/Page/AnnotationLayer.css';\nimport 'react-pdf/dist/Page/TextLayer.css';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ChevronLeft, ChevronRight, ZoomIn, ZoomOut, Loader2 } from 'lucide-react';\nimport type { HighlightInfo } from '@/lib/pdf-utils';\n\n// Configure pdf.js worker - use version matching react-pdf\nif (typeof window !== 'undefined' && !pdfjs.GlobalWorkerOptions.workerSrc) {\n  pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;\n}\n\n// Note: TextLayer abort warnings are suppressed globally via lib/pdf-config.ts\n\nexport interface PdfViewerWithHighlightProps {\n  pdfUrl: string;\n  fileName?: string;\n  highlightInfo?: HighlightInfo | null;\n  onPageChange?: (pageNumber: number) => void;\n  className?: string;\n}\n\nconst PdfViewerWithHighlight: React.FC<PdfViewerWithHighlightProps> = ({\n  pdfUrl,\n  fileName,\n  highlightInfo,\n  onPageChange,\n  className = '',\n}) => {\n  const [numPages, setNumPages] = useState<number>(0);\n  const [pageNumber, setPageNumber] = useState<number>(1);\n  const [scale, setScale] = useState<number>(1.0);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const highlightLayerRef = useRef<HTMLDivElement>(null);\n  const documentRef = useRef<any>(null);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      // Cleanup any pending PDF.js tasks when component unmounts\n      if (documentRef.current) {\n        try {\n          documentRef.current.destroy?.();\n        } catch (e) {\n          // Silently ignore cleanup errors\n        }\n      }\n    };\n  }, []);\n\n  // Load document\n  const onDocumentLoadSuccess = ({ numPages }: { numPages: number }) => {\n    setNumPages(numPages);\n    setIsLoading(false);\n  };\n\n  const onDocumentLoadError = (error: Error) => {\n    console.error('Error loading PDF:', error);\n    setIsLoading(false);\n  };\n\n  // Navigate to specific page\n  const goToPage = (page: number) => {\n    if (page >= 1 && page <= numPages) {\n      setPageNumber(page);\n      onPageChange?.(page);\n    }\n  };\n\n  // Zoom controls\n  const zoomIn = () => setScale(prev => Math.min(prev + 0.2, 3.0));\n  const zoomOut = () => setScale(prev => Math.max(prev - 0.2, 0.5));\n\n  // Navigate to highlight location\n  useEffect(() => {\n    if (highlightInfo && highlightInfo.pageNumber !== pageNumber) {\n      goToPage(highlightInfo.pageNumber);\n    }\n  }, [highlightInfo]);\n\n  // Draw highlight overlay\n  useEffect(() => {\n    if (!highlightInfo || !highlightInfo.boundingBox || !highlightLayerRef.current) {\n      return;\n    }\n\n    const { x, y, width, height } = highlightInfo.boundingBox;\n\n    // Clear previous highlights\n    highlightLayerRef.current.innerHTML = '';\n\n    // Create highlight div\n    const highlightDiv = document.createElement('div');\n    highlightDiv.style.position = 'absolute';\n    highlightDiv.style.left = `${x * scale}px`;\n    highlightDiv.style.top = `${y * scale}px`;\n    highlightDiv.style.width = `${width * scale}px`;\n    highlightDiv.style.height = `${height * scale}px`;\n    highlightDiv.style.backgroundColor = 'rgba(255, 255, 0, 0.4)';\n    highlightDiv.style.border = '2px solid rgba(255, 200, 0, 0.8)';\n    highlightDiv.style.pointerEvents = 'none';\n    highlightDiv.style.zIndex = '10';\n\n    highlightLayerRef.current.appendChild(highlightDiv);\n\n    // Scroll to highlight\n    setTimeout(() => {\n      highlightDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 300);\n  }, [highlightInfo, scale, pageNumber]);\n\n  return (\n    <div className={`flex flex-col h-full ${className}`}>\n      {/* Toolbar */}\n      <div className=\"flex items-center justify-between p-3 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n        <div className=\"flex items-center gap-2\">\n          <Badge variant=\"outline\" className=\"text-xs\">\n            Page {pageNumber} of {numPages}\n          </Badge>\n          {fileName && (\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {fileName}\n            </Badge>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          {/* Zoom controls */}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={zoomOut}\n            disabled={scale <= 0.5}\n          >\n            <ZoomOut className=\"h-4 w-4\" />\n          </Button>\n          <Badge variant=\"outline\" className=\"text-xs min-w-[60px] text-center\">\n            {Math.round(scale * 100)}%\n          </Badge>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={zoomIn}\n            disabled={scale >= 3.0}\n          >\n            <ZoomIn className=\"h-4 w-4\" />\n          </Button>\n\n          {/* Page navigation */}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => goToPage(pageNumber - 1)}\n            disabled={pageNumber <= 1}\n          >\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => goToPage(pageNumber + 1)}\n            disabled={pageNumber >= numPages}\n          >\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      {/* PDF Viewer */}\n      <div\n        ref={containerRef}\n        className=\"flex-1 overflow-auto bg-zinc-100 dark:bg-zinc-950 relative\"\n      >\n        {isLoading && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-zinc-50 dark:bg-zinc-950\">\n            <div className=\"flex flex-col items-center gap-3\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-zinc-600 dark:text-zinc-400\" />\n              <p className=\"text-sm text-zinc-600 dark:text-zinc-400\">Loading PDF...</p>\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex justify-center p-6 relative\">\n          {/* Highlight layer */}\n          <div\n            ref={highlightLayerRef}\n            className=\"absolute top-6 left-0 right-0 pointer-events-none\"\n            style={{ zIndex: 10 }}\n          />\n\n          {/* PDF Document */}\n          <Document\n            file={pdfUrl}\n            onLoadSuccess={(pdf) => {\n              documentRef.current = pdf;\n              onDocumentLoadSuccess(pdf);\n            }}\n            onLoadError={onDocumentLoadError}\n            loading={\n              <div className=\"flex items-center justify-center p-8\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-zinc-600 dark:text-zinc-400\" />\n              </div>\n            }\n            error={\n              <div className=\"flex items-center justify-center p-8 text-red-600 dark:text-red-400\">\n                <p>Failed to load PDF. Please try again.</p>\n              </div>\n            }\n          >\n            <Page\n              key={`page-${pageNumber}-${scale}`}\n              pageNumber={pageNumber}\n              scale={scale}\n              renderTextLayer={true}\n              renderAnnotationLayer={true}\n              loading={\n                <div className=\"flex items-center justify-center p-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-zinc-600 dark:text-zinc-400\" />\n                </div>\n              }\n              className=\"shadow-lg\"\n            />\n          </Document>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PdfViewerWithHighlight;\n\n"],"names":[],"mappings":"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","debugId":null}}]
}