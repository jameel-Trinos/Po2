{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS","debugId":null}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Input({ className, type, ...props }: React.ComponentProps<\"input\">) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        \"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        \"focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]\",\n        \"aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,6LAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,8bACA,iFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS","debugId":null}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/label.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        \"flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,MAAM,EACb,SAAS,EACT,GAAG,OAC8C;IACjD,qBACE,6LAAC,4KAAmB;QAClB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,uNACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS","debugId":null}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/alert.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-card text-card-foreground\",\n        destructive:\n          \"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Alert({\n  className,\n  variant,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof alertVariants>) {\n  return (\n    <div\n      data-slot=\"alert\"\n      role=\"alert\"\n      className={cn(alertVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction AlertTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-title\"\n      className={cn(\n        \"col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDescription({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-description\"\n      className={cn(\n        \"text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Alert, AlertTitle, AlertDescription }\n"],"names":[],"mappings":";;;;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,qOACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,GAAG,OAC8D;IACjE,qBACE,6LAAC;QACC,aAAU;QACV,MAAK;QACL,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAbS;AAeT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,+DACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OACyB;IAC5B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kGACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS","debugId":null}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/progress.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Progress({\n  className,\n  value,\n  ...props\n}: React.ComponentProps<typeof ProgressPrimitive.Root>) {\n  return (\n    <ProgressPrimitive.Root\n      data-slot=\"progress\"\n      className={cn(\n        \"bg-primary/20 relative h-2 w-full overflow-hidden rounded-full\",\n        className\n      )}\n      {...props}\n    >\n      <ProgressPrimitive.Indicator\n        data-slot=\"progress-indicator\"\n        className=\"bg-primary h-full w-full flex-1 transition-all\"\n        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n      />\n    </ProgressPrimitive.Root>\n  )\n}\n\nexport { Progress }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,SAAS,EAChB,SAAS,EACT,KAAK,EACL,GAAG,OACiD;IACpD,qBACE,6LAAC,+KAAsB;QACrB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,oLAA2B;YAC1B,aAAU;YACV,WAAU;YACV,OAAO;gBAAE,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;YAAC;;;;;;;;;;;AAIlE;KArBS","debugId":null}},
    {"offset": {"line": 308, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90\",\n        destructive:\n          \"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"span\"> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"span\"\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,oZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD;IAC1D,MAAM,OAAO,UAAU,2KAAI,GAAG;IAE9B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAhBS","debugId":null}},
    {"offset": {"line": 360, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/ui/separator.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Separator({\n  className,\n  orientation = \"horizontal\",\n  decorative = true,\n  ...props\n}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {\n  return (\n    <SeparatorPrimitive.Root\n      data-slot=\"separator\"\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Separator }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,UAAU,EACjB,SAAS,EACT,cAAc,YAAY,EAC1B,aAAa,IAAI,EACjB,GAAG,OACkD;IACrD,qBACE,6LAAC,gLAAuB;QACtB,aAAU;QACV,YAAY;QACZ,aAAa;QACb,WAAW,IAAA,qHAAE,EACX,kKACA;QAED,GAAG,KAAK;;;;;;AAGf;KAlBS","debugId":null}},
    {"offset": {"line": 395, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/editor/TinyMCEEditor.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef, useImperativeHandle, forwardRef } from 'react';\nimport { Editor } from '@tinymce/tinymce-react';\nimport type { Editor as TinyMCEEditorType } from 'tinymce';\nimport { Card, CardContent } from '@/components/ui/card';\nimport type { Suggestion } from '@/lib/types/proofreader';\n\ninterface TinyMCEEditorProps {\n  content: string;\n  onContentChange: (html: string) => void;\n  suggestions?: Suggestion[];\n  selectedSuggestionIndex?: number | null;\n  className?: string;\n}\n\nexport interface TinyMCEEditorHandle {\n  highlightText: (text: string) => void;\n  replaceText: (original: string, replacement: string) => void;\n  getEditor: () => TinyMCEEditorType | null;\n  getContent: () => string;\n}\n\nconst TinyMCEEditor = forwardRef<TinyMCEEditorHandle, TinyMCEEditorProps>(\n  ({ content, onContentChange, suggestions = [], selectedSuggestionIndex = null, className }, ref) => {\n    const editorRef = useRef<TinyMCEEditorType | null>(null);\n\n    // Expose methods to parent via ref\n    useImperativeHandle(ref, () => ({\n      highlightText: (text: string) => {\n        if (!editorRef.current) return;\n        highlightTextInEditor(editorRef.current, text);\n      },\n      replaceText: (original: string, replacement: string) => {\n        if (!editorRef.current) return;\n        replaceTextInEditor(editorRef.current, original, replacement);\n      },\n      getEditor: () => editorRef.current,\n      getContent: () => editorRef.current?.getContent() || '',\n    }));\n\n    // Update content when it changes externally\n    useEffect(() => {\n      if (editorRef.current && content !== editorRef.current.getContent()) {\n        editorRef.current.setContent(content);\n      }\n    }, [content]);\n\n    // Highlight selected suggestion\n    useEffect(() => {\n      if (editorRef.current && selectedSuggestionIndex !== null && suggestions[selectedSuggestionIndex]) {\n        const suggestion = suggestions[selectedSuggestionIndex];\n        const textToHighlight = suggestion.text || suggestion.original || '';\n        if (textToHighlight) {\n          highlightTextInEditor(editorRef.current, textToHighlight);\n        }\n      }\n    }, [selectedSuggestionIndex, suggestions]);\n\n    const handleEditorChange = (content: string) => {\n      onContentChange(content);\n    };\n\n    const handleEditorInit = (_evt: any, editor: TinyMCEEditorType) => {\n      editorRef.current = editor;\n    };\n\n    return (\n      <Card className={`border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 ${className || ''}`}>\n        <CardContent className=\"p-0\">\n          <Editor\n            onInit={handleEditorInit}\n            value={content}\n            onEditorChange={handleEditorChange}\n            init={{\n              height: '70vh',\n              menubar: false,\n              plugins: [\n                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',\n                'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',\n                'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount',\n                'textcolor', 'colorpicker', 'textpattern', 'nonbreaking', 'paste'\n              ],\n              toolbar: 'undo redo | blocks | ' +\n                'bold italic underline strikethrough | forecolor backcolor | ' +\n                'alignleft aligncenter alignright alignjustify | ' +\n                'bullist numlist outdent indent | ' +\n                'removeformat | help',\n              content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif; font-size: 14px; padding: 20px; line-height: 1.6; }',\n              skin: typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'oxide-dark' : 'oxide',\n              content_css: typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'default',\n              branding: false,\n              promotion: false,\n              resize: true,\n              statusbar: false,\n              menubar: false,\n              paste_as_text: false,\n              paste_auto_cleanup_on_paste: true,\n              convert_urls: false,\n              setup: (editor) => {\n                // Add custom command to highlight text\n                editor.addCommand('highlightText', (text: string) => {\n                  highlightTextInEditor(editor, text);\n                });\n\n                // Add custom command to replace text\n                editor.addCommand('replaceText', (original: string, replacement: string) => {\n                  replaceTextInEditor(editor, original, replacement);\n                });\n              },\n            }}\n          />\n        </CardContent>\n      </Card>\n    );\n  }\n);\n\nTinyMCEEditor.displayName = 'TinyMCEEditor';\n\n/**\n * Highlight text in TinyMCE editor (yellow highlight)\n */\nfunction highlightTextInEditor(editor: TinyMCEEditorType, text: string): void {\n  if (!text || !text.trim()) return;\n\n  try {\n    // Remove previous highlights\n    const body = editor.getBody();\n    const existingHighlights = body.querySelectorAll('mark.suggestion-highlight');\n    existingHighlights.forEach((el) => {\n      const parent = el.parentNode;\n      if (parent) {\n        while (el.firstChild) {\n          parent.insertBefore(el.firstChild, el);\n        }\n        parent.removeChild(el);\n        parent.normalize();\n      }\n    });\n\n    // Get plain text content for searching\n    const plainText = editor.getContent({ format: 'text' });\n    const searchText = text.trim().toLowerCase();\n    const lowerText = plainText.toLowerCase();\n    const index = lowerText.indexOf(searchText);\n\n    if (index === -1) {\n      console.warn('Text not found in editor:', text);\n      return;\n    }\n\n    // Use TinyMCE's searchreplace plugin or manual DOM manipulation\n    const htmlContent = editor.getContent();\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = htmlContent;\n\n  // Find text nodes that contain the search text\n    const walker = document.createTreeWalker(\n      tempDiv,\n      NodeFilter.SHOW_TEXT,\n      null\n    );\n\n    let currentNode: Node | null = null;\n    let cumulativeLength = 0;\n    let found = false;\n\n    while ((currentNode = walker.nextNode()) && !found) {\n      const textNode = currentNode as Text;\n      const nodeText = textNode.textContent || '';\n      const nodeLowerText = nodeText.toLowerCase();\n      const nodeStart = cumulativeLength;\n      const nodeEnd = cumulativeLength + nodeText.length;\n\n      cumulativeLength = nodeEnd;\n\n      // Check if this node contains the search text\n      const searchIndex = nodeLowerText.indexOf(searchText);\n      if (searchIndex !== -1) {\n        // Found the text in this node\n        const beforeText = nodeText.substring(0, searchIndex);\n        const matchText = nodeText.substring(searchIndex, searchIndex + searchText.length);\n        const afterText = nodeText.substring(searchIndex + searchText.length);\n\n        // Create fragment with highlighted text\n        const fragment = document.createDocumentFragment();\n        if (beforeText) {\n          fragment.appendChild(document.createTextNode(beforeText));\n        }\n\n        const mark = document.createElement('mark');\n        mark.className = 'suggestion-highlight';\n        mark.setAttribute('style', 'background-color: #fef08a; color: #000; padding: 2px 4px; border-radius: 3px;');\n        mark.textContent = matchText;\n        fragment.appendChild(mark);\n\n        if (afterText) {\n          fragment.appendChild(document.createTextNode(afterText));\n        }\n\n        // Replace the text node with the fragment\n        textNode.parentNode?.replaceChild(fragment, textNode);\n        found = true;\n      }\n    }\n\n    if (found) {\n      // Update editor with highlighted content\n      editor.setContent(tempDiv.innerHTML);\n\n      // Scroll to highlighted text\n      setTimeout(() => {\n        const highlight = editor.getBody().querySelector('mark.suggestion-highlight');\n        if (highlight) {\n          editor.selection.select(highlight as any);\n          editor.selection.scrollIntoView();\n          // Also try to scroll the editor window\n          highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        }\n      }, 100);\n    }\n  } catch (error) {\n    console.error('Error highlighting text in TinyMCE:', error);\n  }\n}\n\n/**\n * Replace text in TinyMCE editor\n */\nfunction replaceTextInEditor(editor: TinyMCEEditorType, original: string, replacement: string): void {\n  if (!original || !original.trim()) return;\n\n  try {\n    // Remove any existing highlights first\n    const body = editor.getBody();\n    const existingHighlights = body.querySelectorAll('mark.suggestion-highlight');\n    existingHighlights.forEach((el) => {\n      const parent = el.parentNode;\n      if (parent) {\n        while (el.firstChild) {\n          parent.insertBefore(el.firstChild, el);\n        }\n        parent.removeChild(el);\n        parent.normalize();\n      }\n    });\n\n    // Get current content\n    const htmlContent = editor.getContent();\n    const plainText = editor.getContent({ format: 'text' });\n    const searchText = original.trim().toLowerCase();\n    const lowerText = plainText.toLowerCase();\n    const index = lowerText.indexOf(searchText);\n\n    if (index === -1) {\n      console.warn('Text not found in editor for replacement:', original);\n      return;\n    }\n\n    // Create temporary DOM for manipulation\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = htmlContent;\n\n    // Find and replace text\n    const walker = document.createTreeWalker(\n      tempDiv,\n      NodeFilter.SHOW_TEXT,\n      null\n    );\n\n    let currentNode: Node | null = null;\n    let cumulativeLength = 0;\n    let replaced = false;\n\n    while ((currentNode = walker.nextNode()) && !replaced) {\n      const textNode = currentNode as Text;\n      const nodeText = textNode.textContent || '';\n      const nodeLowerText = nodeText.toLowerCase();\n      const nodeStart = cumulativeLength;\n      const nodeEnd = cumulativeLength + nodeText.length;\n\n      cumulativeLength = nodeEnd;\n\n      // Check if this node contains the search text\n      const searchIndex = nodeLowerText.indexOf(searchText);\n      if (searchIndex !== -1) {\n        // Found the text in this node - replace it\n        const beforeText = nodeText.substring(0, searchIndex);\n        const afterText = nodeText.substring(searchIndex + searchText.length);\n\n        // Create fragment with replacement text\n        const fragment = document.createDocumentFragment();\n        if (beforeText) {\n          fragment.appendChild(document.createTextNode(beforeText));\n        }\n        fragment.appendChild(document.createTextNode(replacement));\n        if (afterText) {\n          fragment.appendChild(document.createTextNode(afterText));\n        }\n\n        // Replace the text node with the fragment\n        textNode.parentNode?.replaceChild(fragment, textNode);\n        replaced = true;\n      }\n    }\n\n    if (replaced) {\n      // Update editor with replaced content\n      editor.setContent(tempDiv.innerHTML);\n    }\n  } catch (error) {\n    console.error('Error replacing text in TinyMCE:', error);\n  }\n}\n\nexport default TinyMCEEditor;\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 719, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/proofreader/ProofreadPdfViewer.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport type { Suggestion } from '../../lib/types/proofreader';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ZoomIn, ZoomOut, ChevronLeft, ChevronRight } from 'lucide-react';\n\n// Helper function to load pdfjs dynamically\nasync function loadPdfJs() {\n  const pdfjs = await import('pdfjs-dist');\n  if (typeof window !== 'undefined' && !pdfjs.GlobalWorkerOptions.workerSrc) {\n    pdfjs.GlobalWorkerOptions.workerSrc = '/pdf.worker.mjs';\n  }\n  return pdfjs;\n}\n\ninterface ProofreadPdfViewerProps {\n  pdfUrl: string;\n  suggestions: Suggestion[];\n  selectedSuggestion: Suggestion | null;\n  onSuggestionClick: (suggestion: Suggestion | null) => void;\n  onApplyEdit: (pageNumber: number, originalText: string, newText: string) => void;\n}\n\nconst ProofreadPdfViewer: React.FC<ProofreadPdfViewerProps> = ({\n  pdfUrl,\n  suggestions,\n  selectedSuggestion,\n  onSuggestionClick,\n  onApplyEdit,\n}) => {\n  const [pdfDoc, setPdfDoc] = useState<any | null>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(0);\n  const [zoom, setZoom] = useState(1.2);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [renderedPages, setRenderedPages] = useState<Set<number>>(new Set());\n  const [textLayerLoaded, setTextLayerLoaded] = useState<Set<number>>(new Set());\n  \n  const canvasRefs = useRef<Map<number, HTMLCanvasElement>>(new Map());\n  const textLayerRefs = useRef<Map<number, HTMLDivElement>>(new Map());\n  const renderTasksRef = useRef<Map<number, any>>(new Map());\n  const renderingInProgressRef = useRef<Map<number, boolean>>(new Map());\n  const containerRef = useRef<HTMLDivElement>(null);\n  const pageRefs = useRef<Map<number, HTMLDivElement>>(new Map());\n\n  // Load PDF document\n  useEffect(() => {\n    const loadPdf = async () => {\n      setIsLoading(true);\n      setError(null);\n      \n      try {\n        // Dynamically load pdfjs\n        const pdfjs = await loadPdfJs();\n        const loadingTask = pdfjs.getDocument(pdfUrl);\n        const pdf = await loadingTask.promise;\n        setPdfDoc(pdf);\n        setTotalPages(pdf.numPages);\n        setIsLoading(false);\n        console.log(`[ProofreadPdfViewer] PDF loaded with ${pdf.numPages} pages`);\n      } catch (err) {\n        console.error('[ProofreadPdfViewer] Error loading PDF:', err);\n        setError('Failed to load PDF document');\n        setIsLoading(false);\n      }\n    };\n\n    if (pdfUrl) {\n      loadPdf();\n    }\n\n    return () => {\n      // Cleanup render tasks\n      renderTasksRef.current.forEach((task) => {\n        try {\n          task.cancel();\n        } catch (e) {\n          // Ignore\n        }\n      });\n      renderTasksRef.current.clear();\n      renderingInProgressRef.current.clear();\n    };\n  }, [pdfUrl]);\n\n  // Cleanup render tasks when zoom changes\n  useEffect(() => {\n    const cancelAllTasks = async () => {\n      const cancelPromises: Promise<void>[] = [];\n      renderTasksRef.current.forEach((task) => {\n        cancelPromises.push(\n          (async () => {\n            try {\n              await task.cancel();\n            } catch (e) {\n              // Ignore errors during cancellation\n            }\n          })()\n        );\n      });\n      await Promise.all(cancelPromises);\n      renderTasksRef.current.clear();\n      renderingInProgressRef.current.clear();\n      setRenderedPages(new Set());\n      setTextLayerLoaded(new Set());\n    };\n    \n    cancelAllTasks();\n  }, [zoom]);\n\n  // Render a page\n  const renderPage = useCallback(async (pageNum: number) => {\n    if (!pdfDoc) return;\n\n    // Check if already rendering this page\n    if (renderingInProgressRef.current.get(pageNum)) {\n      console.log(`[ProofreadPdfViewer] Page ${pageNum} is already rendering, skipping`);\n      return;\n    }\n\n    const canvas = canvasRefs.current.get(pageNum);\n    if (!canvas) {\n      console.log(`[ProofreadPdfViewer] Canvas not ready for page ${pageNum}`);\n      return;\n    }\n\n    // Mark as rendering in progress\n    renderingInProgressRef.current.set(pageNum, true);\n\n    // Cancel existing render task\n    const existingTask = renderTasksRef.current.get(pageNum);\n    if (existingTask) {\n      try {\n        console.log(`[ProofreadPdfViewer] Cancelling existing render for page ${pageNum}`);\n        await existingTask.cancel();\n        renderTasksRef.current.delete(pageNum);\n        // Wait for cancellation to fully complete\n        await new Promise(resolve => setTimeout(resolve, 100));\n      } catch (e) {\n        // Ignore\n        console.log(`[ProofreadPdfViewer] Cancellation error for page ${pageNum}:`, e);\n      }\n    }\n\n    try {\n      const page: any = await pdfDoc.getPage(pageNum);\n      \n      // Double-check canvas is still available\n      const currentCanvas = canvasRefs.current.get(pageNum);\n      if (!currentCanvas) {\n        renderingInProgressRef.current.set(pageNum, false);\n        return;\n      }\n      \n      const context = currentCanvas.getContext('2d');\n      if (!context) {\n        renderingInProgressRef.current.set(pageNum, false);\n        return;\n      }\n\n      const viewport = page.getViewport({ scale: zoom });\n\n      // Clear canvas\n      context.clearRect(0, 0, currentCanvas.width, currentCanvas.height);\n      currentCanvas.width = viewport.width;\n      currentCanvas.height = viewport.height;\n\n      const renderContext = {\n        canvasContext: context,\n        viewport: viewport,\n      };\n\n      const renderTask = page.render(renderContext);\n      renderTasksRef.current.set(pageNum, renderTask);\n\n      await renderTask.promise;\n      renderTasksRef.current.delete(pageNum);\n      setRenderedPages(prev => new Set([...prev, pageNum]));\n\n      // Render text layer for highlighting\n      await renderTextLayer(page, pageNum, viewport);\n\n      console.log(`[ProofreadPdfViewer] Rendered page ${pageNum}`);\n    } catch (err: any) {\n      renderTasksRef.current.delete(pageNum);\n      if (err?.name !== 'RenderingCancelledException') {\n        console.error(`[ProofreadPdfViewer] Error rendering page ${pageNum}:`, err);\n      }\n    } finally {\n      // Always mark as no longer rendering\n      renderingInProgressRef.current.set(pageNum, false);\n    }\n  }, [pdfDoc, zoom]);\n\n  // Render text layer for text selection and highlighting\n  const renderTextLayer = async (page: any, pageNum: number, viewport: any) => {\n    const textLayerDiv = textLayerRefs.current.get(pageNum);\n    if (!textLayerDiv) return;\n\n    try {\n      const textContent = await page.getTextContent();\n      \n      // Dynamically load pdfjs for Util\n      const pdfjs = await loadPdfJs();\n      \n      // Clear existing text layer\n      textLayerDiv.innerHTML = '';\n      textLayerDiv.style.width = `${viewport.width}px`;\n      textLayerDiv.style.height = `${viewport.height}px`;\n\n      // Render text items\n      textContent.items.forEach((item: any) => {\n        const textDiv = document.createElement('div');\n        const tx = pdfjs.Util.transform(\n          pdfjs.Util.transform(viewport.transform, item.transform),\n          [1, 0, 0, -1, 0, 0]\n        );\n        const style = textContent.styles[item.fontName];\n        \n        textDiv.style.position = 'absolute';\n        textDiv.style.left = `${tx[4]}px`;\n        textDiv.style.top = `${tx[5]}px`;\n        textDiv.style.fontSize = `${Math.abs(tx[3])}px`;\n        textDiv.style.fontFamily = style?.fontFamily || 'sans-serif';\n        textDiv.textContent = item.str;\n        textDiv.className = 'pdf-text-item';\n        \n        textLayerDiv.appendChild(textDiv);\n      });\n\n      setTextLayerLoaded(prev => new Set([...prev, pageNum]));\n    } catch (err) {\n      console.error(`[ProofreadPdfViewer] Error rendering text layer for page ${pageNum}:`, err);\n    }\n  };\n\n  // Render visible pages\n  useEffect(() => {\n    if (!pdfDoc || totalPages === 0) return;\n\n    // Render all pages sequentially to avoid canvas conflicts\n    const renderAllPages = async () => {\n      for (let i = 1; i <= totalPages; i++) {\n        if (!renderingInProgressRef.current.get(i)) {\n          await renderPage(i);\n          // Small delay between renders to ensure clean separation\n          await new Promise(resolve => setTimeout(resolve, 50));\n        }\n      }\n    };\n\n    // Use a small delay to ensure canvases are mounted and ready\n    const timeoutId = setTimeout(() => {\n      renderAllPages();\n    }, 100);\n\n    return () => clearTimeout(timeoutId);\n  }, [pdfDoc, totalPages, zoom, renderPage]);\n\n  // Scroll to selected suggestion\n  useEffect(() => {\n    if (selectedSuggestion && selectedSuggestion.page) {\n      const pageDiv = pageRefs.current.get(selectedSuggestion.page);\n      if (pageDiv) {\n        pageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        \n        // Highlight the text\n        const textLayerDiv = textLayerRefs.current.get(selectedSuggestion.page);\n        if (textLayerDiv) {\n          highlightTextInLayer(textLayerDiv, selectedSuggestion.original);\n        }\n      }\n    } else {\n      // Clear all highlights\n      textLayerRefs.current.forEach((textLayerDiv) => {\n        const highlighted = textLayerDiv.querySelectorAll('.highlighted-text');\n        highlighted.forEach(el => {\n          el.classList.remove('highlighted-text');\n        });\n      });\n    }\n  }, [selectedSuggestion]);\n\n  // Highlight text in text layer\n  const highlightTextInLayer = (textLayerDiv: HTMLDivElement, text: string) => {\n    // Clear previous highlights\n    const previousHighlights = textLayerDiv.querySelectorAll('.highlighted-text');\n    previousHighlights.forEach(el => el.classList.remove('highlighted-text'));\n\n    // Find and highlight matching text\n    const textItems = textLayerDiv.querySelectorAll('.pdf-text-item');\n    let fullText = '';\n    const itemMap: { start: number; end: number; element: HTMLElement }[] = [];\n\n    textItems.forEach((item) => {\n      const start = fullText.length;\n      const content = item.textContent || '';\n      fullText += content;\n      const end = fullText.length;\n      itemMap.push({ start, end, element: item as HTMLElement });\n    });\n\n    // Find text position\n    const searchText = text.toLowerCase().trim();\n    const fullTextLower = fullText.toLowerCase();\n    const index = fullTextLower.indexOf(searchText);\n\n    if (index !== -1) {\n      const matchStart = index;\n      const matchEnd = index + searchText.length;\n\n      // Highlight matching elements\n      itemMap.forEach(({ start, end, element }) => {\n        if ((start >= matchStart && start < matchEnd) || (end > matchStart && end <= matchEnd) || (start <= matchStart && end >= matchEnd)) {\n          element.classList.add('highlighted-text');\n        }\n      });\n    }\n  };\n\n  // Navigation handlers\n  const handlePrevPage = () => {\n    if (currentPage > 1) {\n      const pageDiv = pageRefs.current.get(currentPage - 1);\n      if (pageDiv) {\n        pageDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      }\n      setCurrentPage(currentPage - 1);\n    }\n  };\n\n  const handleNextPage = () => {\n    if (currentPage < totalPages) {\n      const pageDiv = pageRefs.current.get(currentPage + 1);\n      if (pageDiv) {\n        pageDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      }\n      setCurrentPage(currentPage + 1);\n    }\n  };\n\n  const handleZoomIn = () => {\n    setZoom(prev => Math.min(prev + 0.2, 3));\n    setRenderedPages(new Set());\n  };\n\n  const handleZoomOut = () => {\n    setZoom(prev => Math.max(prev - 0.2, 0.5));\n    setRenderedPages(new Set());\n  };\n\n  if (isLoading) {\n    return (\n      <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n        <CardHeader>\n          <CardTitle className=\"text-gray-900 dark:text-gray-50\">Loading PDF...</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-center h-96\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-zinc-900 dark:border-zinc-100\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n        <CardHeader>\n          <CardTitle className=\"text-red-600 dark:text-red-400\">Error</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"text-gray-700 dark:text-gray-300\">{error}</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-gray-900 dark:text-gray-50\">Document Viewer</CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"secondary\">\n              Page {currentPage} of {totalPages}\n            </Badge>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2 mt-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={handlePrevPage} disabled={currentPage === 1}>\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={handleNextPage} disabled={currentPage === totalPages}>\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n          <div className=\"flex-1\" />\n          <Button variant=\"outline\" size=\"sm\" onClick={handleZoomOut} disabled={zoom <= 0.5}>\n            <ZoomOut className=\"h-4 w-4\" />\n          </Button>\n          <span className=\"text-sm text-gray-600 dark:text-gray-400\">{Math.round(zoom * 100)}%</span>\n          <Button variant=\"outline\" size=\"sm\" onClick={handleZoomIn} disabled={zoom >= 3}>\n            <ZoomIn className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div \n          ref={containerRef}\n          className=\"relative overflow-auto bg-zinc-100 dark:bg-zinc-800 rounded-lg p-4\"\n          style={{ maxHeight: '75vh' }}\n        >\n          <div className=\"flex flex-col items-center gap-4\">\n            {Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (\n              <div\n                key={pageNum}\n                ref={(el) => {\n                  if (el) pageRefs.current.set(pageNum, el);\n                }}\n                className=\"relative bg-white shadow-lg\"\n                style={{ marginBottom: '20px' }}\n              >\n                <canvas\n                  ref={(el) => {\n                    if (el) canvasRefs.current.set(pageNum, el);\n                  }}\n                  className=\"block w-full h-auto\"\n                />\n                <div\n                  ref={(el) => {\n                    if (el) textLayerRefs.current.set(pageNum, el);\n                  }}\n                  className=\"absolute top-0 left-0 pointer-events-none pdf-text-layer\"\n                  style={{\n                    overflow: 'hidden',\n                  }}\n                />\n                <div className=\"absolute bottom-2 right-2\">\n                  <Badge variant=\"secondary\">\n                    {pageNum}\n                  </Badge>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default ProofreadPdfViewer;\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1426, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/lib/services/geminiService.ts"],"sourcesContent":["import type { Suggestion } from '../types/proofreader';\n\nexport async function analyzePdfContent(pdfTextByPage: string): Promise<Suggestion[]> {\n    try {\n        let response: Response;\n        try {\n            response = await fetch('/api/analyze', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({ pdfTextByPage }),\n            });\n        } catch (fetchError) {\n            // Handle network-level fetch failures (before getting a response)\n            console.error(\"Network error during fetch:\", fetchError);\n            \n            if (fetchError instanceof TypeError && fetchError.message.includes('fetch failed')) {\n                throw new Error(\n                    \"Unable to connect to the server. Please check your internet connection and ensure the server is running.\"\n                );\n            }\n            \n            // Re-throw with a more user-friendly message\n            throw new Error(\n                `Network error: ${fetchError instanceof Error ? fetchError.message : 'Failed to send request'}. Please check your connection and try again.`\n            );\n        }\n\n        if (!response.ok) {\n            let errorMessage = `HTTP error! status: ${response.status}`;\n            \n            // Clone response to allow multiple reads if needed\n            const responseClone = response.clone();\n            \n            // Try to read as JSON first (since our API returns JSON errors)\n            let errorData: any = null;\n            try {\n                errorData = await response.json();\n            } catch (jsonError) {\n                // If JSON parsing fails, try reading the cloned response as text\n                try {\n                    const responseText = await responseClone.text();\n                    errorMessage = responseText || errorMessage;\n                } catch (textError) {\n                    // If we can't read the response at all, use the default message\n                    console.error(\"Could not read error response:\", textError);\n                }\n            }\n            \n            // If we successfully parsed JSON, extract the error message\n            if (errorData && typeof errorData === 'object' && errorData !== null) {\n                // Handle nested error structure: { error: { message: \"...\", code: 503 } }\n                // This is the format returned by our API route\n                if (errorData.error !== undefined && errorData.error !== null) {\n                    if (typeof errorData.error === 'string') {\n                        errorMessage = errorData.error;\n                    } else if (typeof errorData.error === 'object') {\n                        // Extract message from nested error object\n                        // Check for error.error.message (triple nested) first\n                        if (errorData.error.error && typeof errorData.error.error === 'object' && typeof errorData.error.error.message === 'string') {\n                            errorMessage = errorData.error.error.message;\n                        } else if (typeof errorData.error.message === 'string' && errorData.error.message.length > 0) {\n                            // This is the expected path: errorData.error.message\n                            errorMessage = errorData.error.message;\n                        } else if (errorData.error.error !== undefined) {\n                            // Triple nested without message property\n                            const innerError = errorData.error.error;\n                            if (typeof innerError === 'string') {\n                                errorMessage = innerError;\n                            }\n                        }\n                    }\n                } else if (typeof errorData.message === 'string' && errorData.message.length > 0) {\n                    // Direct message property\n                    errorMessage = errorData.message;\n                }\n            }\n            \n            // Final safety check: if errorMessage is still the default and we have errorData, try to stringify just the message part\n            if (errorMessage === `HTTP error! status: ${response.status}` && errorData) {\n                // Last resort: if we couldn't extract, at least try to get something meaningful\n                if (errorData.error?.message) {\n                    errorMessage = String(errorData.error.message);\n                }\n            }\n            \n            // Provide user-friendly messages for common error codes if we still have the default\n            if (errorMessage === `HTTP error! status: ${response.status}`) {\n                if (response.status === 503) {\n                    errorMessage = \"The AI service is temporarily unavailable. Please try again in a few moments.\";\n                } else if (response.status === 429) {\n                    errorMessage = \"Too many requests. Please wait a moment and try again.\";\n                } else if (response.status === 401 || response.status === 403) {\n                    errorMessage = \"Authentication failed. Please check your API key configuration.\";\n                } else if (response.status === 500) {\n                    errorMessage = \"An internal server error occurred. Please try again later.\";\n                }\n            }\n            \n            // Ensure we have a string, not an object\n            if (typeof errorMessage !== 'string') {\n                errorMessage = String(errorMessage);\n            }\n            \n            throw new Error(errorMessage);\n        }\n\n        const data = await response.json();\n        return data.suggestions || [];\n    } catch (error) {\n        console.error(\"Error analyzing content with Gemini:\", error);\n        // Preserve the original error message if it's already an Error instance\n        if (error instanceof Error) {\n            throw error;\n        }\n        throw new Error(\"Failed to get suggestions from the AI. Please check the console for details.\");\n    }\n}\n"],"names":[],"mappings":";;;;AAEO,eAAe,kBAAkB,aAAqB;IACzD,IAAI;QACA,IAAI;QACJ,IAAI;YACA,WAAW,MAAM,MAAM,gBAAgB;gBACnC,QAAQ;gBACR,SAAS;oBACL,gBAAgB;gBACpB;gBACA,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAc;YACzC;QACJ,EAAE,OAAO,YAAY;YACjB,kEAAkE;YAClE,QAAQ,KAAK,CAAC,+BAA+B;YAE7C,IAAI,sBAAsB,aAAa,WAAW,OAAO,CAAC,QAAQ,CAAC,iBAAiB;gBAChF,MAAM,IAAI,MACN;YAER;YAEA,6CAA6C;YAC7C,MAAM,IAAI,MACN,CAAC,eAAe,EAAE,sBAAsB,QAAQ,WAAW,OAAO,GAAG,yBAAyB,6CAA6C,CAAC;QAEpJ;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,IAAI,eAAe,CAAC,oBAAoB,EAAE,SAAS,MAAM,EAAE;YAE3D,mDAAmD;YACnD,MAAM,gBAAgB,SAAS,KAAK;YAEpC,gEAAgE;YAChE,IAAI,YAAiB;YACrB,IAAI;gBACA,YAAY,MAAM,SAAS,IAAI;YACnC,EAAE,OAAO,WAAW;gBAChB,iEAAiE;gBACjE,IAAI;oBACA,MAAM,eAAe,MAAM,cAAc,IAAI;oBAC7C,eAAe,gBAAgB;gBACnC,EAAE,OAAO,WAAW;oBAChB,gEAAgE;oBAChE,QAAQ,KAAK,CAAC,kCAAkC;gBACpD;YACJ;YAEA,4DAA4D;YAC5D,IAAI,aAAa,OAAO,cAAc,YAAY,cAAc,MAAM;gBAClE,0EAA0E;gBAC1E,+CAA+C;gBAC/C,IAAI,UAAU,KAAK,KAAK,aAAa,UAAU,KAAK,KAAK,MAAM;oBAC3D,IAAI,OAAO,UAAU,KAAK,KAAK,UAAU;wBACrC,eAAe,UAAU,KAAK;oBAClC,OAAO,IAAI,OAAO,UAAU,KAAK,KAAK,UAAU;wBAC5C,2CAA2C;wBAC3C,sDAAsD;wBACtD,IAAI,UAAU,KAAK,CAAC,KAAK,IAAI,OAAO,UAAU,KAAK,CAAC,KAAK,KAAK,YAAY,OAAO,UAAU,KAAK,CAAC,KAAK,CAAC,OAAO,KAAK,UAAU;4BACzH,eAAe,UAAU,KAAK,CAAC,KAAK,CAAC,OAAO;wBAChD,OAAO,IAAI,OAAO,UAAU,KAAK,CAAC,OAAO,KAAK,YAAY,UAAU,KAAK,CAAC,OAAO,CAAC,MAAM,GAAG,GAAG;4BAC1F,qDAAqD;4BACrD,eAAe,UAAU,KAAK,CAAC,OAAO;wBAC1C,OAAO,IAAI,UAAU,KAAK,CAAC,KAAK,KAAK,WAAW;4BAC5C,yCAAyC;4BACzC,MAAM,aAAa,UAAU,KAAK,CAAC,KAAK;4BACxC,IAAI,OAAO,eAAe,UAAU;gCAChC,eAAe;4BACnB;wBACJ;oBACJ;gBACJ,OAAO,IAAI,OAAO,UAAU,OAAO,KAAK,YAAY,UAAU,OAAO,CAAC,MAAM,GAAG,GAAG;oBAC9E,0BAA0B;oBAC1B,eAAe,UAAU,OAAO;gBACpC;YACJ;YAEA,yHAAyH;YACzH,IAAI,iBAAiB,CAAC,oBAAoB,EAAE,SAAS,MAAM,EAAE,IAAI,WAAW;gBACxE,gFAAgF;gBAChF,IAAI,UAAU,KAAK,EAAE,SAAS;oBAC1B,eAAe,OAAO,UAAU,KAAK,CAAC,OAAO;gBACjD;YACJ;YAEA,qFAAqF;YACrF,IAAI,iBAAiB,CAAC,oBAAoB,EAAE,SAAS,MAAM,EAAE,EAAE;gBAC3D,IAAI,SAAS,MAAM,KAAK,KAAK;oBACzB,eAAe;gBACnB,OAAO,IAAI,SAAS,MAAM,KAAK,KAAK;oBAChC,eAAe;gBACnB,OAAO,IAAI,SAAS,MAAM,KAAK,OAAO,SAAS,MAAM,KAAK,KAAK;oBAC3D,eAAe;gBACnB,OAAO,IAAI,SAAS,MAAM,KAAK,KAAK;oBAChC,eAAe;gBACnB;YACJ;YAEA,yCAAyC;YACzC,IAAI,OAAO,iBAAiB,UAAU;gBAClC,eAAe,OAAO;YAC1B;YAEA,MAAM,IAAI,MAAM;QACpB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO,KAAK,WAAW,IAAI,EAAE;IACjC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,wCAAwC;QACtD,wEAAwE;QACxE,IAAI,iBAAiB,OAAO;YACxB,MAAM;QACV;QACA,MAAM,IAAI,MAAM;IACpB;AACJ","debugId":null}},
    {"offset": {"line": 1541, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/lib/services/pdfWordConverter.ts"],"sourcesContent":["import mammoth from 'mammoth';\nimport { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } from 'docx';\nimport { PDFDocument, rgb, StandardFonts } from 'pdf-lib';\nimport type { Suggestion } from '../types/proofreader';\n\n// Helper function to load pdfjs dynamically\nasync function loadPdfJs() {\n  const pdfjs = await import('pdfjs-dist');\n  if (typeof window !== 'undefined' && !pdfjs.GlobalWorkerOptions.workerSrc) {\n    pdfjs.GlobalWorkerOptions.workerSrc = '/pdf.worker.mjs';\n  }\n  return pdfjs;\n}\n\n/**\n * Sanitize text to replace Unicode characters that can't be encoded in WinAnsi\n * with ASCII equivalents\n */\nfunction sanitizeTextForPdf(text: string): string {\n  // Map of common Unicode characters to ASCII equivalents\n  const unicodeMap: Record<string, string> = {\n    '': '->',\n    '': '<-',\n    '': '^',\n    '': 'v',\n    '': '=>',\n    '': '<=',\n    '': '*',\n    '': '-',\n    '': '--',\n    '': '...',\n    '\\u201C': '\"',\n    '\\u201D': '\"',\n    '\\u2018': \"'\",\n    '\\u2019': \"'\",\n    '': '(c)',\n    '': '(R)',\n    '': '(TM)',\n    '': 'EUR',\n    '': 'GBP',\n    '': 'JPY',\n  };\n\n  let sanitized = text;\n  \n  // Replace known Unicode characters\n  Object.entries(unicodeMap).forEach(([unicode, ascii]) => {\n    sanitized = sanitized.replace(new RegExp(unicode, 'g'), ascii);\n  });\n\n  // Remove any remaining non-ASCII characters that can't be encoded\n  // This regex keeps ASCII printable characters (32-126) and common whitespace\n  sanitized = sanitized.replace(/[^\\x20-\\x7E\\n\\r\\t]/g, '?');\n\n  return sanitized;\n}\n\n/**\n * Convert PDF to HTML for rich text editing\n * Uses pdfjs-dist to extract text with layout preservation\n */\nexport async function convertPdfToHtml(pdfUrl: string): Promise<string> {\n  try {\n    // Dynamically load pdfjs\n    const pdfjs = await loadPdfJs();\n\n    // Load PDF bytes\n    let pdfBytes: ArrayBuffer;\n    \n    if (pdfUrl.startsWith('data:')) {\n      const base64Data = pdfUrl.split(',')[1];\n      const binaryString = atob(base64Data);\n      pdfBytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        (pdfBytes as Uint8Array)[i] = binaryString.charCodeAt(i);\n      }\n      pdfBytes = (pdfBytes as Uint8Array).buffer;\n    } else {\n      const response = await fetch(pdfUrl);\n      pdfBytes = await response.arrayBuffer();\n    }\n\n    const pdf = await pdfjs.getDocument({ data: pdfBytes }).promise;\n    const htmlParts: string[] = [];\n\n    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {\n      const page = await pdf.getPage(pageNum);\n      const textContent = await page.getTextContent();\n      \n      // Group text items into paragraphs based on vertical position\n      const lines: { y: number; items: any[] }[] = [];\n      let currentLine: { y: number; items: any[] } | null = null;\n      \n      textContent.items.forEach((item: any) => {\n        const y = item.transform[5];\n        \n        if (!currentLine || Math.abs(currentLine.y - y) > 5) {\n          currentLine = { y, items: [item] };\n          lines.push(currentLine);\n        } else {\n          currentLine.items.push(item);\n        }\n      });\n\n      // Convert lines to HTML paragraphs\n      lines.forEach(line => {\n        const text = line.items.map((item: any) => item.str).join(' ').trim();\n        if (text) {\n          // Detect if it might be a heading (simple heuristic: short lines with larger font)\n          const avgFontSize = line.items.reduce((sum: number, item: any) => \n            sum + (item.height || 12), 0) / line.items.length;\n          \n          if (avgFontSize > 16 && text.length < 100) {\n            htmlParts.push(`<h2>${text}</h2>`);\n          } else {\n            htmlParts.push(`<p>${text}</p>`);\n          }\n        }\n      });\n    }\n\n    return htmlParts.join('\\n');\n  } catch (error) {\n    console.error('Error converting PDF to HTML:', error);\n    throw new Error('Failed to convert PDF to HTML');\n  }\n}\n\n/**\n * Convert HTML from rich text editor to PDF with formatting\n */\nexport async function convertHtmlToPdf(html: string): Promise<string> {\n  try {\n    const pdfDoc = await PDFDocument.create();\n    const font = await pdfDoc.embedFont(StandardFonts.Helvetica);\n    const boldFont = await pdfDoc.embedFont(StandardFonts.HelveticaBold);\n    \n    let currentPage = pdfDoc.addPage([612, 792]); // US Letter size\n    let yPosition = 750;\n    const lineHeight = 18;\n    const margin = 50;\n    const maxWidth = 512;\n\n    // Parse HTML into structured content\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n    const elements = doc.body.children;\n\n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i];\n      const tagName = element.tagName.toLowerCase();\n      let text = element.textContent?.trim() || '';\n      \n      if (!text) continue;\n\n      // Sanitize text for PDF encoding\n      text = sanitizeTextForPdf(text);\n\n      // Determine font size and style based on element type\n      let fontSize = 12;\n      let currentFont = font;\n      let spacing = lineHeight;\n\n      if (tagName.startsWith('h')) {\n        const level = parseInt(tagName[1]);\n        fontSize = 24 - (level * 2);\n        currentFont = boldFont;\n        spacing = lineHeight * 1.5;\n      } else if (tagName === 'strong' || tagName === 'b') {\n        currentFont = boldFont;\n      }\n\n      // Wrap text to fit within page width\n      const words = text.split(' ');\n      let currentLine = '';\n\n      for (const word of words) {\n        const testLine = currentLine ? `${currentLine} ${word}` : word;\n        const textWidth = currentFont.widthOfTextAtSize(testLine, fontSize);\n\n        if (textWidth > maxWidth && currentLine) {\n          // Draw current line\n          if (yPosition < 50) {\n            currentPage = pdfDoc.addPage([612, 792]);\n            yPosition = 750;\n          }\n\n          currentPage.drawText(currentLine, {\n            x: margin,\n            y: yPosition,\n            size: fontSize,\n            font: currentFont,\n            color: rgb(0, 0, 0),\n          });\n\n          yPosition -= spacing;\n          currentLine = word;\n        } else {\n          currentLine = testLine;\n        }\n      }\n\n      // Draw remaining text\n      if (currentLine) {\n        if (yPosition < 50) {\n          currentPage = pdfDoc.addPage([612, 792]);\n          yPosition = 750;\n        }\n\n        currentPage.drawText(currentLine, {\n          x: margin,\n          y: yPosition,\n          size: fontSize,\n          font: currentFont,\n          color: rgb(0, 0, 0),\n        });\n\n        yPosition -= spacing;\n      }\n\n      // Add extra spacing after headings\n      if (tagName.startsWith('h')) {\n        yPosition -= lineHeight * 0.5;\n      }\n    }\n\n    const pdfBytes = await pdfDoc.save();\n    const base64 = btoa(String.fromCharCode(...pdfBytes));\n    return `data:application/pdf;base64,${base64}`;\n  } catch (error) {\n    console.error('Error converting HTML to PDF:', error);\n    throw new Error('Failed to convert HTML to PDF');\n  }\n}\n\n/**\n * Convert Word document to PDF (legacy compatibility)\n */\nexport async function convertWordToPdf(wordBlob: Blob): Promise<string> {\n  try {\n    const html = await wordBlobToHtml(wordBlob);\n    return await convertHtmlToPdf(html);\n  } catch (error) {\n    console.error('Error converting Word to PDF:', error);\n    throw new Error('Failed to convert Word document to PDF');\n  }\n}\n\n/**\n * Apply suggestions to Word document content\n */\nexport function applySuggestionsToWordContent(\n  wordContent: string,\n  suggestions: Suggestion[]\n): string {\n  let modifiedContent = wordContent;\n  \n  suggestions.forEach(suggestion => {\n    // Replace original text with suggestion\n    const regex = new RegExp(suggestion.original.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'gi');\n    modifiedContent = modifiedContent.replace(regex, suggestion.suggestion);\n  });\n  \n  return modifiedContent;\n}\n\n/**\n * Convert Word Blob to HTML string for editing\n */\nexport async function wordBlobToHtml(wordBlob: Blob): Promise<string> {\n  try {\n    const arrayBuffer = await wordBlob.arrayBuffer();\n    const result = await mammoth.convertToHtml({ arrayBuffer });\n    return result.value;\n  } catch (error) {\n    console.error('Error converting Word to HTML:', error);\n    throw new Error('Failed to convert Word document to HTML');\n  }\n}\n\n/**\n * Convert HTML string to Word Blob with formatting preservation\n */\nexport async function htmlToWordBlob(htmlContent: string): Promise<Blob> {\n  try {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(htmlContent, 'text/html');\n    const paragraphs: Paragraph[] = [];\n    \n    // Process each element in the HTML\n    const elements = doc.body.children;\n    \n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i];\n      const tagName = element.tagName.toLowerCase();\n      const text = element.textContent?.trim() || '';\n      \n      if (!text) continue;\n\n      // Determine paragraph properties based on HTML element\n      let paragraphOptions: any = {\n        children: [],\n      };\n\n      // Handle headings\n      if (tagName === 'h1') {\n        paragraphOptions.heading = HeadingLevel.HEADING_1;\n      } else if (tagName === 'h2') {\n        paragraphOptions.heading = HeadingLevel.HEADING_2;\n      } else if (tagName === 'h3') {\n        paragraphOptions.heading = HeadingLevel.HEADING_3;\n      }\n\n      // Handle text alignment (check for style attribute or classes)\n      const style = element.getAttribute('style') || '';\n      if (style.includes('text-align: center')) {\n        paragraphOptions.alignment = AlignmentType.CENTER;\n      } else if (style.includes('text-align: right')) {\n        paragraphOptions.alignment = AlignmentType.RIGHT;\n      } else if (style.includes('text-align: justify')) {\n        paragraphOptions.alignment = AlignmentType.JUSTIFIED;\n      }\n\n      // Create text run with formatting\n      const textRunOptions: any = {\n        text: text,\n      };\n\n      // Check for bold, italic, underline in child elements\n      if (element.querySelector('strong, b')) {\n        textRunOptions.bold = true;\n      }\n      if (element.querySelector('em, i')) {\n        textRunOptions.italics = true;\n      }\n      if (element.querySelector('u')) {\n        textRunOptions.underline = {};\n      }\n\n      paragraphOptions.children.push(new TextRun(textRunOptions));\n      paragraphs.push(new Paragraph(paragraphOptions));\n    }\n\n    const wordDoc = new Document({\n      sections: [\n        {\n          properties: {},\n          children: paragraphs.length > 0 ? paragraphs : [\n            new Paragraph({\n              children: [new TextRun({ text: '' })],\n            }),\n          ],\n        },\n      ],\n    });\n\n    return await Packer.toBlob(wordDoc);\n  } catch (error) {\n    console.error('Error converting HTML to Word:', error);\n    throw new Error('Failed to convert HTML to Word document');\n  }\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1875, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/app/compliance-editor/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useSearchParams } from 'next/navigation';\nimport { motion } from 'framer-motion';\nimport { Upload, FileText, Download } from 'lucide-react';\nimport mammoth from 'mammoth';\n\n// Components\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Progress } from '@/components/ui/progress';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport TinyMCEEditor, { type TinyMCEEditorHandle } from '@/components/editor/TinyMCEEditor';\nimport ProofreadPdfViewer from '@/components/proofreader/ProofreadPdfViewer';\n\n// Services and types\nimport { analyzePdfContent } from '@/lib/services/geminiService';\nimport { convertHtmlToPdf, htmlToWordBlob } from '@/lib/services/pdfWordConverter';\nimport type { Suggestion } from '@/lib/types/proofreader';\nimport { toast } from 'sonner';\nimport { useAppContext } from '@/lib/AppContext';\n\n// Helper function to load pdfjs dynamically\nasync function loadPdfJs() {\n  const pdfjs = await import('pdfjs-dist');\n  if (typeof window !== 'undefined' && !pdfjs.GlobalWorkerOptions.workerSrc) {\n    pdfjs.GlobalWorkerOptions.workerSrc = '/pdf.worker.mjs';\n  }\n  return pdfjs;\n}\n\nexport default function ComplianceEditorPage() {\n  const searchParams = useSearchParams();\n  const documentId = searchParams.get('documentId');\n  const { getDocumentPdfUrl, getDocumentContent, getDocument } = useAppContext();\n\n  const [file, setFile] = useState<File | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n  const [editorContent, setEditorContent] = useState<string>('');\n  const [suggestions, setSuggestions] = useState<Suggestion[]>([]);\n  const [selectedSuggestionIndex, setSelectedSuggestionIndex] = useState<number | null>(null);\n  const [isEditorMode, setIsEditorMode] = useState(false);\n  const [originalFileName, setOriginalFileName] = useState<string>('');\n  const [fileType, setFileType] = useState<'pdf' | 'docx' | null>(null);\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null);\n  const [selectedSuggestion, setSelectedSuggestion] = useState<Suggestion | null>(null);\n  const [isConverting, setIsConverting] = useState(false);\n  \n  const editorRef = useRef<TinyMCEEditorHandle>(null);\n\n  // Cleanup PDF URL on unmount\n  useEffect(() => {\n    return () => {\n      if (pdfUrl) {\n        URL.revokeObjectURL(pdfUrl);\n      }\n    };\n  }, [pdfUrl]);\n\n  // Load PDF URL from AppContext if documentId is provided\n  useEffect(() => {\n    if (!documentId) {\n      console.log('[ComplianceEditor] No documentId provided');\n      return;\n    }\n\n    console.log('[ComplianceEditor] Loading document:', documentId);\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      // Get document metadata\n      const document = getDocument(documentId);\n      if (document) {\n        setOriginalFileName(document.title || 'document');\n        console.log('[ComplianceEditor] Document loaded:', document.title);\n      }\n\n      // Get PDF URL\n      const url = getDocumentPdfUrl(documentId);\n      console.log('[ComplianceEditor] PDF URL retrieved:', url ? 'exists' : 'null');\n\n      if (url) {\n        setPdfUrl(url);\n        setFileType('pdf');\n        console.log('[ComplianceEditor] PDF URL set successfully');\n      } else {\n        console.warn('[ComplianceEditor] No PDF URL found for document');\n        setError('No PDF URL found for this document');\n        setPdfUrl(null);\n      }\n    } catch (e) {\n      console.error('[ComplianceEditor] Error loading PDF:', e);\n      setError('Failed to load PDF');\n      setPdfUrl(null);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [documentId, getDocument, getDocumentPdfUrl]);\n\n  // Load extracted text and fetch AI suggestions\n  useEffect(() => {\n    if (!documentId) return;\n\n    const content = getDocumentContent(documentId);\n    if (content) {\n      console.log('[ComplianceEditor] Content loaded, analyzing...');\n      setProgress(10);\n      \n      analyzePdfContent(content)\n        .then(aiSuggestions => {\n          setSuggestions(aiSuggestions);\n          setProgress(100);\n          toast.success(`Analysis complete! Found ${aiSuggestions.length} suggestions.`);\n        })\n        .catch(err => {\n          console.error('[ComplianceEditor] Analysis error:', err);\n          toast.error('Failed to analyze document');\n        });\n    }\n  }, [documentId, getDocumentContent]);\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0] || null;\n    setFile(selectedFile);\n    setSuggestions([]);\n    setError(null);\n    setEditorContent('');\n    setIsEditorMode(false);\n    // Clean up previous PDF URL\n    if (pdfUrl) {\n      URL.revokeObjectURL(pdfUrl);\n      setPdfUrl(null);\n    }\n    if (selectedFile) {\n      setOriginalFileName(selectedFile.name.replace(/\\.(pdf|docx)$/i, ''));\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!file) {\n      setError('Please select a document to upload.');\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n    setSuggestions([]);\n    setProgress(10);\n\n    try {\n      const fileName = file.name.toLowerCase();\n      const isPdf = fileName.endsWith('.pdf') || file.type === 'application/pdf';\n      const isDocx = fileName.endsWith('.docx') || file.type.includes('officedocument.wordprocessingml');\n\n      if (isPdf) {\n        setFileType('pdf');\n        setProgress(20);\n\n        // Convert PDF to DOCX via backend\n        const formData = new FormData();\n        formData.append('file', file);\n\n        const convertResponse = await fetch('/api/pdf-to-docx', {\n          method: 'POST',\n          body: formData,\n        });\n\n        if (!convertResponse.ok) {\n          throw new Error('Failed to convert PDF to DOCX');\n        }\n\n        const docxBlob = await convertResponse.blob();\n        setProgress(40);\n\n        // Convert DOCX to HTML for TinyMCE\n        const arrayBuffer = await docxBlob.arrayBuffer();\n        const result = await mammoth.convertToHtml({ arrayBuffer });\n        const html = result.value || '';\n        \n        setEditorContent(html);\n        setIsEditorMode(true);\n        \n        setProgress(60);\n\n        // Extract text from PDF for analysis\n        const pdfArrayBuffer = await file.arrayBuffer();\n        const pdfjs = await loadPdfJs();\n        const pdf = await pdfjs.getDocument({ data: pdfArrayBuffer }).promise;\n        let fullText = '';\n\n        for (let i = 1; i <= pdf.numPages; i++) {\n          const page = await pdf.getPage(i);\n          const textContent = await page.getTextContent();\n          const pageText = textContent.items.map((item: any) => item.str).join(' ');\n          fullText += `--- PAGE ${i} ---\\n${pageText}\\n`;\n          setProgress(60 + Math.round((i / pdf.numPages) * 20));\n        }\n\n        setProgress(85);\n\n        // Analyze with AI\n        const aiSuggestions = await analyzePdfContent(fullText);\n        setSuggestions(aiSuggestions);\n        \n        setProgress(100);\n        toast.success(`Document loaded! Found ${aiSuggestions.length} suggestions.`);\n      } else if (isDocx) {\n        setFileType('docx');\n        setProgress(30);\n\n        // Convert DOCX to HTML\n        const arrayBuffer = await file.arrayBuffer();\n        const result = await mammoth.convertToHtml({ arrayBuffer });\n        const html = result.value || '';\n        \n        setEditorContent(html);\n        setIsEditorMode(true);\n        \n        setProgress(60);\n\n        // Extract text for analysis\n        const tmp = document.createElement('div');\n        tmp.innerHTML = html;\n        const plainText = tmp.textContent || tmp.innerText || '';\n        const textWithPages = `--- PAGE 1 ---\\n${plainText}`;\n\n        // Analyze with AI\n        const aiSuggestions = await analyzePdfContent(textWithPages);\n        setSuggestions(aiSuggestions);\n        \n        setProgress(100);\n        toast.success(`Document loaded! Found ${aiSuggestions.length} suggestions.`);\n      } else {\n        throw new Error('Unsupported file type. Please upload a PDF or DOCX file.');\n      }\n    } catch (err) {\n      console.error('Failed to process file:', err);\n      setError(err instanceof Error ? err.message : 'Failed to process the file.');\n      toast.error('Failed to process document');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n\n  const handleGoToSuggestion = (index: number) => {\n    setSelectedSuggestionIndex(index);\n    const suggestion = suggestions[index];\n    if (!suggestion) return;\n\n    if (isEditorMode && editorRef.current) {\n      // Scroll to and highlight the text in editor (use text field, fallback to original for compatibility)\n      const textToHighlight = suggestion.text || suggestion.original || '';\n      if (textToHighlight) {\n        editorRef.current.highlightText(textToHighlight);\n      }\n    } else if (pdfUrl && fileType === 'pdf') {\n      // Navigate to PDF page and highlight\n      setSelectedSuggestion(suggestion);\n    }\n  };\n\n\n  const handleApplySuggestion = (index: number) => {\n    const suggestion = suggestions[index];\n    if (!suggestion || !editorRef.current || !isEditorMode) return;\n\n    // Replace text in editor (use text field, fallback to original for compatibility)\n    const textToReplace = suggestion.text || suggestion.original || '';\n    if (!textToReplace) {\n      toast.error('No text to replace');\n      return;\n    }\n\n    editorRef.current.replaceText(textToReplace, suggestion.suggestion);\n    \n    // Update editor content from editor\n    const newContent = editorRef.current.getContent();\n    setEditorContent(newContent);\n    \n    // Remove applied suggestion from list\n    setSuggestions(prev => prev.filter((_, i) => i !== index));\n    \n    // Adjust selected index if needed\n    if (selectedSuggestionIndex !== null) {\n      if (selectedSuggestionIndex === index) {\n        setSelectedSuggestionIndex(null);\n      } else if (selectedSuggestionIndex > index) {\n        setSelectedSuggestionIndex(selectedSuggestionIndex - 1);\n      }\n    }\n    \n    toast.success('Suggestion applied');\n  };\n\n  const handleSaveAsWord = async () => {\n    if (!editorRef.current || !isEditorMode) {\n      toast.error('No content to save');\n      return;\n    }\n\n    try {\n      // Get current content from editor\n      const content = editorRef.current.getContent();\n      const blob = await htmlToWordBlob(content);\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `${originalFileName || 'document'}_edited.docx`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      \n      toast.success('Document downloaded as Word');\n    } catch (err) {\n      console.error('Save error:', err);\n      toast.error('Failed to save as Word');\n    }\n  };\n\n  const handleSaveAsPdf = async () => {\n    if (!editorRef.current || !isEditorMode) {\n      toast.error('No content to save');\n      return;\n    }\n\n    try {\n      // Get current content from editor\n      const content = editorRef.current.getContent();\n      const pdfDataUrl = await convertHtmlToPdf(content);\n      const a = document.createElement('a');\n      a.href = pdfDataUrl;\n      a.download = `${originalFileName || 'document'}_edited.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      \n      toast.success('Document downloaded as PDF');\n    } catch (err) {\n      console.error('Save error:', err);\n      toast.error('Failed to save as PDF');\n    }\n  };\n\n  const handleConvertToEditor = async () => {\n    if (!pdfUrl) {\n      toast.error('PDF not available for conversion');\n      return;\n    }\n\n    setIsConverting(true);\n    setError(null);\n    setProgress(10);\n\n    try {\n      // Convert PDF to DOCX via backend\n      const response = await fetch(pdfUrl);\n      const blob = await response.blob();\n      const formData = new FormData();\n      formData.append('file', blob, 'document.pdf');\n\n      setProgress(30);\n\n      const convertResponse = await fetch('/api/pdf-to-docx', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!convertResponse.ok) {\n        throw new Error('Failed to convert PDF to DOCX');\n      }\n\n      const docxBlob = await convertResponse.blob();\n      setProgress(60);\n\n      // Convert DOCX to HTML for TinyMCE\n      const arrayBuffer = await docxBlob.arrayBuffer();\n      const result = await mammoth.convertToHtml({ arrayBuffer });\n      const html = result.value || '';\n      \n      setEditorContent(html);\n      setIsEditorMode(true);\n      setProgress(100);\n      \n      toast.success('Document converted to editor mode');\n    } catch (err) {\n      console.error('Conversion error:', err);\n      setError(err instanceof Error ? err.message : 'Failed to convert PDF');\n      toast.error('Failed to convert PDF to editor mode');\n    } finally {\n      setIsConverting(false);\n    }\n  };\n\n  // Add debugging\n  useEffect(() => {\n    console.log('[ComplianceEditor] State:', {\n      file: file?.name,\n      fileType,\n      isEditorMode,\n      pdfUrl: pdfUrl ? 'set' : 'not set',\n      suggestionsCount: suggestions.length,\n      isLoading\n    });\n  }, [file, fileType, isEditorMode, pdfUrl, suggestions.length, isLoading]);\n\n  // Group suggestions by category\n  const groupedSuggestions = suggestions.reduce((acc, suggestion, index) => {\n    const category = suggestion.category || 'compliance';\n    if (!acc[category]) {\n      acc[category] = [];\n    }\n    acc[category].push({ ...suggestion, index });\n    return acc;\n  }, {} as Record<string, Array<Suggestion & { index: number }>>);\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'critical':\n        return 'destructive';\n      case 'warning':\n        return 'default';\n      default:\n        return 'secondary';\n    }\n  };\n\n  const getCategoryLabel = (category: string) => {\n    switch (category) {\n      case 'compliance':\n        return 'Compliance';\n      case 'grammar':\n        return 'Grammar';\n      case 'style':\n        return 'Style';\n      default:\n        return category;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-screen bg-zinc-50 dark:bg-zinc-950 text-center gap-4 px-6\">\n        <Card className=\"w-full max-w-md border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n          <CardHeader>\n            <CardTitle className=\"text-gray-900 dark:text-gray-50\">Analyzing Document...</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Progress value={progress} />\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n              {progress < 30 ? 'Loading document...' : \n               progress < 70 ? 'Extracting text...' :\n               'Analyzing compliance...'}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.5 }}\n      className=\"min-h-screen bg-zinc-50 dark:bg-zinc-950 p-4 sm:p-6 lg:p-8\"\n    >\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-50 mb-2\">\n            Financial Compliance Editor\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Upload documents for FINRA/SEC compliance review and editing\n          </p>\n        </div>\n\n        {!isEditorMode && !file && !pdfUrl && !documentId && (\n          <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n            <CardHeader>\n              <CardTitle className=\"text-gray-900 dark:text-gray-50\">Upload Document</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {error && (\n                <Alert variant=\"destructive\">\n                  <AlertTitle>Error</AlertTitle>\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"file-upload\">Select PDF or Word Document</Label>\n                <div className=\"flex gap-3\">\n                  <Input\n                    id=\"file-upload\"\n                    type=\"file\"\n                    accept=\".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document\"\n                    onChange={handleFileChange}\n                  />\n                  <Button onClick={handleUpload} disabled={!file}>\n                    <Upload className=\"h-4 w-4 mr-2\" />\n                    Analyze\n                  </Button>\n                </div>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  Supported formats: PDF, DOCX (up to 10MB)\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {(isEditorMode || file || pdfUrl) && (\n          <>\n            <div className=\"mb-4 flex justify-between items-center\">\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"outline\">{file?.name || originalFileName || 'Document'}</Badge>\n                {suggestions.length > 0 && (\n                  <Badge variant=\"secondary\">{suggestions.length} suggestions found</Badge>\n                )}\n              </div>\n              <div className=\"flex gap-2\">\n                {pdfUrl && fileType === 'pdf' && !isEditorMode && (\n                  <Button\n                    variant=\"default\"\n                    onClick={handleConvertToEditor}\n                    disabled={isConverting}\n                  >\n                    {isConverting ? 'Converting...' : 'Edit Document'}\n                  </Button>\n                )}\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setFile(null);\n                    setIsEditorMode(false);\n                    setSuggestions([]);\n                    setEditorContent('');\n                    setFileType(null);\n                    setPdfUrl(null);\n                    setSelectedSuggestion(null);\n                  }}\n                >\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                  New Document\n                </Button>\n              </div>\n            </div>\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              {/* Document Viewer/Editor Panel */}\n              <div className=\"lg:col-span-2\">\n                {isEditorMode ? (\n                  <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-gray-900 dark:text-gray-50\">\n                          Document Editor\n                        </CardTitle>\n                        <div className=\"flex gap-2\">\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\" \n                            onClick={handleSaveAsWord}\n                          >\n                            <Download className=\"h-4 w-4 mr-2\" />\n                            Download as Word\n                          </Button>\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\" \n                            onClick={handleSaveAsPdf}\n                          >\n                            <Download className=\"h-4 w-4 mr-2\" />\n                            Download as PDF\n                          </Button>\n                        </div>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"p-0\">\n                      <TinyMCEEditor\n                        ref={editorRef}\n                        content={editorContent}\n                        onContentChange={setEditorContent}\n                        suggestions={suggestions}\n                        selectedSuggestionIndex={selectedSuggestionIndex}\n                      />\n                    </CardContent>\n                  </Card>\n                ) : pdfUrl && fileType === 'pdf' ? (\n                  <ProofreadPdfViewer\n                    pdfUrl={pdfUrl}\n                    suggestions={suggestions}\n                    selectedSuggestion={selectedSuggestion}\n                    onSuggestionClick={setSelectedSuggestion}\n                    onApplyEdit={(pageNumber, originalText, newText) => {\n                      // Handle edit application - for now just show a toast\n                      toast.info('Convert to editor mode to apply changes');\n                    }}\n                  />\n                ) : (\n                  <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\">\n                    <CardContent className=\"p-6 text-center text-gray-600 dark:text-gray-400\">\n                      <FileText className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                      <p>Upload a document to get started</p>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n\n            {/* Suggestions Panel */}\n            <div className=\"lg:col-span-1\">\n              <Card className=\"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 sticky top-6\">\n                <CardHeader>\n                  <CardTitle className=\"text-gray-900 dark:text-gray-50 flex items-center justify-between\">\n                    <span>Suggestions</span>\n                    <Badge variant=\"secondary\">{suggestions.length}</Badge>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"max-h-[calc(100vh-200px)] overflow-y-auto space-y-4\">\n                  {suggestions.length === 0 ? (\n                    <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                      <p>No suggestions found</p>\n                      <p className=\"text-sm mt-2\">Your document looks good!</p>\n                    </div>\n                  ) : (\n                    <>\n                      {Object.entries(groupedSuggestions).map(([category, items]) => (\n                        <div key={category}>\n                          <div className=\"flex items-center gap-2 mb-3\">\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {getCategoryLabel(category)}\n                            </Badge>\n                            <Separator className=\"flex-1\" />\n                          </div>\n                          \n                          <div className=\"space-y-3\">\n                            {items.map((item) => (\n                              <Card \n                                key={item.index}\n                                className={`border cursor-pointer transition-colors ${\n                                  selectedSuggestionIndex === item.index\n                                    ? 'border-emerald-500 dark:border-emerald-600 bg-emerald-50 dark:bg-emerald-950'\n                                    : 'border-zinc-200 dark:border-zinc-700'\n                                }`}\n                                onClick={() => handleGoToSuggestion(item.index)}\n                              >\n                                <CardContent className=\"p-3 space-y-2\">\n                                  <div className=\"flex items-start justify-between gap-2\">\n                                    <Badge variant={getSeverityColor(item.severity || 'warning') as any} className=\"text-xs\">\n                                      {item.severity || 'warning'}\n                                    </Badge>\n                                    <span className=\"text-xs text-gray-500\">Page {item.page}</span>\n                                  </div>\n                                  \n                                  <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n                                    {item.issue || item.explanation || 'Issue found'}\n                                  </p>\n                                  \n                                  <div className=\"text-xs space-y-1\">\n                                    <p className=\"text-red-600 dark:text-red-400\">\n                                      <span className=\"font-semibold\">Original:</span> {item.text || item.original || ''}\n                                    </p>\n                                    <p className=\"text-green-600 dark:text-green-400\">\n                                      <span className=\"font-semibold\">Suggested:</span> {item.suggestion}\n                                    </p>\n                                  </div>\n                                  \n                                  {isEditorMode && (\n                                    <Button\n                                      variant=\"default\"\n                                      size=\"sm\"\n                                      className=\"w-full mt-2\"\n                                      onClick={(e) => {\n                                        e.stopPropagation();\n                                        handleApplySuggestion(item.index);\n                                      }}\n                                    >\n                                      Apply Change\n                                    </Button>\n                                  )}\n                                </CardContent>\n                              </Card>\n                            ))}\n                          </div>\n                        </div>\n                      ))}\n                    </>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n          </>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}}]
}