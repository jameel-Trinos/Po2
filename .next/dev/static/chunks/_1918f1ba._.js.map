{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/lib/services/geminiService.ts"],"sourcesContent":["import type { Suggestion } from '../types/proofreader';\n\nexport async function analyzePdfContent(pdfTextByPage: string): Promise<Suggestion[]> {\n    try {\n        const response = await fetch('/api/analyze', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ pdfTextByPage }),\n        });\n\n        if (!response.ok) {\n            const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));\n            throw new Error(errorData.error || `HTTP error! status: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data.suggestions || [];\n    } catch (error) {\n        console.error(\"Error analyzing content with Gemini:\", error);\n        throw new Error(\"Failed to get suggestions from the AI. Please check the console for details.\");\n    }\n}\n"],"names":[],"mappings":";;;;AAEO,eAAe,kBAAkB,aAAqB;IACzD,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,gBAAgB;YACzC,QAAQ;YACR,SAAS;gBACL,gBAAgB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAc;QACzC;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,YAAY,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC;oBAAE,OAAO;gBAAgB,CAAC;YAC/E,MAAM,IAAI,MAAM,UAAU,KAAK,IAAI,CAAC,oBAAoB,EAAE,SAAS,MAAM,EAAE;QAC/E;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO,KAAK,WAAW,IAAI,EAAE;IACjC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,wCAAwC;QACtD,MAAM,IAAI,MAAM;IACpB;AACJ","debugId":null}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/proofreader/icons.tsx"],"sourcesContent":["import React from 'react';\n\nexport const EditIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    stroke=\"currentColor\"\n    strokeWidth=\"2\"\n    strokeLinecap=\"round\"\n    strokeLinejoin=\"round\"\n    {...props}\n  >\n    <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\" />\n    <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4Z\" />\n  </svg>\n);\n\nexport const CheckCircleIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    stroke=\"currentColor\"\n    strokeWidth=\"2\"\n    strokeLinecap=\"round\"\n    strokeLinejoin=\"round\"\n    {...props}\n  >\n    <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\" />\n    <path d=\"m9 11 3 3L22 4\" />\n  </svg>\n);\n"],"names":[],"mappings":";;;;;;;;AAEO,MAAM,WAAoD,CAAC,sBAChE,6LAAC;QACC,OAAM;QACN,OAAM;QACN,QAAO;QACP,SAAQ;QACR,MAAK;QACL,QAAO;QACP,aAAY;QACZ,eAAc;QACd,gBAAe;QACd,GAAG,KAAK;;0BAET,6LAAC;gBAAK,GAAE;;;;;;0BACR,6LAAC;gBAAK,GAAE;;;;;;;;;;;;KAdC;AAkBN,MAAM,kBAA2D,CAAC,sBACvE,6LAAC;QACC,OAAM;QACN,OAAM;QACN,QAAO;QACP,SAAQ;QACR,MAAK;QACL,QAAO;QACP,aAAY;QACZ,eAAc;QACd,gBAAe;QACd,GAAG,KAAK;;0BAET,6LAAC;gBAAK,GAAE;;;;;;0BACR,6LAAC;gBAAK,GAAE;;;;;;;;;;;;MAdC","debugId":null}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/proofreader/SuggestionSidebar.tsx"],"sourcesContent":["import React from 'react';\nimport type { Suggestion } from '../../lib/types/proofreader';\nimport { EditIcon, CheckCircleIcon } from './icons';\n\ninterface SuggestionSidebarProps {\n  suggestions: Suggestion[];\n  onSuggestionClick: (suggestion: Suggestion) => void;\n  selectedSuggestion: Suggestion | null;\n  onEditPage: (pageNum: number) => void;\n}\n\nconst SuggestionSidebar: React.FC<SuggestionSidebarProps> = ({ suggestions, onSuggestionClick, selectedSuggestion, onEditPage }) => {\n  return (\n    <div className=\"bg-slate-800/50 border border-slate-700 rounded-xl shadow-lg sticky top-24\">\n      <div className=\"p-4 border-b border-slate-700\">\n        <h2 className=\"text-lg font-semibold text-white\">AI Suggestions ({suggestions.length})</h2>\n      </div>\n      <div className=\"max-h-[calc(100vh-12rem)] overflow-y-auto\">\n        {suggestions.length === 0 ? (\n          <div className=\"p-6 text-center text-slate-400 flex flex-col items-center gap-4\">\n            <CheckCircleIcon className=\"w-12 h-12 text-green-500\" />\n            <p className=\"font-semibold\">No suggestions found!</p>\n            <p>The document looks great from a grammatical standpoint.</p>\n          </div>\n        ) : (\n          <ul className=\"divide-y divide-slate-700\">\n            {suggestions.map((s, index) => (\n              <li\n                key={index}\n                onClick={() => onSuggestionClick(s)}\n                className={`p-4 cursor-pointer transition-colors duration-200 ${selectedSuggestion === s ? 'bg-cyan-900/50' : 'hover:bg-slate-700/50'}`}\n              >\n                <div className=\"flex justify-between items-start mb-2\">\n                    <p className=\"text-sm font-semibold text-cyan-400\">Page {s.page}</p>\n                    <button onClick={(e) => { e.stopPropagation(); onEditPage(s.page); }} className=\"text-xs flex items-center gap-1 text-slate-300 hover:text-white transition-colors\">\n                        <EditIcon className=\"w-3 h-3\"/> Edit Page\n                    </button>\n                </div>\n                <p className=\"text-sm text-slate-400 mb-1 line-through\">{s.original}</p>\n                <p className=\"text-sm text-green-400 font-medium\">\"{s.suggestion}\"</p>\n                <p className=\"text-xs text-slate-500 mt-2 italic\">Reason: {s.explanation}</p>\n              </li>\n            ))}\n          </ul>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SuggestionSidebar;\n"],"names":[],"mappings":";;;;;AAEA;;;AASA,MAAM,oBAAsD,CAAC,EAAE,WAAW,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,UAAU,EAAE;IAC7H,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAG,WAAU;;wBAAmC;wBAAiB,YAAY,MAAM;wBAAC;;;;;;;;;;;;0BAEvF,6LAAC;gBAAI,WAAU;0BACZ,YAAY,MAAM,KAAK,kBACtB,6LAAC;oBAAI,WAAU;;sCACb,6LAAC,yJAAe;4BAAC,WAAU;;;;;;sCAC3B,6LAAC;4BAAE,WAAU;sCAAgB;;;;;;sCAC7B,6LAAC;sCAAE;;;;;;;;;;;6EAGL,6LAAC;oBAAG,WAAU;8BACX,YAAY,GAAG,CAAC,CAAC,GAAG,sBACnB,6LAAC;4BAEC,SAAS,IAAM,kBAAkB;4BACjC,WAAW,CAAC,kDAAkD,EAAE,uBAAuB,IAAI,mBAAmB,yBAAyB;;8CAEvI,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAE,WAAU;;gDAAsC;gDAAM,EAAE,IAAI;;;;;;;sDAC/D,6LAAC;4CAAO,SAAS,CAAC;gDAAQ,EAAE,eAAe;gDAAI,WAAW,EAAE,IAAI;4CAAG;4CAAG,WAAU;;8DAC5E,6LAAC,kJAAQ;oDAAC,WAAU;;;;;;gDAAW;;;;;;;;;;;;;8CAGvC,6LAAC;oCAAE,WAAU;8CAA4C,EAAE,QAAQ;;;;;;8CACnE,6LAAC;oCAAE,WAAU;;wCAAqC;wCAAE,EAAE,UAAU;wCAAC;;;;;;;8CACjE,6LAAC;oCAAE,WAAU;;wCAAqC;wCAAS,EAAE,WAAW;;;;;;;;2BAZnE;;;;;;;;;;;;;;;;;;;;;AAoBrB;KArCM;uCAuCS","debugId":null}},
    {"offset": {"line": 298, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/proofreader/EditableHighlight.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport type { Suggestion } from '../../lib/types/proofreader';\nimport { CheckCircleIcon } from './icons';\n\ninterface EditableHighlightProps {\n    suggestion: Suggestion;\n    box: {\n        left: number;\n        top: number;\n        width: number;\n        height: number;\n    };\n    onApplyEdit: (pageNumber: number, originalText: string, newText: string) => void;\n    onCancelEdit: () => void;\n}\n\nconst EditableHighlight: React.FC<EditableHighlightProps> = ({ suggestion, box, onApplyEdit, onCancelEdit }) => {\n    const [editedText, setEditedText] = useState(suggestion.suggestion);\n    const wrapperRef = useRef<HTMLDivElement>(null);\n\n    // Close on click outside\n    useEffect(() => {\n        function handleClickOutside(event: MouseEvent) {\n            if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {\n                onCancelEdit();\n            }\n        }\n        document.addEventListener(\"mousedown\", handleClickOutside);\n        return () => {\n            document.removeEventListener(\"mousedown\", handleClickOutside);\n        };\n    }, [wrapperRef, onCancelEdit]);\n    \n    const handleApply = () => {\n        onApplyEdit(suggestion.page, suggestion.original, editedText);\n    };\n\n    return (\n        <div\n            ref={wrapperRef}\n            className=\"absolute z-10 bg-slate-800 border border-cyan-500 rounded-lg shadow-2xl p-4 w-96 transform -translate-y-full -translate-x-1/2\"\n            style={{\n                left: `${box.left + box.width / 2}px`,\n                top: `${box.top - 10}px`,\n                // Basic boundary detection to prevent going off-screen\n                maxWidth: 'calc(100vw - 32px)', \n            }}\n            onClick={e => e.stopPropagation()}\n        >\n            <div className=\"flex justify-between items-center mb-2\">\n                 <h3 className=\"text-md font-semibold text-white\">Apply Suggestion</h3>\n                 <button onClick={onCancelEdit} className=\"text-slate-400 hover:text-white text-2xl leading-none\">&times;</button>\n            </div>\n\n            <div className=\"space-y-3 text-sm\">\n                <div>\n                    <span className=\"text-slate-400\">Original: </span>\n                    <span className=\"line-through text-red-400\">{suggestion.original}</span>\n                </div>\n                 <p className=\"text-xs text-slate-500 italic\">Reason: {suggestion.explanation}</p>\n                <div>\n                     <label htmlFor=\"suggestion-edit\" className=\"block text-slate-300 font-medium mb-1\">Correction:</label>\n                     <textarea\n                        id=\"suggestion-edit\"\n                        value={editedText}\n                        onChange={(e) => setEditedText(e.target.value)}\n                        className=\"w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-slate-200 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition text-sm\"\n                        rows={3}\n                     />\n                </div>\n            </div>\n           \n            <div className=\"mt-4 flex justify-end gap-2\">\n                <button\n                    onClick={onCancelEdit}\n                    className=\"px-3 py-1.5 bg-slate-600 hover:bg-slate-700 rounded-md text-white font-semibold transition-colors text-xs\"\n                >\n                    Cancel\n                </button>\n                <button\n                    onClick={handleApply}\n                    className=\"px-3 py-1.5 bg-green-600 hover:bg-green-700 rounded-md text-white font-semibold transition-colors text-xs flex items-center gap-1.5\"\n                >\n                    <CheckCircleIcon className=\"w-4 h-4\" />\n                    Apply Change\n                </button>\n            </div>\n        </div>\n    );\n};\n\nexport default EditableHighlight;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;;AAcA,MAAM,oBAAsD,CAAC,EAAE,UAAU,EAAE,GAAG,EAAE,WAAW,EAAE,YAAY,EAAE;;IACvG,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC,WAAW,UAAU;IAClE,MAAM,aAAa,IAAA,uKAAM,EAAiB;IAE1C,yBAAyB;IACzB,IAAA,0KAAS;uCAAC;YACN,SAAS,mBAAmB,KAAiB;gBACzC,IAAI,WAAW,OAAO,IAAI,CAAC,WAAW,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;oBAC1E;gBACJ;YACJ;YACA,SAAS,gBAAgB,CAAC,aAAa;YACvC;+CAAO;oBACH,SAAS,mBAAmB,CAAC,aAAa;gBAC9C;;QACJ;sCAAG;QAAC;QAAY;KAAa;IAE7B,MAAM,cAAc;QAChB,YAAY,WAAW,IAAI,EAAE,WAAW,QAAQ,EAAE;IACtD;IAEA,qBACI,6LAAC;QACG,KAAK;QACL,WAAU;QACV,OAAO;YACH,MAAM,GAAG,IAAI,IAAI,GAAG,IAAI,KAAK,GAAG,EAAE,EAAE,CAAC;YACrC,KAAK,GAAG,IAAI,GAAG,GAAG,GAAG,EAAE,CAAC;YACxB,uDAAuD;YACvD,UAAU;QACd;QACA,SAAS,CAAA,IAAK,EAAE,eAAe;;0BAE/B,6LAAC;gBAAI,WAAU;;kCACV,6LAAC;wBAAG,WAAU;kCAAmC;;;;;;kCACjD,6LAAC;wBAAO,SAAS;wBAAc,WAAU;kCAAwD;;;;;;;;;;;;0BAGtG,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;;0CACG,6LAAC;gCAAK,WAAU;0CAAiB;;;;;;0CACjC,6LAAC;gCAAK,WAAU;0CAA6B,WAAW,QAAQ;;;;;;;;;;;;kCAEnE,6LAAC;wBAAE,WAAU;;4BAAgC;4BAAS,WAAW,WAAW;;;;;;;kCAC7E,6LAAC;;0CACI,6LAAC;gCAAM,SAAQ;gCAAkB,WAAU;0CAAwC;;;;;;0CACnF,6LAAC;gCACE,IAAG;gCACH,OAAO;gCACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;gCAC7C,WAAU;gCACV,MAAM;;;;;;;;;;;;;;;;;;0BAKlB,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBACG,SAAS;wBACT,WAAU;kCACb;;;;;;kCAGD,6LAAC;wBACG,SAAS;wBACT,WAAU;;0CAEV,6LAAC,yJAAe;gCAAC,WAAU;;;;;;4BAAY;;;;;;;;;;;;;;;;;;;AAM3D;GAzEM;KAAA;uCA2ES","debugId":null}},
    {"offset": {"line": 499, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/components/proofreader/PdfViewer.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport type { Suggestion } from '../../lib/types/proofreader';\nimport EditableHighlight from './EditableHighlight';\n\ninterface PdfViewerProps {\n  extractedText: string;\n  suggestions: Suggestion[];\n  selectedSuggestion: Suggestion | null;\n  onSuggestionClick: (suggestion: Suggestion | null) => void;\n  onApplyEdit: (pageNumber: number, originalText: string, newText: string) => void;\n}\n\nconst PdfViewer: React.FC<PdfViewerProps> = ({\n  extractedText,\n  suggestions,\n  selectedSuggestion,\n  onSuggestionClick,\n  onApplyEdit,\n}) => {\n  const viewerRef = useRef<HTMLDivElement>(null);\n  const [activeHighlightBox, setActiveHighlightBox] = useState<{ left: number; top: number; width: number; height: number } | null>(null);\n\n  const getBoundingBox = useCallback((text: string, original: string, pageContent: string) => {\n    const pageOffset = pageContent.indexOf(text);\n    if (pageOffset === -1) return null;\n\n    const lines = pageContent.substring(0, pageOffset).split('\\n');\n    const lineNumber = lines.length - 1;\n    const charOffsetInLine = lines[lines.length - 1].length;\n\n    // Simplified bounding box calculation for plain text. This would be much more complex with a real PDF viewer.\n    // For now, we'll just approximate a box around the first occurrence of the original text.\n    const dummyElement = document.createElement('span');\n    dummyElement.style.position = 'absolute';\n    dummyElement.style.visibility = 'hidden';\n    dummyElement.textContent = original;\n    viewerRef.current?.appendChild(dummyElement);\n    const rect = dummyElement.getBoundingClientRect();\n    viewerRef.current?.removeChild(dummyElement);\n\n    // These values are highly dependent on the rendering of <pre> and would need fine-tuning\n    // or a more sophisticated text measurement. For a true PDF viewer, this would come from the PDF library.\n    const lineHeight = 20; // Approximation\n    const charWidth = 9;   // Approximation\n\n    const startCharIndex = text.indexOf(original);\n    if (startCharIndex === -1) return null;\n\n    // Calculate approximate position based on character and line numbers\n    // This is a very rough estimation for a plain <pre> tag\n    const containerRect = viewerRef.current?.getBoundingClientRect();\n    if (!containerRect) return null;\n\n    const relativeLeft = charOffsetInLine * charWidth;\n    const relativeTop = lineNumber * lineHeight;\n\n    return {\n      left: containerRect.left + relativeLeft,\n      top: containerRect.top + relativeTop,\n      width: original.length * charWidth,\n      height: lineHeight,\n    };\n  }, []);\n\n  useEffect(() => {\n    if (selectedSuggestion && viewerRef.current) {\n      const pages = extractedText.split(/--- PAGE \\d+ ---\\n/).filter(Boolean);\n      const targetPageContent = pages[selectedSuggestion.page - 1];\n\n      if (targetPageContent) {\n        const box = getBoundingBox(targetPageContent, selectedSuggestion.original, targetPageContent);\n        if (box) {\n          setActiveHighlightBox(box);\n          // Scroll to the highlight\n          window.scrollTo({\n            top: box.top + window.scrollY - 100, // Offset for better visibility\n            behavior: 'smooth',\n          });\n        }\n      }\n    } else {\n      setActiveHighlightBox(null);\n    }\n  }, [selectedSuggestion, extractedText, getBoundingBox]);\n\n  const handleApply = (pageNumber: number, originalText: string, newText: string) => {\n    onApplyEdit(pageNumber, originalText, newText);\n    onSuggestionClick(null); // Close highlight after applying\n  };\n\n  const handleCancel = () => {\n    onSuggestionClick(null); // Close highlight\n  };\n\n  return (\n    <div ref={viewerRef} className=\"relative p-4 bg-zinc-100 dark:bg-zinc-800 rounded-lg shadow-inner min-h-[500px]\">\n      <h2 className=\"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4\">Document Content</h2>\n      <pre className=\"whitespace-pre-wrap font-mono text-gray-700 dark:text-gray-300 text-sm\">\n        {extractedText.split(/--- PAGE \\d+ ---\\n/).map((pageContent, index) => {\n          if (index === 0 && !pageContent.includes('---')) return null;\n          const [pageNumberStr, ...rest] = pageContent.split(' ---\\n');\n          const currentPageContent = rest.join(' ---\\n');\n          const pageNum = parseInt(pageNumberStr);\n\n          // Highlight original text if it's the selected suggestion's page\n          const highlightedContent = selectedSuggestion && selectedSuggestion.page === pageNum\n            ? currentPageContent.split(selectedSuggestion.original).map((part, i) => (\n                <React.Fragment key={i}>\n                  {part}\n                  {i < currentPageContent.split(selectedSuggestion.original).length - 1 && (\n                    <span className=\"bg-yellow-300 dark:bg-yellow-700 bg-opacity-50 rounded px-0.5 cursor-pointer\"\n                          onClick={() => onSuggestionClick(selectedSuggestion)}>\n                      {selectedSuggestion.original}\n                    </span>\n                  )}\n                </React.Fragment>\n              ))\n            : currentPageContent;\n\n          return (\n            <div key={index} className=\"mb-4\">\n              <h3 className=\"text-lg font-semibold text-blue-600 dark:text-blue-400 mb-2\">Page {pageNumberStr}</h3>\n              <p>{highlightedContent}</p>\n            </div>\n          );\n        })}\n      </pre>\n\n      {selectedSuggestion && activeHighlightBox && (\n        <EditableHighlight\n          suggestion={selectedSuggestion}\n          box={activeHighlightBox}\n          onApplyEdit={handleApply}\n          onCancelEdit={handleCancel}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default PdfViewer;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 682, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/app/editor/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from 'react';\nimport { useSearchParams } from 'next/navigation';\nimport { useAppContext } from '../../lib/AppContext';\nimport { motion } from 'framer-motion';\n\n// import * as pdfjs from 'pdfjs-dist'; // Remove direct import\n\nimport { analyzePdfContent } from '../../lib/services/geminiService';\nimport type { Suggestion } from '../../lib/types/proofreader';\nimport SuggestionSidebar from '../../components/proofreader/SuggestionSidebar';\nimport PdfViewer from '../../components/proofreader/PdfViewer';\n\n// Placeholder for a Spinner component\nconst Spinner = () => (\n  <div className=\"flex items-center justify-center\">\n    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 dark:border-gray-100\"></div>\n  </div>\n);\n\nexport default function EditorPage() {\n  const searchParams = useSearchParams();\n  const documentId = searchParams.get('documentId');\n  const { getDocumentContent } = useAppContext();\n\n  const [extractedText, setExtractedText] = useState<string>('');\n  const [suggestions, setSuggestions] = useState<Suggestion[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedSuggestion, setSelectedSuggestion] = useState<Suggestion | null>(null);\n  const [pdfjsLib, setPdfjsLib] = useState<any>(null);\n\n  useEffect(() => {\n    // Dynamically import pdfjs-dist on the client-side\n    const loadPdfjs = async () => {\n      const pdfjs = await import('pdfjs-dist');\n      pdfjs.GlobalWorkerOptions.workerSrc = '/pdf.worker.mjs';\n      setPdfjsLib(pdfjs);\n    };\n    loadPdfjs();\n  }, []);\n\n  useEffect(() => {\n    if (documentId) {\n      const content = getDocumentContent(documentId);\n      if (content) {\n        setExtractedText(content);\n        // Analyze content for suggestions\n        const fetchSuggestions = async () => {\n          setIsLoading(true);\n          setError(null);\n          try {\n            // Ensure pdfjsLib is loaded before calling analyzePdfContent if it internally uses pdfjs-dist\n            // For now, analyzePdfContent doesn't directly use pdfjs-dist, but if it did, we'd await pdfjsLib\n            const aiSuggestions = await analyzePdfContent(content);\n            setSuggestions(aiSuggestions);\n          } catch (e) {\n            console.error(\"Failed to get suggestions from AI:\", e);\n            setError(\"Could not retrieve AI suggestions. Ensure your API_KEY is set.\");\n          } finally {\n            setIsLoading(false);\n          }\n        };\n        fetchSuggestions();\n      } else {\n        setError(\"Document content not found.\");\n      }\n    } else {\n      setError(\"No document ID provided.\");\n    }\n  }, [documentId, getDocumentContent]);\n\n  const handleApplyEdit = (pageNumber: number, originalText: string, newText: string) => {\n    setExtractedText((prevText) => {\n      const pageIdentifier = `--- PAGE ${pageNumber} ---\\n`;\n      const parts = prevText.split(pageIdentifier);\n      if (parts.length > 1) {\n        const beforePage = parts[0];\n        const pageContentAndAfter = parts.slice(1).join(pageIdentifier);\n\n        const pageContentParts = pageContentAndAfter.split(originalText);\n        if (pageContentParts.length > 1) {\n          const newPageContent = pageContentParts[0] + newText + pageContentParts.slice(1).join(originalText);\n          return beforePage + pageIdentifier + newPageContent;\n        }\n      }\n      return prevText;\n    });\n    setSuggestions((prevSuggestions) => prevSuggestions.filter(s => !(s.page === pageNumber && s.original === originalText)));\n    setSelectedSuggestion(null);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-screen bg-zinc-50 dark:bg-zinc-950 text-center\">\n        <Spinner />\n        <h2 className=\"mt-4 text-2xl font-semibold text-gray-800 dark:text-gray-100\">Loading Document and Suggestions...</h2>\n        <p className=\"text-gray-600 dark:text-gray-400 mt-2\">Please wait.</p>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-screen bg-zinc-50 dark:bg-zinc-950 text-center text-red-600 dark:text-red-400\">\n        <h2 className=\"text-2xl font-semibold\">Error: {error}</h2>\n        <p className=\"text-gray-600 dark:text-gray-400 mt-2\">Please go back and try uploading again.</p>\n      </div>\n    );\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.5 }}\n      className=\"min-h-screen bg-zinc-50 dark:bg-zinc-950 p-4 sm:p-6 lg:p-8 flex justify-center\"\n    >\n      <div className=\"max-w-6xl w-full bg-white dark:bg-zinc-900 p-8 rounded-2xl shadow-xl border border-zinc-200 dark:border-zinc-800 flex flex-col lg:flex-row gap-8\">\n        {/* Document Viewer Area */}\n        <div className=\"flex-1\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-50 mb-7 text-center\">Document Editor</h1>\n          <PdfViewer\n            extractedText={extractedText}\n            suggestions={suggestions}\n            selectedSuggestion={selectedSuggestion}\n            onSuggestionClick={setSelectedSuggestion}\n            onApplyEdit={handleApplyEdit}\n          />\n        </div>\n\n        {/* Suggestion Sidebar Area */}\n        <div className=\"lg:w-1/3\">\n          <SuggestionSidebar\n            suggestions={suggestions}\n            onSuggestionClick={setSelectedSuggestion}\n            selectedSuggestion={selectedSuggestion}\n            onEditPage={(pageNum) => {\n              console.log(`Edit page ${pageNum} - functionality implemented via direct highlight interaction.`);\n              const suggestionToHighlight = suggestions.find(s => s.page === pageNum);\n              if (suggestionToHighlight) {\n                setSelectedSuggestion(suggestionToHighlight);\n              }\n            }}\n          />\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}