{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Trinos/Learning/PointofTwo/Po2/app/api/analyze/route.ts"],"sourcesContent":["import { GoogleGenAI, Type } from \"@google/genai\";\nimport type { Suggestion } from '@/lib/types/proofreader';\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Check for GEMINI_API_KEY (server-side) or NEXT_PUBLIC_API_KEY (for backward compatibility)\n    const apiKey = process.env.GEMINI_API_KEY || process.env.NEXT_PUBLIC_API_KEY;\n    \n    if (!apiKey) {\n      return NextResponse.json(\n        { error: \"API_KEY environment variable not set. Please set GEMINI_API_KEY or NEXT_PUBLIC_API_KEY.\" },\n        { status: 500 }\n      );\n    }\n\n    const { pdfTextByPage } = await request.json();\n\n    if (!pdfTextByPage || typeof pdfTextByPage !== 'string') {\n      return NextResponse.json(\n        { error: \"Invalid request: pdfTextByPage is required.\" },\n        { status: 400 }\n      );\n    }\n\n    const ai = new GoogleGenAI({ apiKey });\n\n    const prompt = `\n      You are an expert proofreader. Analyze the following text extracted from a PDF document. The text for each page is separated by '--- PAGE [number] ---'.\n      Identify any language errors, including grammatical mistakes, spelling errors, awkward phrasing, and punctuation issues.\n      For each error you find, provide the original problematic text snippet, a corrected version, a brief explanation for the change, and the page number where it was found.\n      Return your findings as a JSON array. Do not include suggestions if the text is perfect. If there are no errors, return an empty array.\n\n      Here is the text:\n      ${pdfTextByPage}\n    `;\n\n    const responseSchema = {\n      type: Type.ARRAY,\n      items: {\n        type: Type.OBJECT,\n        properties: {\n          page: {\n            type: Type.INTEGER,\n            description: \"The page number where the error was found.\",\n          },\n          original: {\n            type: Type.STRING,\n            description: \"The original text snippet with the error.\",\n          },\n          suggestion: {\n            type: Type.STRING,\n            description: \"The suggested correction for the text.\",\n          },\n          explanation: {\n            type: Type.STRING,\n            description: \"A brief explanation of why the correction is needed.\",\n          },\n        },\n        required: [\"page\", \"original\", \"suggestion\", \"explanation\"],\n      },\n    };\n\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-flash',\n      contents: prompt,\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: responseSchema,\n      },\n    });\n\n    const jsonText = response.text.trim();\n    const suggestions: Suggestion[] = JSON.parse(jsonText);\n    \n    return NextResponse.json({ suggestions });\n  } catch (error) {\n    console.error(\"Error analyzing content with Gemini:\", error);\n    return NextResponse.json(\n      { error: \"Failed to get suggestions from the AI. Please check the console for details.\" },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,6FAA6F;QAC7F,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QAEzC;;QAOA,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE5C,IAAI,CAAC,iBAAiB,OAAO,kBAAkB,UAAU;YACvD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8C,GACvD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,KAAK,IAAI,4KAAW,CAAC;YAAE;QAAO;QAEpC,MAAM,SAAS,CAAC;;;;;;;MAOd,EAAE,cAAc;IAClB,CAAC;QAED,MAAM,iBAAiB;YACrB,MAAM,qKAAI,CAAC,KAAK;YAChB,OAAO;gBACL,MAAM,qKAAI,CAAC,MAAM;gBACjB,YAAY;oBACV,MAAM;wBACJ,MAAM,qKAAI,CAAC,OAAO;wBAClB,aAAa;oBACf;oBACA,UAAU;wBACR,MAAM,qKAAI,CAAC,MAAM;wBACjB,aAAa;oBACf;oBACA,YAAY;wBACV,MAAM,qKAAI,CAAC,MAAM;wBACjB,aAAa;oBACf;oBACA,aAAa;wBACX,MAAM,qKAAI,CAAC,MAAM;wBACjB,aAAa;oBACf;gBACF;gBACA,UAAU;oBAAC;oBAAQ;oBAAY;oBAAc;iBAAc;YAC7D;QACF;QAEA,MAAM,WAAW,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC;YAC/C,OAAO;YACP,UAAU;YACV,QAAQ;gBACN,kBAAkB;gBAClB,gBAAgB;YAClB;QACF;QAEA,MAAM,WAAW,SAAS,IAAI,CAAC,IAAI;QACnC,MAAM,cAA4B,KAAK,KAAK,CAAC;QAE7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAY;IACzC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA+E,GACxF;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}