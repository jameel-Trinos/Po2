module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/process [external] (process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/querystring [external] (querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/fs/promises [external] (fs/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs/promises", () => require("fs/promises"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/node:stream/promises [external] (node:stream/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream/promises", () => require("node:stream/promises"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[project]/app/api/analyze/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@google/genai/dist/node/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
;
;
async function POST(request) {
    try {
        // Check for GEMINI_API_KEY (server-side) or NEXT_PUBLIC_API_KEY (for backward compatibility)
        const apiKey = process.env.GEMINI_API_KEY || ("TURBOPACK compile-time value", "AIzaSyAAdOixGAtP3GdflcC0fzIQdIumNrj0Cao");
        if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
        ;
        const { pdfTextByPage } = await request.json();
        if (!pdfTextByPage || typeof pdfTextByPage !== 'string') {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Invalid request: pdfTextByPage is required."
            }, {
                status: 400
            });
        }
        const ai = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["GoogleGenAI"]({
            apiKey
        });
        const prompt = `
      You are an expert financial compliance reviewer specializing in FINRA and SEC regulations. Analyze the following text extracted from a financial document. The text for each page is separated by '--- PAGE [number] ---'.
      
      CRITICAL INSTRUCTIONS:
      - ONLY report issues that ACTUALLY EXIST in the provided text
      - Extract the EXACT original text from the document (word-for-word, including any errors)
      - DO NOT make up or infer issues that aren't clearly present
      - Focus on providing HIGH-QUALITY, RELEVANT suggestions based on what you actually see
      
      Your task is to identify:
      1. COMPLIANCE VIOLATIONS (critical/warning):
         - Missing risk disclosures required by FINRA/SEC
         - Prohibited claims (guaranteed returns, misleading performance predictions)
         - Required disclaimers that are missing or incomplete
         - Misleading or deceptive language about investments
         - Failure to disclose conflicts of interest
         - Omission of material facts
         - Improper comparisons or benchmarks
         - Use of superlatives without substantiation
      
      2. GRAMMAR/STYLE ISSUES (suggestion):
         - Grammatical mistakes (subject-verb agreement, tense errors, etc.)
         - Spelling errors
         - Awkward or unclear phrasing
         - Punctuation issues
         - Sentence structure problems
         - Word choice improvements for clarity
      
      For each issue found, you MUST provide:
      - text: the EXACT problematic text snippet copied word-for-word from the document (minimum 3-5 words for context)
      - suggestion: the corrected version with the same context length
      - issue: a clear, specific explanation of what's wrong and why the change is needed
      - page: the exact page number where found
      - category: one of "compliance", "grammar", or "style"
      - severity: "critical" (compliance violations, must fix), "warning" (important issues), or "suggestion" (improvements)
      
      IMPORTANT RULES:
      1. The "text" field MUST be an exact copy from the document - verify it exists in the text provided
      2. Include enough context (3-10 words) so the text can be uniquely identified
      3. Make sure your suggestion replaces ONLY the problematic part while maintaining context
      4. If you cannot find clear, specific issues, return an empty array rather than generic suggestions
      5. Focus on quality over quantity - only report genuine issues you can clearly identify
      
      Compliance violations should be marked as "critical" or "warning" severity.
      Grammar/style issues should be marked as "suggestion" severity.
      
      Return your findings as a JSON array. If there are no genuine issues found, return an empty array.

      Here is the text:
      ${pdfTextByPage}
    `;
        const responseSchema = {
            type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Type"].ARRAY,
            items: {
                type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Type"].OBJECT,
                properties: {
                    issue: {
                        type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Type"].STRING,
                        description: "A brief description of the issue (e.g., 'Performance disclaimer missing')."
                    },
                    page: {
                        type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Type"].INTEGER,
                        description: "The page number where the issue was found."
                    },
                    text: {
                        type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Type"].STRING,
                        description: "The original problematic text snippet."
                    },
                    suggestion: {
                        type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Type"].STRING,
                        description: "The suggested correction for the text."
                    },
                    category: {
                        type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Type"].STRING,
                        description: "The category of the issue: compliance, grammar, or style.",
                        enum: [
                            "compliance",
                            "grammar",
                            "style"
                        ]
                    },
                    severity: {
                        type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Type"].STRING,
                        description: "The severity level: critical (must fix), warning (should fix), or suggestion (nice to have).",
                        enum: [
                            "critical",
                            "warning",
                            "suggestion"
                        ]
                    }
                },
                required: [
                    "issue",
                    "page",
                    "text",
                    "suggestion"
                ]
            }
        };
        const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: "application/json",
                responseSchema: responseSchema
            }
        });
        // Check if response has text property
        if (!response || typeof response.text !== 'string') {
            console.error("Invalid response structure:", response);
            throw new Error(`Invalid response from AI: response.text is not available. Response structure: ${JSON.stringify(response)}`);
        }
        const jsonText = response.text.trim();
        if (!jsonText) {
            throw new Error(`Empty response from AI.`);
        }
        let suggestions;
        try {
            const parsed = JSON.parse(jsonText);
            // Validate that parsed is an array
            if (!Array.isArray(parsed)) {
                throw new Error(`Invalid response format: expected an array of suggestions, got ${typeof parsed}`);
            }
            // Map response to Suggestion format with backward compatibility
            suggestions = parsed.map((item)=>({
                    issue: item.issue || item.explanation || 'Issue found',
                    page: item.page || 1,
                    text: item.text || item.original || '',
                    suggestion: item.suggestion || '',
                    category: item.category || 'compliance',
                    severity: item.severity || 'warning',
                    // Backward compatibility aliases
                    original: item.text || item.original || '',
                    explanation: item.issue || item.explanation || 'Issue found'
                }));
        } catch (parseError) {
            console.error("Failed to parse Gemini response as JSON:", parseError);
            console.error("Response text:", jsonText);
            throw new Error(`Failed to parse AI response. The response may not be valid JSON.`);
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            suggestions
        });
    } catch (error) {
        console.error("Error analyzing content with Gemini:", error);
        // Extract error information from various error formats
        let errorMessage = "Failed to get suggestions from the AI. Please check the console for details.";
        let statusCode = 500;
        if (error instanceof Error) {
            errorMessage = error.message || errorMessage;
            // Check if error has additional properties (common in API errors)
            const errorAny = error;
            if (errorAny.status || errorAny.code) {
                statusCode = errorAny.status || errorAny.code || statusCode;
            }
            // Handle nested error structures from Gemini API
            if (errorAny.error) {
                const nestedError = errorAny.error;
                if (typeof nestedError === 'object') {
                    if (nestedError.message) {
                        errorMessage = nestedError.message;
                    }
                    if (nestedError.code) {
                        statusCode = nestedError.code;
                    } else if (nestedError.status) {
                        // Map status strings to HTTP codes
                        const statusMap = {
                            'UNAVAILABLE': 503,
                            'RESOURCE_EXHAUSTED': 429,
                            'UNAUTHENTICATED': 401,
                            'PERMISSION_DENIED': 403,
                            'INVALID_ARGUMENT': 400,
                            'NOT_FOUND': 404
                        };
                        statusCode = statusMap[nestedError.status] || statusCode;
                    }
                }
            }
        } else if (typeof error === 'string') {
            errorMessage = error;
        } else if (error && typeof error === 'object') {
            // Handle error objects directly
            const errorObj = error;
            if (errorObj.message) {
                errorMessage = errorObj.message;
            }
            if (errorObj.error?.message) {
                errorMessage = errorObj.error.message;
            }
            if (errorObj.error?.code) {
                statusCode = errorObj.error.code;
            } else if (errorObj.error?.status) {
                const statusMap = {
                    'UNAVAILABLE': 503,
                    'RESOURCE_EXHAUSTED': 429,
                    'UNAUTHENTICATED': 401,
                    'PERMISSION_DENIED': 403,
                    'INVALID_ARGUMENT': 400,
                    'NOT_FOUND': 404
                };
                statusCode = statusMap[errorObj.error.status] || statusCode;
            }
        }
        // Ensure status code is valid (between 400-599)
        if (statusCode < 400 || statusCode >= 600) {
            statusCode = 500;
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: {
                message: errorMessage,
                code: statusCode,
                status: statusCode === 503 ? 'UNAVAILABLE' : 'ERROR'
            }
        }, {
            status: statusCode
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__c4b65b25._.js.map