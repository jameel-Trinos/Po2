module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/jsdom [external] (jsdom, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("jsdom", () => require("jsdom"));

module.exports = mod;
}),
"[project]/app/api/compliance/apply-change/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "POST",
    ()=>POST,
    "runtime",
    ()=>runtime
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$pdf$2d$lib$2f$es$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/pdf-lib/es/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$pdf$2d$lib$2f$es$2f$api$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/pdf-lib/es/api/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mammoth$2f$lib$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/mammoth/lib/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/docx/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$jsdom__$5b$external$5d$__$28$jsdom$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/jsdom [external] (jsdom, cjs)");
;
;
;
;
;
const runtime = 'nodejs';
// Helper function to load pdfjs dynamically
async function loadPdfJs() {
    const pdfjs = await __turbopack_context__.A("[project]/node_modules/pdfjs-dist/build/pdf.mjs [app-route] (ecmascript, async loader)");
    // Set worker source if not already set
    if (typeof globalThis !== 'undefined' && !pdfjs.GlobalWorkerOptions.workerSrc) {
        pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;
    }
    return pdfjs;
}
/**
 * Extract text from PDF using pdfjs-dist
 */ async function extractTextFromPdf(buffer) {
    const pdfjs = await loadPdfJs();
    const pdf = await pdfjs.getDocument({
        data: buffer
    }).promise;
    let fullText = '';
    // Extract text from each page
    for(let i = 1; i <= pdf.numPages; i++){
        const page = await pdf.getPage(i);
        const textContent = await page.getTextContent();
        // Combine text items with proper spacing
        const pageText = textContent.items.map((item)=>{
            if ('str' in item) {
                return item.str;
            }
            return '';
        }).join(' ');
        fullText += pageText + '\n\n';
    }
    return fullText.trim();
}
/**
 * Apply text replacement in PDF using PDF→DOCX→PDF workflow
 * This is the recommended approach for complex text modifications
 */ async function applyChangeToPdf(pdfBuffer, originalText, suggestedText) {
    try {
        // Step 1: Extract text from PDF
        let modifiedText = await extractTextFromPdf(pdfBuffer);
        // Step 2: Apply text replacement
        const regex = new RegExp(originalText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        modifiedText = modifiedText.replace(regex, suggestedText);
        // Step 3: Convert to DOCX format
        const paragraphs = modifiedText.split('\n\n').filter((p)=>p.trim()).map((p)=>new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Paragraph"]({
                children: [
                    new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TextRun"](p.trim())
                ]
            }));
        const doc = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Document"]({
            sections: [
                {
                    properties: {},
                    children: paragraphs.length > 0 ? paragraphs : [
                        new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Paragraph"]({
                            children: [
                                new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TextRun"]('')
                            ]
                        })
                    ]
                }
            ]
        });
        // Step 4: Generate DOCX buffer
        const docxBuffer = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Packer"].toBuffer(doc);
        // Note: In a production environment, you would convert DOCX back to PDF
        // using a service like LibreOffice, Gotenberg, or a cloud API
        // For now, we return the modified text as a simple PDF
        // Step 5: Create a new PDF with modified text
        const newPdfDoc = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$pdf$2d$lib$2f$es$2f$api$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PDFDocument"].create();
        const page = newPdfDoc.addPage([
            595,
            842
        ]); // A4 size
        const { height } = page.getSize();
        const fontSize = 12;
        const margin = 50;
        let yPosition = height - margin;
        // Split text into lines and add to PDF
        const lines = modifiedText.split('\n');
        for (const line of lines){
            if (yPosition < margin) {
                // Add new page if needed
                const newPage = newPdfDoc.addPage([
                    595,
                    842
                ]);
                yPosition = newPage.getSize().height - margin;
            }
            page.drawText(line.slice(0, 80), {
                x: margin,
                y: yPosition,
                size: fontSize
            });
            yPosition -= fontSize + 4;
        }
        const pdfBytes = await newPdfDoc.save();
        return Buffer.from(pdfBytes);
    } catch (error) {
        console.error('Error applying change to PDF:', error);
        throw new Error('Failed to apply change to PDF');
    }
}
/**
 * Apply text replacement in DOCX
 */ async function applyChangeToDocx(docxBuffer, originalText, suggestedText) {
    try {
        // Extract HTML from DOCX
        const result = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mammoth$2f$lib$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].convertToHtml({
            buffer: docxBuffer
        });
        let htmlContent = result.value;
        // Apply text replacement
        const regex = new RegExp(originalText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        htmlContent = htmlContent.replace(regex, suggestedText);
        // Convert back to DOCX
        // Parse HTML and create DOCX structure using JSDOM
        const dom = new __TURBOPACK__imported__module__$5b$externals$5d2f$jsdom__$5b$external$5d$__$28$jsdom$2c$__cjs$29$__["JSDOM"](htmlContent);
        const textContent = dom.window.document.body.textContent || '';
        const paragraphs = textContent.split('\n').filter((p)=>p.trim()).map((p)=>new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Paragraph"]({
                children: [
                    new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TextRun"](p.trim())
                ]
            }));
        const wordDoc = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Document"]({
            sections: [
                {
                    properties: {},
                    children: paragraphs.length > 0 ? paragraphs : [
                        new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Paragraph"]({
                            children: [
                                new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TextRun"]('')
                            ]
                        })
                    ]
                }
            ]
        });
        const buffer = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$docx$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Packer"].toBuffer(wordDoc);
        return Buffer.from(buffer);
    } catch (error) {
        console.error('Error applying change to DOCX:', error);
        throw new Error('Failed to apply change to DOCX');
    }
}
async function POST(request) {
    try {
        const body = await request.json();
        const { documentId, originalText, suggestedText, suggestionId, fileType, documentData } = body;
        // Validate input
        if (!documentId || !originalText || !suggestedText) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Missing required fields: documentId, originalText, suggestedText'
            }, {
                status: 400
            });
        }
        let modifiedDocumentUrl;
        // If document data is provided, apply the change
        if (documentData && fileType) {
            try {
                // Decode base64 document data
                const buffer = Buffer.from(documentData.split(',')[1] || documentData, 'base64');
                let modifiedBuffer;
                if (fileType === 'pdf') {
                    // Apply change to PDF using PDF→DOCX→PDF workflow
                    modifiedBuffer = await applyChangeToPdf(buffer, originalText, suggestedText);
                    const base64 = modifiedBuffer.toString('base64');
                    modifiedDocumentUrl = `data:application/pdf;base64,${base64}`;
                } else if (fileType === 'docx') {
                    // Apply change to DOCX
                    modifiedBuffer = await applyChangeToDocx(buffer, originalText, suggestedText);
                    const base64 = modifiedBuffer.toString('base64');
                    modifiedDocumentUrl = `data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,${base64}`;
                }
            } catch (error) {
                console.error('Error processing document:', error);
            // Continue without modified document URL
            }
        }
        // Simulate processing delay
        await new Promise((resolve)=>setTimeout(resolve, 100));
        // Mock: Deduct balance for applying change (0.01 credits per change)
        const costPerChange = 0.01;
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            documentId,
            appliedChange: {
                from: originalText,
                to: suggestedText,
                suggestionId
            },
            modifiedDocumentUrl,
            cost: costPerChange,
            message: 'Change applied successfully'
        });
    } catch (error) {
        console.error('Error applying change:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to apply change',
            details: error instanceof Error ? error.message : String(error)
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__e9b3663f._.js.map