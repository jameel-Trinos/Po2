(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32189,(e,t,n)=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},10760,(e,t,n)=>{"use strict";var r=e.r(32189);function o(){}function i(){}i.resetWarningCache=o,t.exports=function(){function e(e,t,n,o,i,a){if(a!==r){var s=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:o};return n.PropTypes=n,n}},45009,(e,t,n)=>{t.exports=e.r(10760)()},70814,e=>{"use strict";var t,n,r,o=e.i(43476),i=e.i(71645),a=e.i(18566),s=e.i(46932),l=e.i(69074),c=e.i(78583),d=e.i(40160),u=e.i(58613),p=e.i(67881),f=e.i(70065),h=e.i(23750),m=e.i(10708),g=e.i(81947),y=e.i(87336),v=e.i(94179),x=e.i(69035),b=e.i(45009),C=function(){return(C=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},k={onActivate:b.func,onAddUndo:b.func,onBeforeAddUndo:b.func,onBeforeExecCommand:b.func,onBeforeGetContent:b.func,onBeforeRenderUI:b.func,onBeforeSetContent:b.func,onBeforePaste:b.func,onBlur:b.func,onChange:b.func,onClearUndos:b.func,onClick:b.func,onContextMenu:b.func,onCommentChange:b.func,onCompositionEnd:b.func,onCompositionStart:b.func,onCompositionUpdate:b.func,onCopy:b.func,onCut:b.func,onDblclick:b.func,onDeactivate:b.func,onDirty:b.func,onDrag:b.func,onDragDrop:b.func,onDragEnd:b.func,onDragGesture:b.func,onDragOver:b.func,onDrop:b.func,onExecCommand:b.func,onFocus:b.func,onFocusIn:b.func,onFocusOut:b.func,onGetContent:b.func,onHide:b.func,onInit:b.func,onInput:b.func,onKeyDown:b.func,onKeyPress:b.func,onKeyUp:b.func,onLoadContent:b.func,onMouseDown:b.func,onMouseEnter:b.func,onMouseLeave:b.func,onMouseMove:b.func,onMouseOut:b.func,onMouseOver:b.func,onMouseUp:b.func,onNodeChange:b.func,onObjectResizeStart:b.func,onObjectResized:b.func,onObjectSelected:b.func,onPaste:b.func,onPostProcess:b.func,onPostRender:b.func,onPreProcess:b.func,onProgressState:b.func,onRedo:b.func,onRemove:b.func,onReset:b.func,onSaveContent:b.func,onSelectionChange:b.func,onSetAttrib:b.func,onSetContent:b.func,onShow:b.func,onSubmit:b.func,onUndo:b.func,onVisualAid:b.func,onSkinLoadError:b.func,onThemeLoadError:b.func,onModelLoadError:b.func,onPluginLoadError:b.func,onIconsLoadError:b.func,onLanguageLoadError:b.func,onScriptsLoad:b.func,onScriptsLoadError:b.func},w=C({apiKey:b.string,licenseKey:b.string,id:b.string,inline:b.bool,init:b.object,initialValue:b.string,onEditorChange:b.func,value:b.string,tagName:b.string,tabIndex:b.number,cloudChannel:b.string,plugins:b.oneOfType([b.string,b.array]),toolbar:b.oneOfType([b.string,b.array]),disabled:b.bool,readonly:b.bool,textareaName:b.string,tinymceScriptSrc:b.oneOfType([b.string,b.arrayOf(b.string),b.arrayOf(b.shape({src:b.string,async:b.bool,defer:b.bool}))]),rollback:b.oneOfType([b.number,b.oneOf([!1])]),scriptLoading:b.shape({async:b.bool,defer:b.bool,delay:b.number})},k),j=function(e){return e&&e.tinymce?e.tinymce:null},E=function(e){return"function"==typeof e},N=function(e){return e in k},S=function(e){return e.substr(2)},T=function(e,t,n,r,o,i,a){var s=Object.keys(o).filter(N),l=Object.keys(i).filter(N),c=s.filter(function(e){return void 0===i[e]}),d=l.filter(function(e){return void 0===o[e]});c.forEach(function(e){var t=S(e),r=a[t];n(t,r),delete a[t]}),d.forEach(function(n){var o=r(e,n),i=S(n);a[i]=o,t(i,o)})},D=0,O=function(e){var t=Date.now();return e+"_"+Math.floor(1e9*Math.random())+ ++D+String(t)},P=function(e){return null!==e&&("textarea"===e.tagName.toLowerCase()||"input"===e.tagName.toLowerCase())},L=function(e){return void 0===e||""===e?[]:Array.isArray(e)?e:e.split(" ")},F=function(e){if(!("isConnected"in Node.prototype)){for(var t=e,n=e.parentNode;null!=n;)n=(t=n).parentNode;return t===e.ownerDocument}return e.isConnected},B=function(e,t){void 0!==e&&(null!=e.mode&&"object"==typeof e.mode&&"function"==typeof e.mode.set?e.mode.set(t):e.setMode(t))},I=function(e){var t=j(e);if(!t)throw Error("tinymce should have been loaded into global scope");return t},z=function(e){return e.options&&e.options.isRegistered("disabled")},R=function(){return(R=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},_=function(e,t,n){var r,o,i=e.createElement("script");i.referrerPolicy="origin",i.type="application/javascript",i.id=t.id,i.src=t.src,i.async=null!=(r=t.async)&&r,i.defer=null!=(o=t.defer)&&o;var a=function(){i.removeEventListener("load",a),i.removeEventListener("error",s),n(t.src)},s=function(e){i.removeEventListener("load",a),i.removeEventListener("error",s),n(t.src,e)};i.addEventListener("load",a),i.addEventListener("error",s),e.head&&e.head.appendChild(i)},U=function(e){var t={},n=function(e,n){var r=t[e];r.done=!0,r.error=n;for(var o=0,i=r.handlers;o<i.length;o++)(0,i[o])(e,n);r.handlers=[]};return{loadScripts:function(r,o,i){var a=function(e){return void 0!==i?i(e):console.error(e)};if(0===r.length)return void a(Error("At least one script must be provided"));for(var s=0,l=!1,c=function(e,t){l||(t?(l=!0,a(t)):++s===r.length&&o())},d=0;d<r.length;d++){var u=r[d],p=t[u.src];if(p)p.done?c(u.src,p.error):p.handlers.push(c);else{var f=O("tiny-");t[u.src]={id:f,src:u.src,done:!1,error:null,handlers:[c]},_(e,R({id:f},u),n)}}},deleteScripts:function(){for(var n,r=0,o=Object.values(t);r<o.length;r++){var i=o[r],a=e.getElementById(i.id);null!=a&&"SCRIPT"===a.tagName&&(null==(n=a.parentNode)||n.removeChild(a))}t={}},getDocument:function(){return e}}},M=(t=[],n=function(e){var n=t.find(function(t){return t.getDocument()===e});return void 0===n&&(n=U(e),t.push(n)),n},{loadList:function(e,t,r,o,i){var a=function(){return n(e).loadScripts(t,o,i)};r>0?setTimeout(a,r):a()},reinitialize:function(){for(var e=t.pop();null!=e;e=t.pop())e.deleteScripts()}}),A=(r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),H=function(){return(H=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},W="change keyup compositionend setcontent CommentChange",V=function(e){function t(t){var n,r,o,a=e.call(this,t)||this;return a.rollbackTimer=void 0,a.valueCursor=void 0,a.rollbackChange=function(){var e=a.editor,t=a.props.value;e&&t&&t!==a.currentContent&&e.undoManager.ignore(function(){if(e.setContent(t),a.valueCursor&&(!a.inline||e.hasFocus()))try{e.selection.moveToBookmark(a.valueCursor)}catch(e){}}),a.rollbackTimer=void 0},a.handleBeforeInput=function(e){if(void 0!==a.props.value&&a.props.value===a.currentContent&&a.editor&&(!a.inline||a.editor.hasFocus()))try{a.valueCursor=a.editor.selection.getBookmark(3)}catch(e){}},a.handleBeforeInputSpecial=function(e){("Enter"===e.key||"Backspace"===e.key||"Delete"===e.key)&&a.handleBeforeInput(e)},a.handleEditorChange=function(e){var t=a.editor;if(t&&t.initialized){var n=t.getContent();void 0===a.props.value||a.props.value===n||!1===a.props.rollback||a.rollbackTimer||(a.rollbackTimer=window.setTimeout(a.rollbackChange,"number"==typeof a.props.rollback?a.props.rollback:200)),n!==a.currentContent&&(a.currentContent=n,E(a.props.onEditorChange)&&a.props.onEditorChange(n,t))}},a.handleEditorChangeSpecial=function(e){("Backspace"===e.key||"Delete"===e.key)&&a.handleEditorChange(e)},a.initialise=function(e){void 0===e&&(e=0);var t,n,r,o=a.elementRef.current;if(o){if(!F(o)){if(0===e)setTimeout(function(){return a.initialise(1)},1);else if(e<100)setTimeout(function(){return a.initialise(e+1)},100);else throw Error("tinymce can only be initialised when in a document");return}var i,s,l=I(a.view),c=H(H(H(H({},a.props.init),{selector:void 0,target:o,disabled:a.props.disabled,readonly:a.props.readonly,inline:a.inline,plugins:(i=null==(t=a.props.init)?void 0:t.plugins,s=a.props.plugins,L(i).concat(L(s))),toolbar:null!=(n=a.props.toolbar)?n:null==(r=a.props.init)?void 0:r.toolbar}),a.props.licenseKey?{license_key:a.props.licenseKey}:{}),{setup:function(e){a.editor=e,a.bindHandlers({}),a.inline&&!P(o)&&e.once("PostRender",function(t){e.setContent(a.getInitialValue(),{no_events:!0})}),a.props.init&&E(a.props.init.setup)&&a.props.init.setup(e),a.props.disabled&&(z(a.editor)?a.editor.options.set("disabled",a.props.disabled):a.editor.mode.set("readonly"))},init_instance_callback:function(e){var t,n=a.getInitialValue();a.currentContent=null!=(t=a.currentContent)?t:e.getContent(),a.currentContent!==n&&(a.currentContent=n,e.setContent(n),e.undoManager.clear(),e.undoManager.add(),e.setDirty(!1)),a.props.init&&E(a.props.init.init_instance_callback)&&a.props.init.init_instance_callback(e)}});a.inline||(o.style.visibility=""),P(o)&&(o.value=a.getInitialValue()),l.init(c)}},a.id=a.props.id||O("tiny-react"),a.elementRef=i.createRef(),a.inline=null!=(o=null!=(n=a.props.inline)?n:null==(r=a.props.init)?void 0:r.inline)&&o,a.boundHandlers={},a}return A(t,e),Object.defineProperty(t.prototype,"view",{get:function(){var e,t;return null!=(t=null==(e=this.elementRef.current)?void 0:e.ownerDocument.defaultView)?t:window},enumerable:!1,configurable:!0}),t.prototype.componentDidUpdate=function(e){var t,n,r=this;if(this.rollbackTimer&&(clearTimeout(this.rollbackTimer),this.rollbackTimer=void 0),this.editor&&(this.bindHandlers(e),this.editor.initialized)){if(this.currentContent=null!=(t=this.currentContent)?t:this.editor.getContent(),"string"==typeof this.props.initialValue&&this.props.initialValue!==e.initialValue)this.editor.setContent(this.props.initialValue),this.editor.undoManager.clear(),this.editor.undoManager.add(),this.editor.setDirty(!1);else if("string"==typeof this.props.value&&this.props.value!==this.currentContent){var o=this.editor;o.undoManager.transact(function(){if(!r.inline||o.hasFocus())try{e=o.selection.getBookmark(3)}catch(e){}var e,t=r.valueCursor;if(o.setContent(r.props.value),!r.inline||o.hasFocus())for(var n=0,i=[e,t];n<i.length;n++){var a=i[n];if(a)try{o.selection.moveToBookmark(a),r.valueCursor=a;break}catch(e){}}})}if(this.props.readonly!==e.readonly){var i=null!=(n=this.props.readonly)&&n;B(this.editor,i?"readonly":"design")}this.props.disabled!==e.disabled&&(z(this.editor)?this.editor.options.set("disabled",this.props.disabled):B(this.editor,this.props.disabled?"readonly":"design"))}},t.prototype.componentDidMount=function(){var e,t,n,r,o,i=this;null!==j(this.view)?this.initialise():Array.isArray(this.props.tinymceScriptSrc)&&0===this.props.tinymceScriptSrc.length?null==(t=(e=this.props).onScriptsLoadError)||t.call(e,Error("No `tinymce` global is present but the `tinymceScriptSrc` prop was an empty array.")):(null==(n=this.elementRef.current)?void 0:n.ownerDocument)&&M.loadList(this.elementRef.current.ownerDocument,this.getScriptSources(),null!=(o=null==(r=this.props.scriptLoading)?void 0:r.delay)?o:0,function(){var e,t;null==(t=(e=i.props).onScriptsLoad)||t.call(e),i.initialise()},function(e){var t,n;null==(n=(t=i.props).onScriptsLoadError)||n.call(t,e)})},t.prototype.componentWillUnmount=function(){var e=this,t=this.editor;t&&(t.off(W,this.handleEditorChange),t.off(this.beforeInputEvent(),this.handleBeforeInput),t.off("keypress",this.handleEditorChangeSpecial),t.off("keydown",this.handleBeforeInputSpecial),t.off("NewBlock",this.handleEditorChange),Object.keys(this.boundHandlers).forEach(function(n){t.off(n,e.boundHandlers[n])}),this.boundHandlers={},t.remove(),this.editor=void 0)},t.prototype.render=function(){return this.inline?this.renderInline():this.renderIframe()},t.prototype.beforeInputEvent=function(){return window.InputEvent&&"function"==typeof InputEvent.prototype.getTargetRanges?"beforeinput SelectionChange":"SelectionChange"},t.prototype.renderInline=function(){var e=this.props.tagName;return i.createElement(void 0===e?"div":e,{ref:this.elementRef,id:this.id,tabIndex:this.props.tabIndex})},t.prototype.renderIframe=function(){return i.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,id:this.id,tabIndex:this.props.tabIndex})},t.prototype.getScriptSources=function(){var e,t,n=null==(e=this.props.scriptLoading)?void 0:e.async,r=null==(t=this.props.scriptLoading)?void 0:t.defer;if(void 0!==this.props.tinymceScriptSrc)return"string"==typeof this.props.tinymceScriptSrc?[{src:this.props.tinymceScriptSrc,async:n,defer:r}]:this.props.tinymceScriptSrc.map(function(e){return"string"==typeof e?{src:e,async:n,defer:r}:e});var o=this.props.cloudChannel,i=this.props.apiKey?this.props.apiKey:"no-api-key";return[{src:"https://cdn.tiny.cloud/1/".concat(i,"/tinymce/").concat(o,"/tinymce.min.js"),async:n,defer:r}]},t.prototype.getInitialValue=function(){return"string"==typeof this.props.initialValue?this.props.initialValue:"string"==typeof this.props.value?this.props.value:""},t.prototype.bindHandlers=function(e){var t=this;if(void 0!==this.editor){n=this.editor,r=this.props,o=this.boundHandlers,T(function(e){return t.props[e]},n.on.bind(n),n.off.bind(n),function(e,t){return function(r){var o;return null==(o=e(t))?void 0:o(r,n)}},e,r,o);var n,r,o,i=function(e){return void 0!==e.onEditorChange||void 0!==e.value},a=i(e),s=i(this.props);!a&&s?(this.editor.on(W,this.handleEditorChange),this.editor.on(this.beforeInputEvent(),this.handleBeforeInput),this.editor.on("keydown",this.handleBeforeInputSpecial),this.editor.on("keyup",this.handleEditorChangeSpecial),this.editor.on("NewBlock",this.handleEditorChange)):a&&!s&&(this.editor.off(W,this.handleEditorChange),this.editor.off(this.beforeInputEvent(),this.handleBeforeInput),this.editor.off("keydown",this.handleBeforeInputSpecial),this.editor.off("keyup",this.handleEditorChangeSpecial),this.editor.off("NewBlock",this.handleEditorChange))}},t.propTypes=w,t.defaultProps={cloudChannel:"8"},t}(i.Component);let K=(0,i.forwardRef)(({content:e,onContentChange:t,suggestions:n=[],selectedSuggestionIndex:r=null,className:a},s)=>{let l=(0,i.useRef)(null);return(0,i.useImperativeHandle)(s,()=>({highlightText:e=>{l.current&&$(l.current,e)},replaceText:(e,t)=>{l.current&&G(l.current,e,t)},getEditor:()=>l.current,getContent:()=>l.current?.getContent()||""})),(0,i.useEffect)(()=>{l.current&&e!==l.current.getContent()&&l.current.setContent(e)},[e]),(0,i.useEffect)(()=>{if(l.current&&null!==r&&n[r]){let e=n[r],t=e.text||e.original||"";t&&$(l.current,t)}},[r,n]),(0,o.jsx)(f.Card,{className:`border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 ${a||""}`,children:(0,o.jsx)(f.CardContent,{className:"p-0",children:(0,o.jsx)(V,{onInit:(e,t)=>{l.current=t},value:e,onEditorChange:e=>{t(e)},init:{height:"70vh",menubar:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount","textcolor","colorpicker","textpattern","nonbreaking","paste"],toolbar:"undo redo | blocks | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family: -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif; font-size: 14px; padding: 20px; line-height: 1.6; }",skin:window.matchMedia("(prefers-color-scheme: dark)").matches?"oxide-dark":"oxide",content_css:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"default",branding:!1,promotion:!1,resize:!0,statusbar:!1,menubar:!1,paste_as_text:!1,paste_auto_cleanup_on_paste:!0,convert_urls:!1,setup:e=>{e.addCommand("highlightText",t=>{$(e,t)}),e.addCommand("replaceText",(t,n)=>{G(e,t,n)})}}})})})});function $(e,t){if(t&&t.trim())try{e.getBody().querySelectorAll("mark.suggestion-highlight").forEach(e=>{let t=e.parentNode;if(t){for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e),t.normalize()}});let n=e.getContent({format:"text"}),r=t.trim().toLowerCase(),o=n.toLowerCase().indexOf(r);if(-1===o)return void console.warn("Text not found in editor:",t);let i=e.getContent(),a=document.createElement("div");a.innerHTML=i;let s=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,null),l=null,c=!1;for(;(l=s.nextNode())&&!c;){let e=l,t=e.textContent||"",n=t.toLowerCase();t.length;let o=n.indexOf(r);if(-1!==o){let n=t.substring(0,o),i=t.substring(o,o+r.length),a=t.substring(o+r.length),s=document.createDocumentFragment();n&&s.appendChild(document.createTextNode(n));let l=document.createElement("mark");l.className="suggestion-highlight",l.setAttribute("style","background-color: #fef08a; color: #000; padding: 2px 4px; border-radius: 3px;"),l.textContent=i,s.appendChild(l),a&&s.appendChild(document.createTextNode(a)),e.parentNode?.replaceChild(s,e),c=!0}}c&&(e.setContent(a.innerHTML),setTimeout(()=>{let t=e.getBody().querySelector("mark.suggestion-highlight");t&&(e.selection.select(t),e.selection.scrollIntoView(),t.scrollIntoView({behavior:"smooth",block:"center"}))},100))}catch(e){console.error("Error highlighting text in TinyMCE:",e)}}function G(e,t,n){if(t&&t.trim())try{e.getBody().querySelectorAll("mark.suggestion-highlight").forEach(e=>{let t=e.parentNode;if(t){for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e),t.normalize()}});let r=e.getContent(),o=e.getContent({format:"text"}),i=t.trim().toLowerCase(),a=o.toLowerCase().indexOf(i);if(-1===a)return void console.warn("Text not found in editor for replacement:",t);let s=document.createElement("div");s.innerHTML=r;let l=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,null),c=null,d=!1;for(;(c=l.nextNode())&&!d;){let e=c,t=e.textContent||"",r=t.toLowerCase();t.length;let o=r.indexOf(i);if(-1!==o){let r=t.substring(0,o),a=t.substring(o+i.length),s=document.createDocumentFragment();r&&s.appendChild(document.createTextNode(r)),s.appendChild(document.createTextNode(n)),a&&s.appendChild(document.createTextNode(a)),e.parentNode?.replaceChild(s,e),d=!0}}d&&e.setContent(s.innerHTML)}catch(e){console.error("Error replacing text in TinyMCE:",e)}}K.displayName="TinyMCEEditor";var X=e.i(8276),q=e.i(74755),Y=e.i(78681),J=e.i(46696),Q=e.i(9079);async function Z(){let t=await e.A(25834);return t.GlobalWorkerOptions.workerSrc||(t.GlobalWorkerOptions.workerSrc="/pdf.worker.mjs"),t}function ee(){let e=(0,a.useSearchParams)().get("documentId"),{getDocumentPdfUrl:t,getDocumentContent:n,getDocument:r}=(0,Q.useAppContext)(),[b,C]=(0,i.useState)(null),[k,w]=(0,i.useState)(!1),[j,E]=(0,i.useState)(0),[N,S]=(0,i.useState)(null),[T,D]=(0,i.useState)(""),[O,P]=(0,i.useState)([]),[L,F]=(0,i.useState)(null),[B,I]=(0,i.useState)(!1),[z,R]=(0,i.useState)(""),[_,U]=(0,i.useState)(null),[M,A]=(0,i.useState)(null),[H,W]=(0,i.useState)(null),[V,$]=(0,i.useState)(!1),G=(0,i.useRef)(null);(0,i.useEffect)(()=>()=>{M&&URL.revokeObjectURL(M)},[M]),(0,i.useEffect)(()=>{if(!e)return void console.log("[ComplianceEditor] No documentId provided");console.log("[ComplianceEditor] Loading document:",e),w(!0),S(null);try{let n=r(e);n&&(R(n.title||"document"),console.log("[ComplianceEditor] Document loaded:",n.title));let o=t(e);console.log("[ComplianceEditor] PDF URL retrieved:",o?"exists":"null"),o?(A(o),U("pdf"),console.log("[ComplianceEditor] PDF URL set successfully")):(console.warn("[ComplianceEditor] No PDF URL found for document"),S("No PDF URL found for this document"),A(null))}catch(e){console.error("[ComplianceEditor] Error loading PDF:",e),S("Failed to load PDF"),A(null)}finally{w(!1)}},[e,r,t]),(0,i.useEffect)(()=>{if(!e)return;let t=n(e);t&&(console.log("[ComplianceEditor] Content loaded, analyzing..."),E(10),(0,q.analyzePdfContent)(t).then(e=>{P(e),E(100),J.toast.success(`Analysis complete! Found ${e.length} suggestions.`)}).catch(e=>{console.error("[ComplianceEditor] Analysis error:",e),J.toast.error("Failed to analyze document")}))},[e,n]);let ee=async()=>{if(!b)return void S("Please select a document to upload.");w(!0),S(null),P([]),E(10);try{let e=b.name.toLowerCase(),t=e.endsWith(".pdf")||"application/pdf"===b.type,n=e.endsWith(".docx")||b.type.includes("officedocument.wordprocessingml");if(t){U("pdf"),E(20);let e=new FormData;e.append("file",b);let t=await fetch("/api/pdf-to-docx",{method:"POST",body:e});if(!t.ok)throw Error("Failed to convert PDF to DOCX");let n=await t.blob();E(40);let r=await n.arrayBuffer(),o=(await u.default.convertToHtml({arrayBuffer:r})).value||"";D(o),I(!0),E(60);let i=await b.arrayBuffer(),a=await Z(),s=await a.getDocument({data:i}).promise,l="";for(let e=1;e<=s.numPages;e++){let t=await s.getPage(e),n=(await t.getTextContent()).items.map(e=>e.str).join(" ");l+=`--- PAGE ${e} ---
${n}
`,E(60+Math.round(e/s.numPages*20))}E(85);let c=await (0,q.analyzePdfContent)(l);P(c),E(100),J.toast.success(`Document loaded! Found ${c.length} suggestions.`)}else if(n){U("docx"),E(30);let e=await b.arrayBuffer(),t=(await u.default.convertToHtml({arrayBuffer:e})).value||"";D(t),I(!0),E(60);let n=document.createElement("div");n.innerHTML=t;let r=n.textContent||n.innerText||"",o=`--- PAGE 1 ---
${r}`,i=await (0,q.analyzePdfContent)(o);P(i),E(100),J.toast.success(`Document loaded! Found ${i.length} suggestions.`)}else throw Error("Unsupported file type. Please upload a PDF or DOCX file.")}catch(e){console.error("Failed to process file:",e),S(e instanceof Error?e.message:"Failed to process the file."),J.toast.error("Failed to process document")}finally{w(!1)}},et=async()=>{if(!G.current||!B)return void J.toast.error("No content to save");try{let e=G.current.getContent(),t=await (0,Y.htmlToWordBlob)(e),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`${z||"document"}_edited.docx`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),J.toast.success("Document downloaded as Word")}catch(e){console.error("Save error:",e),J.toast.error("Failed to save as Word")}},en=async()=>{if(!G.current||!B)return void J.toast.error("No content to save");try{let e=G.current.getContent(),t=await (0,Y.convertHtmlToPdf)(e),n=document.createElement("a");n.href=t,n.download=`${z||"document"}_edited.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),J.toast.success("Document downloaded as PDF")}catch(e){console.error("Save error:",e),J.toast.error("Failed to save as PDF")}},er=async()=>{if(!M)return void J.toast.error("PDF not available for conversion");$(!0),S(null),E(10);try{let e=await fetch(M),t=await e.blob(),n=new FormData;n.append("file",t,"document.pdf"),E(30);let r=await fetch("/api/pdf-to-docx",{method:"POST",body:n});if(!r.ok)throw Error("Failed to convert PDF to DOCX");let o=await r.blob();E(60);let i=await o.arrayBuffer(),a=(await u.default.convertToHtml({arrayBuffer:i})).value||"";D(a),I(!0),E(100),J.toast.success("Document converted to editor mode")}catch(e){console.error("Conversion error:",e),S(e instanceof Error?e.message:"Failed to convert PDF"),J.toast.error("Failed to convert PDF to editor mode")}finally{$(!1)}};(0,i.useEffect)(()=>{console.log("[ComplianceEditor] State:",{file:b?.name,fileType:_,isEditorMode:B,pdfUrl:M?"set":"not set",suggestionsCount:O.length,isLoading:k})},[b,_,B,M,O.length,k]);let eo=O.reduce((e,t,n)=>{let r=t.category||"compliance";return e[r]||(e[r]=[]),e[r].push({...t,index:n}),e},{});return k?(0,o.jsx)("div",{className:"flex flex-col items-center justify-center h-screen bg-zinc-50 dark:bg-zinc-950 text-center gap-4 px-6",children:(0,o.jsxs)(f.Card,{className:"w-full max-w-md border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,o.jsx)(f.CardHeader,{children:(0,o.jsx)(f.CardTitle,{className:"text-gray-900 dark:text-gray-50",children:"Analyzing Document..."})}),(0,o.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,o.jsx)(y.Progress,{value:j}),(0,o.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:j<30?"Loading document...":j<70?"Extracting text...":"Analyzing compliance..."})]})]})}):(0,o.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-zinc-50 dark:bg-zinc-950 p-4 sm:p-6 lg:p-8",children:(0,o.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,o.jsxs)("div",{className:"mb-6",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-50 mb-2",children:"Financial Compliance Editor"}),(0,o.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Upload documents for FINRA/SEC compliance review and editing"})]}),!B&&!b&&!M&&!e&&(0,o.jsxs)(f.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,o.jsx)(f.CardHeader,{children:(0,o.jsx)(f.CardTitle,{className:"text-gray-900 dark:text-gray-50",children:"Upload Document"})}),(0,o.jsxs)(f.CardContent,{className:"space-y-4",children:[N&&(0,o.jsxs)(g.Alert,{variant:"destructive",children:[(0,o.jsx)(g.AlertTitle,{children:"Error"}),(0,o.jsx)(g.AlertDescription,{children:N})]}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)(m.Label,{htmlFor:"file-upload",children:"Select PDF or Word Document"}),(0,o.jsxs)("div",{className:"flex gap-3",children:[(0,o.jsx)(h.Input,{id:"file-upload",type:"file",accept:".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:e=>{let t=e.target.files?.[0]||null;C(t),P([]),S(null),D(""),I(!1),M&&(URL.revokeObjectURL(M),A(null)),t&&R(t.name.replace(/\.(pdf|docx)$/i,""))}}),(0,o.jsxs)(p.Button,{onClick:ee,disabled:!b,children:[(0,o.jsx)(l.Upload,{className:"h-4 w-4 mr-2"}),"Analyze"]})]}),(0,o.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Supported formats: PDF, DOCX (up to 10MB)"})]})]})]}),(B||b||M)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)(v.Badge,{variant:"outline",children:b?.name||z||"Document"}),O.length>0&&(0,o.jsxs)(v.Badge,{variant:"secondary",children:[O.length," suggestions found"]})]}),(0,o.jsxs)("div",{className:"flex gap-2",children:[M&&"pdf"===_&&!B&&(0,o.jsx)(p.Button,{variant:"default",onClick:er,disabled:V,children:V?"Converting...":"Edit Document"}),(0,o.jsxs)(p.Button,{variant:"outline",onClick:()=>{C(null),I(!1),P([]),D(""),U(null),A(null),W(null)},children:[(0,o.jsx)(l.Upload,{className:"h-4 w-4 mr-2"}),"New Document"]})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,o.jsx)("div",{className:"lg:col-span-2",children:B?(0,o.jsxs)(f.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[(0,o.jsx)(f.CardHeader,{className:"pb-2",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)(f.CardTitle,{className:"text-gray-900 dark:text-gray-50",children:"Document Editor"}),(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:et,children:[(0,o.jsx)(d.Download,{className:"h-4 w-4 mr-2"}),"Download as Word"]}),(0,o.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:en,children:[(0,o.jsx)(d.Download,{className:"h-4 w-4 mr-2"}),"Download as PDF"]})]})]})}),(0,o.jsx)(f.CardContent,{className:"p-0",children:(0,o.jsx)(K,{ref:G,content:T,onContentChange:D,suggestions:O,selectedSuggestionIndex:L})})]}):M&&"pdf"===_?(0,o.jsx)(X.default,{pdfUrl:M,suggestions:O,selectedSuggestion:H,onSuggestionClick:W,onApplyEdit:(e,t,n)=>{J.toast.info("Convert to editor mode to apply changes")}}):(0,o.jsx)(f.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:(0,o.jsxs)(f.CardContent,{className:"p-6 text-center text-gray-600 dark:text-gray-400",children:[(0,o.jsx)(c.FileText,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,o.jsx)("p",{children:"Upload a document to get started"})]})})}),(0,o.jsx)("div",{className:"lg:col-span-1",children:(0,o.jsxs)(f.Card,{className:"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 sticky top-6",children:[(0,o.jsx)(f.CardHeader,{children:(0,o.jsxs)(f.CardTitle,{className:"text-gray-900 dark:text-gray-50 flex items-center justify-between",children:[(0,o.jsx)("span",{children:"Suggestions"}),(0,o.jsx)(v.Badge,{variant:"secondary",children:O.length})]})}),(0,o.jsx)(f.CardContent,{className:"max-h-[calc(100vh-200px)] overflow-y-auto space-y-4",children:0===O.length?(0,o.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,o.jsx)("p",{children:"No suggestions found"}),(0,o.jsx)("p",{className:"text-sm mt-2",children:"Your document looks good!"})]}):(0,o.jsx)(o.Fragment,{children:Object.entries(eo).map(([e,t])=>(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,o.jsx)(v.Badge,{variant:"outline",className:"text-xs",children:(e=>{switch(e){case"compliance":return"Compliance";case"grammar":return"Grammar";case"style":return"Style";default:return e}})(e)}),(0,o.jsx)(x.Separator,{className:"flex-1"})]}),(0,o.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,o.jsx)(f.Card,{className:`border cursor-pointer transition-colors ${L===e.index?"border-emerald-500 dark:border-emerald-600 bg-emerald-50 dark:bg-emerald-950":"border-zinc-200 dark:border-zinc-700"}`,onClick:()=>(e=>{F(e);let t=O[e];if(t)if(B&&G.current){let e=t.text||t.original||"";e&&G.current.highlightText(e)}else M&&"pdf"===_&&W(t)})(e.index),children:(0,o.jsxs)(f.CardContent,{className:"p-3 space-y-2",children:[(0,o.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,o.jsx)(v.Badge,{variant:(e=>{switch(e){case"critical":return"destructive";case"warning":return"default";default:return"secondary"}})(e.severity||"warning"),className:"text-xs",children:e.severity||"warning"}),(0,o.jsxs)("span",{className:"text-xs text-gray-500",children:["Page ",e.page]})]}),(0,o.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.issue||e.explanation||"Issue found"}),(0,o.jsxs)("div",{className:"text-xs space-y-1",children:[(0,o.jsxs)("p",{className:"text-red-600 dark:text-red-400",children:[(0,o.jsx)("span",{className:"font-semibold",children:"Original:"})," ",e.text||e.original||""]}),(0,o.jsxs)("p",{className:"text-green-600 dark:text-green-400",children:[(0,o.jsx)("span",{className:"font-semibold",children:"Suggested:"})," ",e.suggestion]})]}),B&&(0,o.jsx)(p.Button,{variant:"default",size:"sm",className:"w-full mt-2",onClick:t=>{t.stopPropagation(),(e=>{let t=O[e];if(!t||!G.current||!B)return;let n=t.text||t.original||"";n?(G.current.replaceText(n,t.suggestion),D(G.current.getContent()),P(t=>t.filter((t,n)=>n!==e)),null!==L&&(L===e?F(null):L>e&&F(L-1)),J.toast.success("Suggestion applied")):J.toast.error("No text to replace")})(e.index)},children:"Apply Change"})]})},e.index))})]},e))})})]})})]})]})]})})}e.s(["default",()=>ee],70814)}]);